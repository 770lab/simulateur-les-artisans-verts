<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur PAC + ITE â€” Les Artisans Verts</title>
    <link rel="icon" type="image/png" href="data:image/png;base64,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">
    <link rel="apple-touch-icon" href="data:image/png;base64,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">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f7;
            color: #1d1d1f;
            line-height: 1.6;
        }

        /* === BANDEAU INFO 2026 === */
        .info-banner-2026 {
            background: linear-gradient(135deg, #14532d 0%, #166534 50%, #15803d 100%);
            color: white;
            padding: 10px 20px;
            font-size: 13px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        .info-banner-2026 strong { color: #86efac; }
        .info-banner-2026 .separator-dot { opacity: 0.4; margin: 0 4px; }

        /* === AUTO-DETECTION REVENUS === */
        .revenus-section {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 1px solid #bbf7d0;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }
        .revenus-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            user-select: none;
        }
        .revenus-toggle h3 {
            font-size: 14px;
            font-weight: 600;
            color: #16a34a;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0;
        }
        .revenus-toggle .toggle-arrow {
            transition: transform 0.3s ease;
            font-size: 12px;
            color: #16a34a;
        }
        .revenus-toggle .toggle-arrow.open { transform: rotate(180deg); }
        .revenus-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, padding 0.3s ease;
            padding-top: 0;
        }
        .revenus-body.open {
            max-height: 500px;
            padding-top: 14px;
        }
        .revenus-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }
        @media (max-width: 600px) {
            .revenus-grid { grid-template-columns: 1fr; }
        }
        .revenus-grid label {
            font-size: 12px;
            font-weight: 500;
            color: #475569;
            margin-bottom: 4px;
            display: block;
        }
        .revenus-grid select, .revenus-grid input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 13px;
            background: white;
            transition: border-color 0.2s;
        }
        .revenus-grid select:focus, .revenus-grid input:focus {
            border-color: #16a34a;
            outline: none;
            box-shadow: 0 0 0 3px rgba(22, 163, 74, 0.1);
        }
        .profil-result {
            margin-top: 12px;
            padding: 10px 14px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            display: none;
            animation: fadeSlide 0.3s ease;
        }
        @keyframes fadeSlide {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .profil-result.show { display: block; }
        .profil-result.profil-bleu {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        .profil-result.profil-jaune {
            background: linear-gradient(135deg, #fef9c3, #fef08a);
            color: #92400e;
            border: 1px solid #fcd34d;
        }
        .profil-result.profil-violet {
            background: linear-gradient(135deg, #ede9fe, #ddd6fe);
            color: #5b21b6;
            border: 1px solid #c4b5fd;
        }
        .profil-result.profil-rose {
            background: linear-gradient(135deg, #fce7f3, #fbcfe8);
            color: #9d174d;
            border: 1px solid #f9a8d4;
        }

        /* === CEE DETAIL SECTION === */
        .cee-section {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border: 1px solid #93c5fd;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }
        .cee-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            user-select: none;
        }
        .cee-toggle h3 {
            font-size: 14px;
            font-weight: 600;
            color: #2563eb;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0;
        }
        .cee-toggle .toggle-arrow {
            transition: transform 0.3s ease;
            font-size: 12px;
            color: #2563eb;
        }
        .cee-toggle .toggle-arrow.open { transform: rotate(180deg); }
        .cee-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease, padding 0.3s ease;
            padding-top: 0;
        }
        .cee-body.open {
            max-height: 800px;
            padding-top: 14px;
        }
        .cee-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        @media (max-width: 600px) {
            .cee-grid { grid-template-columns: 1fr; }
        }
        .cee-grid label {
            font-size: 12px;
            font-weight: 500;
            color: #475569;
            margin-bottom: 4px;
            display: block;
        }
        .cee-grid select, .cee-grid input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 13px;
            background: white;
            transition: border-color 0.2s;
        }
        .cee-grid select:focus, .cee-grid input:focus {
            border-color: #2563eb;
            outline: none;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        .cee-result {
            margin-top: 12px;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 13px;
            text-align: center;
            display: none;
            animation: fadeSlide 0.3s ease;
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        .cee-result.show { display: block; }
        .cee-hint {
            font-size: 11px;
            color: #6b7280;
            margin-top: 4px;
        }
        .cee-bloc-171, .cee-bloc-148 {
            transition: all 0.3s ease;
        }
        .cee-hidden { display: none !important; }

        /* Isolation state radio buttons */
        .g-radio {
            display: flex; align-items: flex-start; gap: 12px; padding: 14px 16px;
            border: 1.5px solid #e2e8f0; border-radius: 10px; cursor: pointer;
            transition: all 0.15s ease; font-size: 13px; background: white;
        }
        .g-radio:hover { border-color: #a3cfbb; background: #f8fdfb; }
        .g-radio.selected { border-color: #16a34a; background: #f0fdf4; }
        .g-radio input[type="radio"] { accent-color: #16a34a; margin: 3px 0 0 0; width: 18px; height: 18px; flex-shrink: 0; }
        .g-label { flex: 1; }
        .g-label-title { font-weight: 600; color: #1d1d1f; font-size: 13px; }
        .g-label-sub { font-size: 11px; color: #94a3b8; margin-top: 2px; }
        .g-value { display: none; }

        /* Dim form */
        .dim-row { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-bottom: 16px; }
        .dim-field label { font-weight: 600; color: #1d1d1f; font-size: 13px; display: block; margin-bottom: 6px; }
        .dim-field .req { color: #dc2626; }
        .dim-field input, .dim-field select {
            width: 100%; padding: 10px 12px; border: 1.5px solid #e2e8f0; border-radius: 8px;
            font-size: 15px; font-weight: 500; color: #0f172a; background: white; transition: border-color 0.15s;
        }
        .dim-field input:focus, .dim-field select:focus { border-color: #16a34a; outline: none; box-shadow: 0 0 0 3px rgba(22,163,74,0.08); }
        .dim-field .dim-hint { font-size: 11px; color: #94a3b8; margin-top: 4px; }

        /* Confort slider */
        .confort-box { border: 1.5px solid #e2e8f0; border-radius: 10px; padding: 16px; }
        .confort-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .confort-val { font-size: 22px; font-weight: 700; color: #16a34a; }
        .confort-lbl { font-size: 14px; font-weight: 600; color: #334155; text-transform: uppercase; letter-spacing: 0.5px; }
        input.confort-slider { -webkit-appearance: none; appearance: none; width: 100%; height: 8px; border-radius: 4px; outline: none; margin: 8px 0; padding: 0; border: none;
            background: linear-gradient(to right, #fb923c, #16a34a 50%, #3b82f6); }
        input.confort-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 26px; height: 26px; border-radius: 50%; background: white; border: 3px solid #16a34a; cursor: pointer; box-shadow: 0 1px 6px rgba(0,0,0,0.15); }
        input.confort-slider::-moz-range-thumb { width: 26px; height: 26px; border-radius: 50%; background: white; border: 3px solid #16a34a; cursor: pointer; box-shadow: 0 1px 6px rgba(0,0,0,0.15); }
        .confort-labels { display: flex; justify-content: space-between; font-size: 11px; color: #94a3b8; margin-top: 2px; }
        .confort-desc { font-size: 12px; color: #64748b; margin-top: 10px; font-style: italic; }

        /* ===== PRODUIT & OPTIONS ===== */
        .produit-bloc {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 10px;
            padding: 14px;
        }
        .produit-bloc-head {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }
        .produit-bloc-icon {
            font-size: 18px;
            width: 32px;
            height: 32px;
            background: rgba(34,197,94,0.12);
            border-radius: 8px;
            display: grid;
            place-items: center;
        }
        .produit-bloc-title {
            font-size: 14px;
            font-weight: 700;
            color: #1d1d1f;
        }
        .produit-opt-section {
            display: none;
            margin-top: 8px;
            padding: 12px;
            background: rgba(255,255,255,0.7);
            border: 1px solid #d1fae5;
            border-radius: 8px;
            animation: prodOptIn 0.25s ease;
        }
        @keyframes prodOptIn {
            from { opacity: 0; transform: translateY(-4px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        #pacInfo b { color: #16a34a; }

        /* Isolation checklist */
        .iso-check {
            display: flex; align-items: center; gap: 10px; padding: 10px 14px;
            border: 1.5px solid #e2e8f0; border-radius: 8px; cursor: pointer;
            transition: all 0.15s ease; background: white;
        }
        .iso-check:hover { border-color: #a3cfbb; background: #f8fdfb; }
        .iso-check:has(input:checked) { border-color: #16a34a; background: #f0fdf4; }
        .iso-check input[type="checkbox"] { accent-color: #16a34a; width: 18px; height: 18px; flex-shrink: 0; cursor: pointer; }
        .iso-info { flex: 1; }
        .iso-title { font-weight: 600; color: #1d1d1f; font-size: 13px; display: block; }
        .iso-sub { font-size: 11px; color: #94a3b8; }
        .iso-quand {
            padding: 4px 8px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 11px;
            color: #64748b; background: #f8fafc; display: none; cursor: pointer;
        }
        .iso-check:has(input:checked) .iso-quand { display: block; }
        .cee-kpi-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 12px;
        }
        .cee-kpi {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px 12px;
            text-align: center;
        }
        .cee-kpi .kpi-label {
            font-size: 11px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        .cee-kpi .kpi-value {
            font-size: 16px;
            font-weight: 700;
            color: #1e40af;
        }
        .cee-kpi .kpi-value.green { color: #16a34a; }
        .cee-kpi .kpi-detail {
            font-size: 10px;
            color: #94a3b8;
            margin-top: 2px;
            font-family: ui-monospace, monospace;
        }

        .header {
            background: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
        }



        .btn-apply {
            flex: 1;
            background: #0071e3;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-apply:hover {
            background: #0077ed;
        }

        .btn-close-modal {
            background: #f5f5f7;
            color: #1d1d1f;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-close-modal:hover {
            background: #e8e8ed;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1.4fr 1fr;
            gap: 28px;
            padding: 30px 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 16px rgba(0,0,0,0.08);
        }

        .card-title {
            font-size: 12px;
            font-weight: 600;
            color: #86868b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
        }

        .form-group {
            margin-bottom: 14px;
        }

        .form-group label {
            display: block;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 5px;
            color: #1d1d1f;
        }

        .form-group small {
            display: block;
            font-size: 12px;
            color: #86868b;
            margin-top: 4px;
        }

        select, input[type="number"], input[type="text"] {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            font-size: 15px;
            background: white;
            transition: all 0.2s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #0071e3;
            box-shadow: 0 0 0 4px rgba(0,113,227,0.1);
        }

        .fournisseur-only {
            display: none;
        }

        .fournisseur-mode .fournisseur-only {
            display: block;
        }
        
        .fournisseur-mode .ttc-readonly {
            display: none !important;
        }

        .client-only {
            display: block;
        }

        .fournisseur-mode .client-only {
            display: none;
        }

        /* Telepro mode: like fournisseur but hides marge, dimensionnement, photo */
        .telepro-mode .fournisseur-only {
            display: block;
        }
        .telepro-mode .ttc-readonly {
            display: none !important;
        }
        .telepro-mode .client-only {
            display: none;
        }
        .telepro-mode .telepro-hide {
            display: none !important;
        }

        .results-sidebar {
            position: sticky;
            top: 100px;
            height: fit-content;
        }

        .summary-card {
            background: linear-gradient(165deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.25), 0 0 0 1px rgba(255,255,255,0.05);
            margin-bottom: 16px;
            position: relative;
            overflow: hidden;
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 3px;
            background: var(--scroll-gradient, linear-gradient(90deg, #34d399, #22d3ee, #818cf8));
            transition: background 0.4s ease;
        }

        .result-row-card {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 12px;
            padding: 14px 18px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.25s ease;
            position: relative;
            overflow: hidden;
        }
        .result-row-card:hover {
            background: rgba(255,255,255,0.07);
            border-color: rgba(255,255,255,0.12);
            transform: translateY(-1px);
        }
        .result-row-card .rrc-label {
            font-size: 13px;
            font-weight: 500;
            color: rgba(255,255,255,0.55);
            letter-spacing: 0.3px;
        }
        .result-row-card .rrc-value {
            font-size: 20px;
            font-weight: 700;
            color: #f1f5f9;
            font-variant-numeric: tabular-nums;
        }
        .result-row-card .rrc-value.green { color: #34d399; }
        .result-row-card .rrc-value.yellow { color: #fbbf24; }
        .result-row-card .rrc-value.red { color: #f87171; }
        .result-row-card .rrc-value.cyan { color: #22d3ee; }
        .result-row-card .rrc-value.blue { color: #60a5fa; }

        .result-highlight-card {
            background: linear-gradient(135deg, rgba(52,211,153,0.12) 0%, rgba(34,211,238,0.08) 100%);
            border: 1px solid rgba(52,211,153,0.2);
            border-radius: 14px;
            padding: 18px 22px;
            margin-bottom: 12px;
            text-align: center;
            position: relative;
        }
        .result-highlight-card .rhc-label {
            font-size: 12px;
            font-weight: 600;
            color: rgba(255,255,255,0.5);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }
        .result-highlight-card .rhc-value {
            font-size: 34px;
            font-weight: 800;
            color: #34d399;
            text-shadow: 0 0 30px rgba(52,211,153,0.3);
        }

        .glow-separator {
            height: 2px;
            margin: 16px 0;
            border-radius: 2px;
            background: var(--scroll-gradient, linear-gradient(90deg, #34d399, #22d3ee, #818cf8));
            opacity: 0.4;
            transition: opacity 0.3s, background 0.6s;
        }
        .glow-separator:hover { opacity: 0.7; }

        .dark-section-title {
            font-size: 11px;
            font-weight: 700;
            color: rgba(255,255,255,0.35);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 12px;
            padding-left: 2px;
        }

        .scenario-label-dark {
            font-size: 13px;
            color: rgba(255,255,255,0.8);
            margin-bottom: 18px;
            padding: 12px 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            border-left: 3px solid #34d399;
            line-height: 1.5;
            transition: border-color 0.4s;
        }
        .scenario-label-dark strong { font-weight: 600; color: #f1f5f9; }
        .scenario-label-dark .separator { color: rgba(255,255,255,0.3); margin: 0 8px; }

        .rac-dark-section {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 12px;
            padding: 16px;
        }
        .rac-dark-section .amount-label {
            color: rgba(255,255,255,0.45);
        }
        .rac-dark-section input[type="number"] {
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.12);
            color: #f1f5f9;
            font-size: 22px;
            font-weight: 700;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            transition: border-color 0.2s;
        }
        .rac-dark-section input[type="number"]:focus {
            border-color: #34d399;
            box-shadow: 0 0 0 3px rgba(52,211,153,0.15);
            outline: none;
        }
        .rac-dark-section .note-small { color: rgba(255,255,255,0.35); }

        .ttc-input-dark {
            font-size: 26px;
            font-weight: 700;
            text-align: right;
            padding: 0;
            margin: 0;
            width: 150px;
            border: none !important;
            border-radius: 0;
            background: none !important;
            background-color: transparent !important;
            -webkit-appearance: none;
            -moz-appearance: textfield;
            appearance: none;
            color: #60a5fa;
            color-scheme: dark;
            font-variant-numeric: tabular-nums;
            font-family: inherit;
            box-shadow: none !important;
        }
        .ttc-input-dark::-webkit-outer-spin-button,
        .ttc-input-dark::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .ttc-input-dark:focus {
            outline: none !important;
            border: none !important;
            box-shadow: none !important;
        }

        .btn-dark-export {
            width: 100%;
            border: 1px solid rgba(255,255,255,0.1);
            padding: 14px 20px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.05);
            color: rgba(255,255,255,0.6);
            letter-spacing: 0.3px;
        }
        .btn-dark-export:hover {
            background: rgba(255,255,255,0.12);
            color: white;
            border-color: rgba(255,255,255,0.2);
        }
        .btn-dark-export.pdf { }
        .btn-dark-export.whatsapp { }

        .summary-header {
            font-size: 12px;
            font-weight: 600;
            color: #86868b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .scenario-label {
            font-size: 13px;
            color: #1d1d1f;
            margin-bottom: 20px;
            padding: 14px;
            background: #f5f5f7;
            border-radius: 8px;
            border-left: 4px solid #0071e3;
            line-height: 1.5;
        }
        
        .scenario-label strong {
            font-weight: 600;
        }
        
        .scenario-label .separator {
            color: #86868b;
            margin: 0 8px;
        }
        
        .color-bleu { color: #0071e3; }
        .color-jaune { color: #fbbf24; }
        .color-violet { color: #8b5cf6; }
        .color-rose { color: #ec4899; }

        .amount-row {
            margin-bottom: 12px;
        }

        .amount-label {
            font-size: 12px;
            color: #86868b;
            margin-bottom: 4px;
        }

        .amount-value {
            font-size: 26px;
            font-weight: 700;
            color: #1d1d1f;
        }

        .amount-value.highlight {
            color: #34c759;
        }

        .rac-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 16px rgba(0,0,0,0.08);
        }

        .rac-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        .rac-item input {
            font-size: 22px;
            font-weight: 700;
            color: #1d1d1f;
            text-align: center;
            padding: 8px 10px;
        }

        .final-amount {
            text-align: right;
            padding-top: 20px;
            border-top: 2px solid #f5f5f7;
        }

        .final-amount .amount-label {
            font-size: 13px;
            color: #86868b;
            margin-bottom: 6px;
        }

        .final-amount .amount-value {
            font-size: 34px;
            font-weight: 700;
            color: #1d1d1f;
        }

        .status-badge {
            padding: 18px 24px;
            font-weight: 700;
            font-size: 15px;
            border-radius: 14px;
            text-align: center;
            width: 100%;
            letter-spacing: 0.3px;
            transition: all 0.3s;
            cursor: default;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .status-badge.ok {
            background: linear-gradient(135deg, #065f46, #059669);
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(5, 150, 105, 0.35);
        }
        .status-badge.ok:hover {
            box-shadow: 0 6px 28px rgba(5, 150, 105, 0.5);
            transform: translateY(-1px);
        }
        .status-badge.ok:active { transform: translateY(0); }
        .status-badge.danger {
            background: linear-gradient(135deg, #7f1d1d, #dc2626);
            color: white;
            box-shadow: 0 4px 16px rgba(220, 38, 38, 0.25);
        }

        .btn-reset {
            background: #f5f5f7;
            border: 1px solid #e5e7eb;
            padding: 8px;
            border-radius: 8px;
            font-size: 0;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .btn-reset:hover {
            background: #e8e8ed;
        }


        .footer {
            text-align: center;
            padding: 8px 20px 8px;
            color: #86868b;
            font-size: 13px;
        }

        @media print {
            #loginScreen, .header, .user-bar, .guest-bar, .btn-reset, .footer, .parameters-section, .main-content, .hist-overlay, #pwdModal {
                display: none !important;
            }
            
            #appScreen {
                display: block !important;
            }

            .tab-pac-active ~ #pacDevisArea,
            body:not(:has(.tab-ite-active)) #pacDevisArea {
                display: block !important;
            }
            body:not(:has(.tab-ite-active)) #printArea {
                display: none !important;
            }
            body:not(:has(.tab-ite-active)) #iteDevisArea {
                display: none !important;
            }
            .tab-ite-active ~ #iteDevisArea,
            body:has(.tab-ite-active) #iteDevisArea {
                display: block !important;
            }
            body:has(.tab-ite-active) #printArea {
                display: none !important;
            }
            body:has(.tab-ite-active) #pacDevisArea {
                display: none !important;
            }

            body {
                background: white;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            @page {
                margin: 10mm;
                size: A4;
            }
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .results-sidebar {
                position: static;
            }


        }

        .note-small {
            font-size: 11px;
            color: #86868b;
            text-align: center;
            margin-top: 8px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #86868b;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        /* ============ MOBILE ============ */
        @media (max-width: 600px) {
            html, body { overflow-x: hidden; }
            .header { padding: 8px 0; }
            .container { padding: 0 8px; }
            .header .container > div:first-child { margin-bottom: 4px; flex-wrap: wrap !important; gap: 8px !important; }
            .tab-buttons { order: 3; flex: 0 0 100%; justify-content: center; }
            .main-content { grid-template-columns: 1fr !important; }
            .user-bar { flex-wrap: wrap; gap: 5px; justify-content: center; }
            .user-bar .user-name { font-size: 11px; }
            .user-bar .user-role { font-size: 9px; padding: 1px 5px; }
            .user-bar .btn-hist, .user-bar .btn-logout { padding: 3px 7px; font-size: 10px; }
            .view-toggle { padding: 2px; width: 100%; }
            .view-toggle .toggle-opt { padding: 4px 8px; font-size: 10px; flex: 1; }
            .guest-bar { justify-content: center; }
            .guest-bar .btn-login-small { padding: 5px 10px; font-size: 11px; }
            .card { padding: 10px; margin-bottom: 10px; }
            .card-title { font-size: 13px; margin-bottom: 10px; }
            .parameters-section { padding: 6px; }
            .results-sidebar { padding: 6px; position: static; }
            .grid-3col { grid-template-columns: 1fr 1fr 1fr !important; gap: 6px !important; }
            .form-group label { font-size: 11px; }
            .form-group input, .form-group select { padding: 7px 8px; font-size: 12px; }
            /* Stack inline grids */
            .dossier-hero [style*="grid-template-columns"],
            #mprCeeWrapper [style*="grid-template-columns"],
            .card [style*="grid-template-columns"] { grid-template-columns: 1fr !important; }
            .dim-row { grid-template-columns: 1fr !important; }
            .rac-grid { grid-template-columns: 1fr !important; }
            .cee-kpi-row { grid-template-columns: 1fr !important; }
            #isoChecklist { grid-template-columns: 1fr !important; }
            .login-box { width: 90% !important; max-width: 340px; padding: 24px !important; box-sizing: border-box; }
            .dossier-hero { padding: 14px 12px !important; }
            .dossier-hero-row { flex-direction: column; }
            .dossier-hero-input { font-size: 14px !important; padding: 10px 12px !important; }
        }
        @media (max-width: 380px) {
            .grid-3col { grid-template-columns: 1fr 1fr !important; }
            .view-toggle .toggle-opt { padding: 3px 6px; font-size: 9px; }
        }

        /* LOGIN SCREEN */
        .login-container { display:flex; align-items:center; justify-content:center; min-height:100vh; background:linear-gradient(135deg, #0f172a 0%, #1e3a5f 40%, #134e4a 100%); padding: 20px; box-sizing: border-box; }
        .login-box { background:white; padding:40px; border-radius:16px; width:360px; max-width:100%; box-shadow:0 20px 60px rgba(0,0,0,0.3); box-sizing:border-box; }
        .login-box h2 { text-align:center; margin:0 0 6px; font-size:20px; }
        .login-box h2 span { color:#16a34a; }
        .login-box .login-sub { text-align:center; color:#6b7280; font-size:13px; margin-bottom:24px; }
        .login-box .form-group { margin-bottom:16px; }
        .login-box .form-group label { display:block; font-size:13px; font-weight:600; color:#374151; margin-bottom:6px; }
        .login-box .form-group input { width:100%; padding:10px 14px; border:1px solid #d1d5db; border-radius:8px; font-size:14px; box-sizing:border-box; }
        .login-box .form-group input:focus { border-color:#16a34a; outline:none; box-shadow:0 0 0 3px rgba(22,163,74,0.15); }
        .login-box .btn-login { width:100%; padding:12px; background:linear-gradient(135deg,#16a34a,#15803d); color:white; border:none; border-radius:8px; font-size:15px; font-weight:700; cursor:pointer; }
        .login-box .btn-login:hover { opacity:0.9; }
        .login-error { color:#dc2626; text-align:center; margin-top:12px; font-size:13px; display:none; }
        .login-logo { text-align:center; margin-bottom:20px; }
        .login-logo span { background:linear-gradient(135deg,#16a34a,#15803d); color:white; padding:10px 18px; border-radius:10px; font-weight:700; font-size:14px; display:inline-block; }

        /* USER BAR */
        .user-bar { display:flex; align-items:center; gap:8px; }
        .user-bar .user-name { font-size:12px; color:#6b7280; font-weight:600; }
        .user-bar .user-role { font-size:10px; color:white; background:#16a34a; padding:1px 6px; border-radius:4px; font-weight:600; }
        .user-bar .btn-hist { padding:4px 10px; font-size:11px; background:#f3f4f6; border:1px solid #d1d5db; border-radius:6px; cursor:pointer; font-weight:600; color:#374151; }
        .user-bar .btn-hist:hover { background:#e5e7eb; }
        .user-bar .btn-logout { padding:4px 10px; font-size:11px; background:#fef2f2; border:1px solid #fecaca; border-radius:6px; cursor:pointer; font-weight:600; color:#dc2626; }
        .user-bar .btn-logout:hover { background:#fee2e2; }
        .guest-bar { display:flex; align-items:center; gap:8px; }
        .guest-bar .btn-login-small { padding:6px 14px; font-size:12px; background:linear-gradient(135deg,#16a34a,#15803d); color:white; border:none; border-radius:6px; cursor:pointer; font-weight:600; }

        /* VIEW TOGGLE SWITCH */
        .view-toggle { display:flex; align-items:center; gap:8px; background:#f3f4f6; border-radius:8px; padding:3px; }
        .view-toggle .toggle-opt { padding:5px 12px; border-radius:6px; font-size:11px; font-weight:600; cursor:pointer; color:#6b7280; transition:all 0.2s; border:none; background:none; }
        .view-toggle .toggle-opt.active { background:white; color:#1f2937; box-shadow:0 1px 3px rgba(0,0,0,0.1); }
        .view-toggle .toggle-opt:hover:not(.active) { color:#374151; }

        /* HISTORY MODAL */
        .hist-overlay { display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:9999; justify-content:center; align-items:center; }
        .hist-overlay.active { display:flex; }
        .hist-modal { background:white; border-radius:14px; width:90%; max-width:500px; max-height:80vh; overflow:hidden; box-shadow:0 20px 60px rgba(0,0,0,0.3); }
        .hist-modal-header { padding:16px 20px; border-bottom:1px solid #e5e7eb; display:flex; justify-content:space-between; align-items:center; }
        .hist-modal-header h3 { margin:0; font-size:16px; }
        .hist-modal-close { background:none; border:none; font-size:22px; cursor:pointer; color:#6b7280; padding:0 4px; }
        .hist-modal-body { padding:16px 20px; overflow-y:auto; max-height:60vh; }
        .hist-entry { padding:10px 0; border-bottom:1px solid #f3f4f6; }
        .hist-entry:last-child { border-bottom:none; }
        .hist-meta { display:flex; gap:8px; align-items:center; margin-bottom:4px; }
        .hist-date { font-size:11px; color:#9ca3af; }
        .hist-user { font-size:11px; font-weight:700; color:#16a34a; }
        .hist-action { font-size:13px; color:#1f2937; }
        .hist-detail { font-size:11px; color:#6b7280; margin-top:2px; }
        .hist-empty { text-align:center; color:#9ca3af; padding:30px 0; }
        .hist-clear { margin-top:12px; text-align:center; }
        .hist-clear button { font-size:12px; color:#dc2626; background:none; border:1px solid #fecaca; padding:4px 12px; border-radius:6px; cursor:pointer; }

    
/* ============ TAB SYSTEM ============ */
.tab-btn {
    padding: 6px 16px;
    border-radius: 20px;
    border: 1.5px solid #d2d2d7;
    background: #f5f5f7;
    color: #86868b;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    font-family: inherit;
}
.tab-btn:hover { background: #e8e8ed; }
.tab-btn.active {
    background: #16a34a;
    color: white;
    border-color: #16a34a;
}
.tab-buttons { display: flex; gap: 6px; margin-right: 12px; }

/* Tab visibility */
.tab-pac-content { display: none; }
.tab-ite-content { display: none; }
.tab-pac-active .tab-pac-content { display: block; }
.tab-ite-active .tab-ite-content { display: block; }
/* For grid layouts in sidebar */
.tab-pac-active .tab-pac-content.sidebar-grid { display: block; }
.tab-ite-active .tab-ite-content.sidebar-grid { display: block; }

/* ============ ITE CARDS (light theme) ============ */
.ite-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 2px 16px rgba(0,0,0,0.08);
    margin-bottom: 16px;
}
.ite-card-head {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 16px;
    flex-wrap: wrap;
}
.ite-card-icon {
    font-size: 20px;
    width: 36px; height: 36px;
    background: rgba(22,163,74,0.08);
    border-radius: 10px;
    display: grid; place-items: center;
}
.ite-card-head h3 {
    font-size: 14px;
    font-weight: 700;
    color: #1d1d1f;
}
.ite-card-head .ite-tag {
    font-size: 9px;
    background: rgba(249,115,22,0.12);
    color: #f97316;
    padding: 3px 8px;
    border-radius: 12px;
    font-weight: 700;
    text-transform: uppercase;
    margin-left: auto;
}
.ite-card-head .ite-tag-auto {
    background: rgba(22,163,74,0.08);
    color: #16a34a;
}
.ite-fg {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
}
.ite-fg.c3 { grid-template-columns: 1fr 1fr 1fr; }
.ite-fi {
    display: flex;
    flex-direction: column;
    gap: 4px;
}
.ite-fi.full { grid-column: 1 / -1; }
.ite-fi label {
    font-size: 11px;
    color: #64748b;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.4px;
}
.ite-fi input, .ite-fi select {
    width: 100%;
    padding: 9px 12px;
    border: 1px solid #d2d2d7;
    border-radius: 8px;
    font-size: 14px;
    background: white;
    color: #1d1d1f;
    transition: border-color 0.2s;
}
.ite-fi input:focus, .ite-fi select:focus {
    outline: none;
    border-color: #16a34a;
    box-shadow: 0 0 0 3px rgba(22,163,74,0.1);
}
.ite-note { font-size: 11px; color: #86868b; margin-bottom: 12px; line-height: 1.5; }

/* ITE KPI row */
.ite-kpi-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
    gap: 10px;
    margin-bottom: 14px;
}
.ite-kpi {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 10px;
    padding: 14px;
    text-align: center;
}
.ite-kpi-icon { font-size: 18px; margin-bottom: 4px; }
.ite-kpi-val { font-size: 16px; font-weight: 800; color: #16a34a; }
.ite-kpi-val.red { color: #dc2626; }
.ite-kpi-label { font-size: 10px; color: #64748b; margin-top: 2px; }

/* ITE CEE table */
.ite-cee-table {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0;
    font-size: 12px;
}
.ite-cee-table th {
    background: rgba(22,163,74,0.08);
    color: #16a34a;
    padding: 8px 10px;
    text-align: left;
    font-weight: 700;
    font-size: 10px;
    text-transform: uppercase;
}
.ite-cee-table td {
    padding: 8px 10px;
    border-bottom: 1px solid #e2e8f0;
}
.ite-cee-table tr.active {
    background: rgba(22,163,74,0.04);
    border-left: 3px solid #16a34a;
}
.ite-cee-table .val {
    font-weight: 700;
    color: #16a34a;
    text-align: right;
}

/* ITE alerts */
.ite-alert {
    padding: 12px 16px;
    border-radius: 8px;
    margin: 10px 0;
    font-size: 12px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}
.ite-alert-ok { background: #f0fdf4; border: 1px solid #bbf7d0; color: #16a34a; }
.ite-alert-warn { background: #fef2f2; border: 1px solid #fecaca; color: #dc2626; }
.ite-alert-ptz { background: #eff6ff; border: 1px solid #bfdbfe; color: #2563eb; }

/* ITE search row */
.ite-search-row {
    display: flex;
    gap: 8px;
    align-items: flex-end;
}
.ite-search-row .ite-fi { flex: 1; }
.ite-btn-search {
    padding: 9px 16px;
    border-radius: 8px;
    background: #0071e3;
    color: white;
    font-size: 12px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    white-space: nowrap;
    height: 39px;
    transition: background 0.2s;
}
.ite-btn-search:hover { background: #0077ed; }
.ite-search-status {
    font-size: 11px;
    margin-top: 6px;
    padding: 6px 10px;
    border-radius: 6px;
    display: none;
}
.ite-search-status.ok { display: block; background: #f0fdf4; color: #16a34a; border: 1px solid #bbf7d0; }
.ite-search-status.err { display: block; background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; }
.ite-search-status.loading { display: block; background: #eff6ff; color: #2563eb; border: 1px solid #bfdbfe; }

/* === HERO RECHERCHE DOSSIER === */
.dossier-hero {
    background: linear-gradient(135deg, #0f172a 0%, #1a2e4a 50%, #0d3321 100%);
    border-radius: 14px;
    padding: 22px 20px 18px;
    margin-bottom: 18px;
    position: relative;
    overflow: hidden;
}
.dossier-hero::before {
    content: '';
    position: absolute;
    top: -30px; right: -30px;
    width: 120px; height: 120px;
    background: radial-gradient(circle, rgba(52,211,153,0.12) 0%, transparent 70%);
    border-radius: 50%;
}
.dossier-hero-label {
    font-size: 10px;
    font-weight: 700;
    color: rgba(255,255,255,0.4);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 4px;
}
.dossier-hero-title {
    font-size: 16px;
    font-weight: 800;
    color: white;
    margin-bottom: 2px;
}
.dossier-hero-sub {
    font-size: 11px;
    color: rgba(255,255,255,0.35);
    margin-bottom: 14px;
}
.dossier-hero-row {
    display: flex;
    gap: 8px;
    align-items: stretch;
}
.dossier-hero-input {
    flex: 1;
    padding: 13px 16px;
    border: 1.5px solid rgba(255,255,255,0.12) !important;
    border-radius: 10px;
    background: rgba(255,255,255,0.07) !important;
    background-color: rgba(255,255,255,0.07) !important;
    color: white !important;
    font-size: 17px;
    font-weight: 700;
    letter-spacing: 1.5px;
    font-family: ui-monospace, 'SF Mono', monospace;
    transition: all 0.2s;
}
.dossier-hero-input::placeholder { color: rgba(255,255,255,0.2); }
.dossier-hero-input:focus {
    outline: none;
    border-color: #34d399;
    background: rgba(52,211,153,0.07);
    box-shadow: 0 0 0 3px rgba(52,211,153,0.12);
}
.dossier-hero-btn {
    padding: 13px 20px;
    border-radius: 10px;
    background: linear-gradient(135deg, #16a34a, #15803d);
    color: white;
    font-size: 13px;
    font-weight: 700;
    border: none;
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.2s;
    box-shadow: 0 2px 10px rgba(22,163,74,0.4);
}
.dossier-hero-btn:hover {
    background: linear-gradient(135deg, #15803d, #14532d);
    transform: translateY(-1px);
    box-shadow: 0 4px 14px rgba(22,163,74,0.5);
}
.dossier-hero-btn:active { transform: translateY(0); }
.dossier-hero-status {
    margin-top: 10px;
    font-size: 12px;
    font-weight: 600;
    padding: 8px 12px;
    border-radius: 8px;
    display: none;
}
.dossier-hero-status.ok {
    display: block;
    background: rgba(52,211,153,0.12);
    color: #34d399;
    border: 1px solid rgba(52,211,153,0.25);
}
.dossier-hero-status.err {
    display: block;
    background: rgba(239,68,68,0.1);
    color: #f87171;
    border: 1px solid rgba(239,68,68,0.2);
}
.dossier-hero-status.loading {
    display: block;
    background: rgba(96,165,250,0.1);
    color: #60a5fa;
    border: 1px solid rgba(96,165,250,0.2);
}
/* Champs du hero en dark */
.dossier-hero .form-group label {
    color: rgba(255,255,255,0.55);
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.4px;
}
.dossier-hero .form-group input,
.dossier-hero .form-group select {
    background: rgba(255,255,255,0.07) !important;
    background-color: rgba(255,255,255,0.07) !important;
    color: white !important;
    border: 1px solid rgba(255,255,255,0.12) !important;
    border-radius: 8px;
}
.dossier-hero .form-group input::placeholder { color: rgba(255,255,255,0.25) !important; }
.dossier-hero .form-group input:focus,
.dossier-hero .form-group select:focus {
    border-color: #34d399 !important;
    outline: none;
    box-shadow: 0 0 0 2px rgba(52,211,153,0.15) !important;
}
.dossier-hero .form-group select option { background: #1e293b; color: white; }
.dossier-hero-divider {
    border: none;
    border-top: 1px solid rgba(255,255,255,0.1);
    margin: 16px 0;
}
/* Picker doublons */
.dossier-picker-title {
    font-size: 11px;
    font-weight: 700;
    color: rgba(255,255,255,0.45);
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin-bottom: 8px;
}
.dossier-picker-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.1);
    background: rgba(255,255,255,0.05);
    cursor: pointer;
    transition: all 0.15s ease;
    margin-bottom: 6px;
}
.dossier-picker-item:hover {
    background: rgba(52,211,153,0.12);
    border-color: rgba(52,211,153,0.3);
}
.dossier-picker-num {
    font-size: 12px;
    font-weight: 800;
    color: #34d399;
    font-family: ui-monospace, monospace;
    white-space: nowrap;
}
.dossier-picker-name {
    font-size: 13px;
    font-weight: 600;
    color: white;
    flex: 1;
}
.dossier-picker-tel {
    font-size: 11px;
    color: rgba(255,255,255,0.4);
    white-space: nowrap;
}
/* Statut de recherche Ã  l'intÃ©rieur du hero */
.dossier-hero .ite-search-status {
    background: rgba(52,211,153,0.12) !important;
    color: #34d399 !important;
    border: 1px solid rgba(52,211,153,0.25) !important;
}
.dossier-hero .ite-search-status.err {
    background: rgba(239,68,68,0.1) !important;
    color: #f87171 !important;
    border-color: rgba(239,68,68,0.2) !important;
}
.dossier-hero .ite-search-status.loading {
    background: rgba(96,165,250,0.1) !important;
    color: #60a5fa !important;
    border-color: rgba(96,165,250,0.2) !important;
}

/* ITE QR block */
.ite-qr-block {
    display: flex;
    align-items: center;
    gap: 10px;
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 10px;
    padding: 10px 14px;
}
.ite-qr-label { font-size: 10px; color: #64748b; line-height: 1.4; }
.ite-qr-label b { color: #2563eb; }

/* ITE devis print styles */
.ite-page { width: 210mm; min-height: 297mm; margin: 20px auto; padding: 10mm 12mm 20mm; background: #fff; position: relative; font-family: Arial, Helvetica, sans-serif; font-size: 8.5pt; color: #111; line-height: 1.45; }
.ite-page .dv-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 6mm; }
.ite-page .dv-title { display: flex; justify-content: space-between; border-bottom: 2px solid #000; padding-bottom: 2mm; margin-bottom: 3mm; }
.ite-page .dv-title span { font-size: 12pt; font-weight: 900; }
.ite-page .dv-info { display: grid; grid-template-columns: 1fr 1fr; gap: 0 6mm; margin-bottom: 4mm; font-size: 8pt; line-height: 1.6; }
.ite-page .dv-th { display: grid; grid-template-columns: 1fr 50px 72px 72px 48px; border-bottom: 2px solid #000; padding: 2mm 0 1mm; margin-bottom: 2mm; }
.ite-page .dv-th div { font-size: 10pt; font-weight: 900; }
.ite-page .dv-th .r { text-align: right; }
.ite-page .dv-th .c { text-align: center; }
.ite-page .dv-block { margin-bottom: 3mm; font-size: 8pt; line-height: 1.55; }
.ite-page .dv-row { display: grid; grid-template-columns: 1fr 50px 72px 72px 48px; border-top: 1.5px solid #333; border-bottom: 1.5px solid #333; padding: 1.5mm 0; margin: 2mm 0 1mm; }
.ite-page .dv-row div { font-size: 8pt; }
.ite-page .dv-row .n { font-weight: 700; }
.ite-page .dv-row .r { text-align: right; font-weight: 600; }
.ite-page .dv-row .c { text-align: center; }
.ite-page .dv-specs { font-size: 7.5pt; line-height: 1.55; margin-bottom: 3mm; padding-left: 2mm; }
.ite-page .dv-cond { font-size: 7.5pt; line-height: 1.5; margin-bottom: 3mm; }
.ite-page .dv-cond h4 { font-weight: 700; font-size: 8pt; margin-bottom: 1mm; }
.ite-page .dv-totaux { display: flex; gap: 6mm; margin-top: 4mm; }
.ite-page .dv-sig { border: 1px solid #999; padding: 4mm; font-size: 7.5pt; flex: 1; min-height: 32mm; }
.ite-page .dv-tt { font-size: 8pt; min-width: 200px; border-collapse: collapse; }
.ite-page .dv-tt td { padding: 1.5px 4px; }
.ite-page .dv-tt td:last-child { text-align: right; font-weight: 600; }
.ite-page .dv-tt .ttc td { font-size: 10pt; font-weight: 900; border-top: 1px solid #333; padding-top: 3px; }
.ite-page .dv-tt .reste td { color: #c00; font-size: 10pt; font-weight: 900; border-top: 1px solid #c00; padding-top: 3px; }
.ite-page .dv-footer { position: absolute; bottom: 5mm; left: 12mm; right: 12mm; border-top: 1px solid #ccc; padding-top: 1.5mm; font-size: 5pt; color: #444; text-align: center; line-height: 1.4; }
.ite-page .dv-pn { position: absolute; right: 0; bottom: 0; font-weight: 700; font-size: 9pt; }
.ite-page .dv-legal { font-size: 6.5pt; line-height: 1.45; color: #333; margin-top: 4mm; }
.ite-page .dv-finance { font-size: 8pt; line-height: 1.6; margin-top: 4mm; }

/* Print: updated for tab system */
@media print {
    .tab-pac-active #pacDevisArea { display: block !important; }
    .tab-pac-active #printArea { display: none !important; }
    .tab-pac-active #iteDevisArea { display: none !important; }
    .tab-ite-active #iteDevisArea { display: block !important; }
    .tab-ite-active #printArea { display: none !important; }
    .tab-ite-active #pacDevisArea { display: none !important; }
}

/* Shared client card */
.shared-client-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 2px 16px rgba(0,0,0,0.08);
    margin-bottom: 16px;
}
@media (max-width: 700px) {
    .ite-fg { grid-template-columns: 1fr; }
    .ite-fg.c3 { grid-template-columns: 1fr; }
    .ite-kpi-row { grid-template-columns: 1fr 1fr; gap: 8px; }
    .ite-kpi { padding: 10px; }
    .ite-kpi-val { font-size: 14px; }
    .ite-search-row { flex-direction: column; }
    .ite-btn-search { width: 100%; }
    .ite-qr-block { flex-direction: column; text-align: center; }
    .ite-card { padding: 14px; margin-bottom: 12px; }
    .ite-card-head h3 { font-size: 13px; }
    .ite-card-head .ite-tag { margin-left: 0; }
    .ite-cee-table { font-size: 11px; display: block; overflow-x: auto; }
}

    </style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.2/jspdf.umd.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.2/html2pdf.bundle.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous"></script>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen" class="login-container">
    <div class="login-box">
        <div class="login-logo"><span>&#127968; LES ARTISANS VERTS</span></div>
        <h2>Simulateur <span>PAC 2026</span></h2>
        <p class="login-sub">Connexion commerciale</p>
        <div class="form-group"><label>Nom d'utilisateur</label><input type="text" id="loginUser" placeholder="Utilisateur" autofocus></div>
        <div class="form-group"><label>Mot de passe</label><input type="password" id="loginPass" placeholder="Mot de passe"></div>
        <button class="btn-login" onclick="doLogin()">Se connecter</button>
        <p id="loginError" class="login-error"></p>
        <div style="margin-top:20px;padding-top:18px;border-top:1px solid #e5e7eb;text-align:center;">
            <p style="color:#9ca3af;font-size:12px;margin-bottom:10px;">Pas de compte ?</p>
            <button onclick="doGuestLogin()" style="width:100%;padding:11px;background:#f3f4f6;color:#374151;border:1px solid #d1d5db;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;">&#128100; Continuer en vue client</button>
        </div>
    </div>
</div>

<!-- HISTORY MODAL -->
<div id="historyModal" class="hist-overlay" onclick="if(event.target===this)this.classList.remove('active')">
    <div class="hist-modal">
        <div class="hist-modal-header">
            <h3>&#128203; Journal des modifications</h3>
            <button class="hist-modal-close" onclick="document.getElementById('historyModal').classList.remove('active')">&times;</button>
        </div>
        <div class="hist-modal-body" id="historyBody"></div>
    </div>
</div>

<!-- PASSWORD CHANGE MODAL -->
<div id="pwdModal" class="hist-overlay" onclick="if(event.target===this)this.classList.remove('active')">
    <div class="hist-modal" style="max-width:380px;">
        <div class="hist-modal-header">
            <h3>&#128273; Changer mon mot de passe</h3>
            <button class="hist-modal-close" onclick="document.getElementById('pwdModal').classList.remove('active')">&times;</button>
        </div>
        <div class="hist-modal-body">
            <div style="margin-bottom:14px;">
                <label style="display:block;font-size:13px;font-weight:600;color:#374151;margin-bottom:4px;">Ancien mot de passe</label>
                <input type="password" id="pwdOld" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;box-sizing:border-box;">
            </div>
            <div style="margin-bottom:14px;">
                <label style="display:block;font-size:13px;font-weight:600;color:#374151;margin-bottom:4px;">Nouveau mot de passe</label>
                <input type="password" id="pwdNew" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;box-sizing:border-box;">
            </div>
            <div style="margin-bottom:14px;">
                <label style="display:block;font-size:13px;font-weight:600;color:#374151;margin-bottom:4px;">Confirmer</label>
                <input type="password" id="pwdConfirm" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;box-sizing:border-box;">
            </div>
            <button onclick="doChangePassword()" style="width:100%;padding:12px;background:linear-gradient(135deg,#16a34a,#15803d);color:white;border:none;border-radius:8px;font-size:14px;font-weight:700;cursor:pointer;">Modifier</button>
            <p id="pwdError" style="color:#dc2626;text-align:center;margin-top:10px;font-size:13px;display:none;"></p>
            <p id="pwdSuccess" style="color:#16a34a;text-align:center;margin-top:10px;font-size:13px;display:none;"></p>
        </div>
    </div>
</div>

<!-- APP (hidden until login) -->
<div id="appScreen" style="display:none;">
    <div class="header">
        <div class="container">
            <!-- Row 1: Logo + Title + Refresh -->
            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:8px;">
                <div style="display:flex; align-items:center; gap:10px;">
                    <div style="background:linear-gradient(135deg,#16a34a,#15803d); color:white; padding:8px 12px; border-radius:8px; font-weight:700; font-size:13px; letter-spacing:0.3px; box-shadow:0 2px 8px rgba(22,163,74,0.3);">&#127968; LAV</div>
                    <div style="font-size:16px; font-weight:700; color:#1d1d1f; line-height:1.2;">Simulateur <span style="font-size:11px; background:#16a34a; color:white; padding:1px 6px; border-radius:4px; vertical-align:middle;">2026</span></div>
                </div>
                <div class="tab-buttons">
                    <button class="tab-btn active" id="tabPAC" onclick="switchTab('pac')">PAC</button>
                    <button class="tab-btn" id="tabITE" onclick="switchTab('ite')">ITE</button>
                </div>
                <button class="btn-reset" onclick="reset()" title="RafraÃ®chir"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg></button>
            </div>
            <!-- Row 2: User controls -->
            <!-- GUEST BAR -->
            <div class="guest-bar" id="guestBar" style="display:none;">
                <button class="btn-login-small" onclick="goToLogin()">&#128273; Se connecter</button>
            </div>
            <!-- USER BAR -->
            <div class="user-bar" id="userBar" style="display:none;">
                <span class="user-name" id="userNameDisplay">&mdash;</span>
                <span class="user-role" id="userRoleDisplay">&mdash;</span>
                <div class="view-toggle" id="viewToggle">
                    <button class="toggle-opt active" id="togClient" onclick="switchView('client')">&#128100; Client</button>
                    <button class="toggle-opt" id="togTelepro" onclick="switchView('telepro')">&#128222; Telepro</button>
                    <button class="toggle-opt" id="togFournisseur" onclick="switchView('fournisseur')">&#128202; Pro</button>
                </div>
                <button class="btn-hist" id="btnHistory" onclick="openHistory()" style="display:none;">&#128203;</button>
                <button class="btn-hist" id="btnPwd" onclick="openPwdModal()" style="display:none;">&#128273;</button>
                <button class="btn-logout" onclick="doLogout()">&#8618;</button>
            </div>
        </div>
    </div>

    <div class="main-content tab-pac-active" id="mainContent">
        <div class="parameters-section">
            <div class="card">
                <h2 class="card-title">Param&egrave;tres</h2>

                <!-- ===== HERO RECHERCHE DOSSIER ===== -->
                <div class="dossier-hero">
                    <div class="dossier-hero-label">&#128194; Informations client</div>
                    <div class="dossier-hero-title">Informations client</div>
                    <div class="dossier-hero-sub">Saisissez un t&eacute;l ou un n&deg; de dossier</div>
                    <div class="dossier-hero-row">
                        <input
                            id="iteNumClient"
                            class="dossier-hero-input"
                            type="text"
                            value=""
                            placeholder="AVR-202XX ou 06..."
                            autocomplete="off"
                            spellcheck="false"
                            onkeydown="if(event.key==='Enter'){event.preventDefault();ite_searchClient();}"
                        >
                        <button id="iteBtnSearch" class="dossier-hero-btn" onclick="ite_searchClient()">&#128269;&nbsp;Chercher</button>
                    </div>
                    <div id="iteSearchStatus" class="ite-search-status" style="margin-top:10px;"></div>
                    <!-- Picker doublons -->
                    <div id="dossierPickerList" style="display:none;margin-top:10px;"></div>

                    <!-- Champs client (PAC + ITE) -->
                    <div style="margin-top:16px;">
                        <hr class="dossier-hero-divider">
                        <!-- Nom + PrÃ©nom en premier -->
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
                            <div class="form-group" style="margin-bottom:0;">
                                <label>Nom</label>
                                <input type="text" id="nom" placeholder="Nom du client" oninput="checkExport()" onchange="logClientChange()">
                            </div>
                            <div class="form-group" style="margin-bottom:0;">
                                <label>Pr&eacute;nom</label>
                                <input type="text" id="prenom" placeholder="Pr&eacute;nom du client" oninput="checkExport()" onchange="logClientChange()">
                            </div>
                        </div>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
                            <div class="form-group" style="margin-bottom:0;">
                                <label>Adresse travaux</label>
                                <input type="text" id="iteAdresse" placeholder="123 rue...">
                            </div>
                            <div class="form-group" style="margin-bottom:0;">
                                <label>CP + Ville</label>
                                <input type="text" id="iteVille" placeholder="75000 Paris">
                            </div>
                        </div>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
                            <div class="form-group" style="margin-bottom:0;">
                                <label>T&eacute;l&eacute;phone</label>
                                <input type="text" id="iteTel" placeholder="06...">
                            </div>
                            <div class="form-group" style="margin-bottom:0;">
                                <label>E-mail</label>
                                <input type="text" id="iteEmail" placeholder="client@email.com">
                            </div>
                        </div>
                        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:12px;">
                            <div class="form-group" style="margin-bottom:0;">
                                <label>N&deg; Devis</label>
                                <input type="text" id="iteNumDevis" value="AVR-2026-">
                            </div>
                            <div class="form-group" style="margin-bottom:0;">
                                <label>Date</label>
                                <input type="date" id="iteDateDevis" value="2026-02-26">
                            </div>
                            <div class="form-group" style="margin-bottom:0;">
                                <label>Commercial</label>
                                <select id="iteConseiller"><option value="">&mdash; S&eacute;lectionner &mdash;</option><option>&Agrave; d&eacute;finir</option></select>
                            </div>
                        </div>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
                            <div class="form-group" style="margin-bottom:0;">
                                <label>Chauffage actuel</label>
                                <select id="iteTypeChauffage">
                                        <option value="Gaz">Gaz naturel</option>
                                        <option value="Fioul">Fioul</option>
                                        <option value="Ã‰lectrique">Ã‰lectrique</option>
                                        <option value="Bois">Bois / GranulÃ©s</option>
                                        <option value="PAC">Pompe Ã  chaleur</option>
                                        <option value="Autre">Autre</option>
                                    </select>
                            </div>
                            <div class="form-group" style="margin-bottom:0;">
                                <label>Pr&eacute;carit&eacute; CEE (auto)</label>
                                <select id="itePrecarite" onchange="ite_calc()">
                                    <option value="classique">Classique</option>
                                    <option value="modeste">Modeste</option>
                                    <option value="grande">Grande pr&eacute;carit&eacute;</option>
                                </select>
                            </div>
                        </div>
                        <!-- DÃ©partement + Surface + RFR + Foyer -->
                        <div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:12px;">
                            <div class="form-group" style="margin-bottom:0;">
                                <label for="departement">D&eacute;partement</label>
                                <input type="text" id="departement" placeholder="Ex: 33, 75&hellip;" maxlength="3" style="text-align:center;font-weight:600;" oninput="detectDept()">
                            </div>
                            <div class="form-group" style="margin-bottom:0;">
                                <label for="surfaceClient">Surface (m&sup2;)</label>
                                <input type="number" id="surfaceClient" placeholder="Ex: 95" min="1" style="font-weight:600;" oninput="syncSurfaceFromClient()">
                            </div>
                            <div class="form-group" style="margin-bottom:0;">
                                <label for="rfr">Revenu fiscal (&euro;)</label>
                                <input type="number" id="rfr" placeholder="Ex: 35 000" oninput="detectProfil()" style="font-weight:600;">
                            </div>
                            <div class="form-group" style="margin-bottom:0;">
                                <label for="nbPersonnes">Foyer</label>
                                <select id="nbPersonnes" onchange="detectProfil()">
                                    <option value="1">1 pers.</option>
                                    <option value="2">2 pers.</option>
                                    <option value="3">3 pers.</option>
                                    <option value="4" selected>4 pers.</option>
                                    <option value="5">5 pers.</option>
                                    <option value="6">6 pers.</option>
                                    <option value="7">7 pers.</option>
                                    <option value="8">8 pers.</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hidden: auto-gÃ©rÃ©s -->
                <select id="zone" onchange="calc()" style="display:none;">
                    <option value="H1">H1</option><option value="H2">H2</option><option value="H3">H3</option>
                </select>
                <span id="deptZoneResult" style="display:none;"></span>
                <select id="region" onchange="detectProfil()" style="display:none;">
                    <option value="PROVINCE">Province</option><option value="IDF">IDF</option>
                </select>
                <input type="hidden" id="typeLogement" value="maison">
                <select id="surface" style="display:none;">
                    <option value="S<70">S &lt; 70 mÂ²</option>
                    <option value="70<=S<90">70 &le; S &lt; 90 mÂ²</option>
                    <option value="S>=90" selected>S &ge; 90 mÂ²</option>
                </select>
                <select id="categorie" style="display:none;">
                    <option value="BLEU">BLEU</option><option value="JAUNE">JAUNE</option>
                    <option value="VIOLET">VIOLET</option><option value="ROSE">ROSE</option>
                </select>

                <!-- ===== BLOC RÃ‰SULTAT MPR + CEE (MPR masquÃ©) ===== -->
                <div id="mprCeeWrapper" style="margin-top: 14px; border-radius: 14px; padding: 20px; background: linear-gradient(160deg, #0f172a 0%, #1e3a5f 40%, #134e4a 100%); color: white;">

                <!-- Bloc rÃ©sultat MPR â€” masquÃ© -->
                <div id="mprResultBloc" style="display: none !important;">
                    <div id="mprProfilIcon"></div>
                    <div id="mprProfilLabel"></div>
                    <div id="mprProfilDesc"></div>
                    <div id="mprInfoRegion"></div>
                    <div id="mprInfoFoyer"></div>
                    <div id="mprInfoSeuil"></div>
                    <div id="mprInfoRFR"></div>
                    <div id="mprInfoAide"></div>
                </div>

                

            </div><!-- end shared client card -->

            <!-- ===== PAC-SPECIFIC PARAMETERS (hidden â€” calc fields only) ===== -->
            <div class="tab-pac-content" style="display:none;">
            <div class="card">
                <h2 class="card-title">&#9889; Aides CEE</h2>
<!-- Scenario & ETAS hidden (auto-derived from Produit & Options) -->
                <div style="display:none;">
                    <select id="scenario" onchange="onScenarioChange()">
                        <option value="PAC">PAC</option>
                        <option value="PAC + BALLON Ã‰LECTRIQUE">PAC + BALLON Ã‰LECTRIQUE</option>
                        <option value="PAC + BALLON THERMO">PAC + BALLON THERMO</option>
                        <option value="PAC + SSC">PAC + SSC</option>
                        <option value="SSC">SSC</option>
                    </select>
                    <select id="etas" onchange="syncEtas(); calc()">
                        <option value="111-140">111 &lt; ETAS &lt; 140</option>
                        <option value="140-170" selected>140 &lt; ETAS &lt; 170</option>
                    </select>
                    <div id="etasGroup"></div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                    <div class="form-group" style="margin-bottom: 0;" id="ceeSurfaceGroup">
                        <label style="color: rgba(255,255,255,0.7);">Surface chauffÃ©e (mÂ²)</label>
                        <input type="number" id="ceeSurface" min="1" step="1" value="95" oninput="syncSurfaces('cee')">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label style="color: rgba(255,255,255,0.7);">ScÃ©nario auto</label>
                        <input type="text" id="scenarioAutoDisplay" disabled value="PAC" style="background: rgba(255,255,255,0.05); color: #fbbf24; font-weight: 600; border: 1px solid rgba(255,255,255,0.1);">
                    </div>
                </div>

                <!-- Fiches info (hidden) -->
                <div style="display:none;">
                    Fiches : <strong id="ceeFichesLabel">BAR-TH-171</strong>
                    <span id="ceeNonCumulNote"></span>
                </div>

                <!-- Hidden fields for JS -->
                <span id="ceeScenarioLabel" style="display:none;">PAC</span>
                <select id="ficheCEE" style="display:none;" onchange="toggleCEEBlocs(); calcCEEDetail();">
                    <option value="171">BAR-TH-171</option>
                    <option value="143">BAR-TH-143</option>
                    <option value="148">BAR-TH-148</option>
                </select>
                <select id="ceeEtas" style="display:none;">
                    <option value="lt140">lt140</option>
                    <option value="ge140" selected>ge140</option>
                </select>
                <div style="display:none;">
                    <select id="menageCEE" onchange="calcCEEDetail()">
                        <option value="tm">TrÃ¨s modestes (12,5 &euro;/MWhc)</option>
                        <option value="autres">Autres mÃ©nages (7,5 &euro;/MWhc)</option>
                    </select>
                    <input type="text" id="ceeCoefSurface" disabled value="&mdash;">
                    <div id="ceeSurfaceInfo"></div>
                </div>

                <!-- KPI CEE -->
                <div class="cee-kpi-row" style="grid-template-columns: 1fr 1fr; margin-top: 4px;">
                    <div class="cee-kpi" style="background: rgba(255,255,255,0.08); border-color: rgba(255,255,255,0.1);">
                        <div class="kpi-label" style="color: rgba(255,255,255,0.6);">Volume CEE</div>
                        <div class="kpi-value" id="ceeOutKwhc" style="color: #fbbf24;">&mdash;</div>
                    </div>
                    <div class="cee-kpi" style="background: rgba(255,255,255,0.08); border-color: rgba(255,255,255,0.1);">
                        <div class="kpi-label" style="color: rgba(255,255,255,0.6);">Prime CEE</div>
                        <div class="kpi-value" id="ceeOutPrime" style="color: #34d399;">&mdash;</div>
                    </div>
                </div>
                <!-- DÃ©tail fournisseur -->
                <div class="fournisseur-only" style="margin-top: 4px; font-size: 11px; color: rgba(255,255,255,0.4); font-family: ui-monospace, monospace;">
                    <span id="ceeOutDetail">&mdash;</span> Â· <span id="ceeOutPrix">&mdash;</span>
                </div>

                </div><!-- /mprCeeWrapper -->

                <!-- Blocs fournisseur dÃ©tail -->
                <div class="fournisseur-only">
                    <div class="cee-bloc-171" id="ceeBloc171" style="display:none;"></div>
                    <div class="cee-bloc-148 cee-hidden" id="ceeBloc148" style="margin-top: 8px;">
                        <div class="cee-grid">
                            <div>
                                <label>Forfait BAR-TH-148 (kWhc)</label>
                                <input type="number" id="ceeKwhc148" min="0" step="100" value="9000" oninput="calcCEEDetail()">
                            </div>
                            <div>
                                <label>Forfait calculÃ©</label>
                                <input type="text" id="cee148Forfait" disabled value="&mdash;" style="background: #f1f5f9; font-weight: 600;">
                            </div>
                            <div>
                                <label>Note interne</label>
                                <input type="text" id="ceeNote148" placeholder="COP, volume ballon, marque..." oninput="calcCEEDetail()">
                            </div>
                        </div>
                    </div>
                    <div id="ceeBloc143" class="cee-hidden" style="margin-top: 8px;">
                        <div style="font-size: 12px; font-weight: 600; color: #2563eb; margin-bottom: 8px;">&#128217; BAR-TH-143 &mdash; SSC Â· <span style="color: #059669;">Coup de pouce &times;2</span></div>
                        <div class="cee-grid">
                            <div>
                                <label>Forfait par zone</label>
                                <input type="text" id="cee143Forfait" disabled value="&mdash;" style="background: #f1f5f9; font-weight: 600;">
                                <div class="cee-hint">H1: 134 800 Â· H2: 121 000 Â· H3: 100 500 kWhc</div>
                            </div>
                        </div>
                    </div>
                    <div class="cee-kpi-row" style="grid-template-columns: 1fr; margin-top: 8px;">
                        <div class="cee-kpi" id="ceeKpi148" style="display:none;">
                            <div class="kpi-label">Dont BAR-TH-148</div>
                            <div class="kpi-value" id="ceeOut148" style="color: #059669;">&mdash;</div>
                            <div class="kpi-detail" id="ceeOut148Detail">&mdash;</div>
                        </div>
                    </div>
                    <div class="cee-result" id="ceeResult"></div>
                </div>

                <div id="calcErrorDebug" style="color: red; font-size: 12px; font-weight: 600; margin-top: 8px; padding: 6px; background: #fef2f2; border-radius: 6px;"></div>
            </div>
            </div><!-- end tab-pac-content for params -->

            <!-- ===================== PRODUIT & OPTIONS ===================== -->
            <div class="tab-pac-content">
            <div class="card" id="produitCard">
                <h2 class="card-title">&#9881;&#65039; Produit & Options</h2>

                <!-- PAC Air/Eau -->
                <div class="produit-bloc">
                    <div class="produit-bloc-head">
                        <span class="produit-bloc-icon">&#9881;&#65039;</span>
                        <span class="produit-bloc-title">Pompe &agrave; Chaleur Air/Eau</span>
                    </div>
                    <div class="form-group" style="margin-bottom: 10px;">
                        <label>Mod&egrave;le PAC</label>
                        <select id="marquePAC" onchange="updatePAC();syncEtasFromPAC();calc();calcCEEDetail()">
                            <option value="">-- S&eacute;lectionner un mod&egrave;le --</option>
                            <optgroup label="THALEOS Mono">
                                <option value="THALEOS_04M">THALEOS 4kW Mono</option>
                                <option value="THALEOS_06M">THALEOS 6kW Mono</option>
                                <option value="THALEOS_08M">THALEOS 8kW Mono</option>
                                <option value="THALEOS_10M">THALEOS 10kW Mono</option>
                                <option value="THALEOS_12M">THALEOS 12kW Mono</option>
                                <option value="THALEOS_14M">THALEOS 14kW Mono</option>
                                <option value="THALEOS_16M">THALEOS 16kW Mono</option>
                            </optgroup>
                            <optgroup label="THALEOS Tri">
                                <option value="THALEOS_08T">THALEOS 8kW Tri</option>
                                <option value="THALEOS_10T">THALEOS 10kW Tri</option>
                                <option value="THALEOS_12T">THALEOS 12kW Tri</option>
                                <option value="THALEOS_14T">THALEOS 14kW Tri</option>
                                <option value="THALEOS_16T">THALEOS 16kW Tri</option>
                            </optgroup>
                            <optgroup label="THALEOS Bi-Bloc">
                                <option value="THALEOS_BI_08M">THALEOS Bi-Bloc 8kW</option>
                                <option value="THALEOS_BI_10M">THALEOS Bi-Bloc 10kW</option>
                                <option value="THALEOS_BI_12M">THALEOS Bi-Bloc 12kW</option>
                                <option value="THALEOS_BI_14M">THALEOS Bi-Bloc 14kW</option>
                                <option value="THALEOS_BI_16M">THALEOS Bi-Bloc 16kW</option>
                            </optgroup>
                            <optgroup label="WELLEA">
                                <option value="WELLEA_12T">WELLEA 12kW Tri</option>
                                <option value="WELLEA_14T">WELLEA 14kW Tri</option>
                                <option value="WELLEA_16T">WELLEA 16kW Tri</option>
                                <option value="WELLEA_16M">WELLEA 16kW Mono</option>
                            </optgroup>
                            <optgroup label="WOLF">
                                <option value="WOLF_FHA_05_06_230">WOLF 5kW Mono</option>
                                <option value="WOLF_FHA_06_07_230">WOLF 6kW Mono</option>
                                <option value="WOLF_FHA_08_10_230">WOLF 8kW Mono</option>
                                <option value="WOLF_FHA_11_14_230">WOLF 11kW Mono</option>
                                <option value="WOLF_FHA_14_17_230">WOLF 14kW Mono</option>
                                <option value="WOLF_FHA_14_17_400">WOLF 14kW Tri</option>
                            </optgroup>
                        </select>
                    </div>
                    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:10px;">
                        <div class="form-group" style="margin-bottom:0;">
                            <label>Prix PAC TTC (&euro;)</label>
                            <input type="number" id="prixPAC" value="7650" oninput="calc()">
                        </div>
                        <div class="form-group" style="margin-bottom:0;">
                            <label>Prix Pose TTC (&euro;)</label>
                            <input type="number" id="prixPose" value="3240" oninput="calc()">
                        </div>
                        <div class="form-group" style="margin-bottom:0;">
                            <label>Usage</label>
                            <select id="usagePAC"><option>Chauffage seul</option><option>Chauffage + ECS</option></select>
                        </div>
                    </div>
                    <div id="pacInfo" style="font-size:11px;color:#64748b;line-height:1.5;min-height:20px;"></div>
                </div>

                <!-- Ballon Thermodynamique -->
                <div class="produit-bloc" style="margin-top:14px;">
                    <div class="produit-bloc-head">
                        <span class="produit-bloc-icon">&#128703;</span>
                        <span class="produit-bloc-title">Ballon Thermodynamique</span>
                    </div>
                    <div class="form-group" style="margin-bottom:8px;">
                        <label>Inclure un ballon CET ?</label>
                        <select id="includeBallon" onchange="toggleProduitOpt('ballonOpt',this.value==='oui');calc();calcCEEDetail()">
                            <option value="non">Non</option>
                            <option value="oui">Oui</option>
                        </select>
                    </div>
                    <div class="produit-opt-section" id="ballonOpt">
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                            <div class="form-group" style="margin-bottom:0;">
                                <label>R&eacute;f&eacute;rence</label>
                                <select id="refBallon">
                                    <option value="PERFORMER2_200L">Performer 2 &mdash; 200L</option>
                                    <option value="PERFORMER2_270L">Performer 2 &mdash; 270L</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-bottom:0;">
                                <label>Prix TTC (&euro;)</label>
                                <input type="number" id="prixBallon" value="2000" oninput="calc()">
                            </div>
                            <div class="form-group" style="margin-bottom:0;">
                                <label>Pose TTC (&euro;)</label>
                                <input type="number" id="prixPoseBallon" value="860" oninput="calc()">
                            </div>
                            <div class="form-group" style="margin-bottom:0;">
                                <label>COP</label>
                                <input id="copBallon" value="2,78">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SSC -->
                <div class="produit-bloc" style="margin-top:14px;">
                    <div class="produit-bloc-head">
                        <span class="produit-bloc-icon">&#9728;&#65039;</span>
                        <span class="produit-bloc-title">SSC &mdash; Syst&egrave;me Solaire Combin&eacute;</span>
                    </div>
                    <div class="form-group" style="margin-bottom:8px;">
                        <label>Inclure SSC ?</label>
                        <select id="includeSSC" onchange="toggleProduitOpt('sscOpt',this.value==='oui');calc();calcCEEDetail()">
                            <option value="non">Non</option>
                            <option value="oui">Oui &mdash; YODAV (QS/62338)</option>
                        </select>
                    </div>
                    <div class="produit-opt-section" id="sscOpt">
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                            <div class="form-group" style="margin-bottom:0;">
                                <label>Produit</label>
                                <select id="refSSC"><option>THALEOS SSC 420L SUNBOOSTER</option></select>
                            </div>
                            <div class="form-group" style="margin-bottom:0;">
                                <label>Prix SSC TTC (&euro;)</label>
                                <input type="number" id="prixSSC" value="10230" oninput="calc()">
                            </div>
                            <div class="form-group" style="margin-bottom:0;">
                                <label>Pose SSC TTC (&euro;)</label>
                                <input type="number" id="prixPoseSSC" value="4730" oninput="calc()">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TVA (hidden, default 5.5%) -->
                <input type="hidden" id="tvaProduit" value="5.5">
            </div>
            </div><!-- end tab-pac-content produit -->

            <div class="tab-pac-content">
            <!-- ===================== BARÃˆME PAC (client) ===================== -->
            <div class="card" id="baremeCard">
                <h2 class="card-title">&#128208; Puissance PAC recommandÃ©e</h2>
                <div style="font-size: 12px; color: #64748b; margin-bottom: 14px;">Estimation selon la surface, l'annÃ©e de construction et l'isolation</div>

                <!-- Hidden input for sync -->
                <input type="hidden" id="baremeSurface" value="100">

                <!-- AnnÃ©e de construction -->
                <div class="form-group" style="margin-bottom: 14px;">
                    <label>AnnÃ©e de construction</label>
                    <input type="number" id="dimAnnee" value="2000" min="1900" max="2026" oninput="evalIsolation(); calcBareme(); calcDim()">
                </div>

                <!-- Questionnaire isolation -->
                <div style="margin-bottom: 14px;">
                    <label style="font-weight: 700; color: #1d1d1f; font-size: 14px; display: block; margin-bottom: 12px;">Travaux d&eacute;j&agrave; r&eacute;alis&eacute;s</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;" id="isoChecklist">
                        <label class="iso-check" onclick="setTimeout(function(){evalIsolation();calcBareme()},10)">
                            <input type="checkbox" name="isoWork" value="combles">
                            <span class="iso-info">
                                <span class="iso-title">&#127968; Combles / Toiture</span>
                                <span class="iso-sub">Souffl&eacute;e, rampants, sarking</span>
                            </span>
                            <select class="iso-quand" onchange="evalIsolation();calcBareme()">
                                <option value="recent">&lt; 5 ans</option>
                                <option value="ancien">&gt; 5 ans</option>
                            </select>
                        </label>
                        <label class="iso-check" onclick="setTimeout(function(){evalIsolation();calcBareme()},10)">
                            <input type="checkbox" name="isoWork" value="murs">
                            <span class="iso-info">
                                <span class="iso-title">&#129521; Murs (ITE / ITI)</span>
                                <span class="iso-sub">Ext&eacute;rieure ou int&eacute;rieure</span>
                            </span>
                            <select class="iso-quand" onchange="evalIsolation();calcBareme()">
                                <option value="recent">&lt; 5 ans</option>
                                <option value="ancien">&gt; 5 ans</option>
                            </select>
                        </label>
                        <label class="iso-check" onclick="setTimeout(function(){evalIsolation();calcBareme()},10)">
                            <input type="checkbox" name="isoWork" value="fenetres">
                            <span class="iso-info">
                                <span class="iso-title">&#128999; Fen&ecirc;tres DV / TV</span>
                                <span class="iso-sub">Double ou triple vitrage</span>
                            </span>
                            <select class="iso-quand" onchange="evalIsolation();calcBareme()">
                                <option value="recent">&lt; 5 ans</option>
                                <option value="ancien">&gt; 5 ans</option>
                            </select>
                        </label>
                        <label class="iso-check" onclick="setTimeout(function(){evalIsolation();calcBareme()},10)">
                            <input type="checkbox" name="isoWork" value="plancher">
                            <span class="iso-info">
                                <span class="iso-title">&#11015;&#65039; Plancher bas</span>
                                <span class="iso-sub">Vide sanitaire, sous-sol</span>
                            </span>
                            <select class="iso-quand" onchange="evalIsolation();calcBareme()">
                                <option value="recent">&lt; 5 ans</option>
                                <option value="ancien">&gt; 5 ans</option>
                            </select>
                        </label>
                        <label class="iso-check" onclick="setTimeout(function(){evalIsolation();calcBareme()},10)" style="grid-column: 1 / -1;">
                            <input type="checkbox" name="isoWork" value="vmc">
                            <span class="iso-info">
                                <span class="iso-title">&#128168; VMC double flux</span>
                                <span class="iso-sub">Ventilation m&eacute;canique contr&ocirc;l&eacute;e</span>
                            </span>
                            <select class="iso-quand" onchange="evalIsolation();calcBareme()">
                                <option value="recent">&lt; 5 ans</option>
                                <option value="ancien">&gt; 5 ans</option>
                            </select>
                        </label>
                    </div>
                    <!-- RÃ©sultat isolation (fournisseur only) -->
                    <div id="isoResult" class="fournisseur-only" style="margin-top: 10px; padding: 10px 14px; border-radius: 8px; font-size: 13px; background: #f8fafc; border: 1.5px solid #e2e8f0;">
                        <span style="font-weight: 600;" id="isoStateName">Ã‰tat d'origine / Non prÃ©cisÃ©</span>
                        <span style="color: #64748b;"> &mdash; </span>
                        <span style="font-weight: 700; color: #16a34a;" id="dimGDisplay">G = 0,95</span>
                    </div>
                </div>

                <!-- RÃ©sultat barÃ¨me visuel -->
                <div id="baremeResult" style="padding: 20px; background: linear-gradient(135deg, #f0fdf4, #ecfdf5); border-radius: 12px; border: 1.5px solid #bbf7d0;">
                    <div style="font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; text-align: center;">PAC recommandÃ©e</div>
                    
                    <!-- Gauge visuelle -->
                    <div id="baremeGauge" style="position: relative; margin: 0 auto; max-width: 340px;">
                        <!-- Labels puissance -->
                        <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                            <span id="baremeLow" style="font-size: 20px; font-weight: 800; color: #16a34a;">10 kW</span>
                            <span id="baremeHigh" style="font-size: 20px; font-weight: 800; color: #dc2626;">12 kW</span>
                        </div>
                        <!-- Barre -->
                        <div style="position: relative; height: 12px; border-radius: 6px; background: linear-gradient(90deg, #22c55e 0%, #eab308 50%, #ef4444 100%); margin-bottom: 4px;">
                            <!-- Curseur -->
                            <div id="baremeCursor" style="position: absolute; top: -6px; width: 24px; height: 24px; border-radius: 50%; background: white; border: 3px solid #0f172a; box-shadow: 0 2px 8px rgba(0,0,0,0.25); transition: left 0.4s ease; left: 50%;" ></div>
                        </div>
                        <!-- Labels bas -->
                        <div style="display: flex; justify-content: space-between; font-size: 10px; color: #94a3b8;">
                            <span>Bien isolÃ©</span>
                            <span>Mal isolÃ©</span>
                        </div>
                    </div>

                    <!-- RÃ©sultat texte -->
                    <div style="text-align: center; margin-top: 14px;">
                        <div id="baremeReco" style="font-size: 32px; font-weight: 800; color: #16a34a;">10 kW</div>
                        <div id="baremeAlt" style="font-size: 13px; color: #64748b; margin-top: 2px;"></div>
                        <div id="baremeIsoHint" style="font-size: 11px; color: #64748b; margin-top: 4px;"></div>
                    </div>
                </div>

                <!-- Tableau supprimÃ© - logique intÃ©grÃ©e dans calcBareme -->
            </div>

            <!-- ===================== NOTE DE DIMENSIONNEMENT (fournisseur) ===================== -->
            <div class="card fournisseur-only telepro-hide" id="dimensionnementCard">
                <h2 class="card-title">&#128208; Dimensionnement PAC</h2>
                <div style="font-size: 12px; color: #64748b; margin-bottom: 18px;">Estimation de la puissance recommandÃ©e Â· Formule : P = G &times; V &times; &#916;T</div>

                <!-- Surface + Hauteur -->
                <div class="dim-row">
                    <div class="dim-field">
                        <label>Surface au sol (mÂ²) <span class="req">*</span></label>
                        <input type="number" id="dimSurface" value="100" min="1" oninput="syncSurfaces('dim')">
                        <div class="dim-hint">Exemple : 100 mÂ²</div>
                    </div>
                    <div class="dim-field">
                        <label>Hauteur sous plafond (m)</label>
                        <input type="number" id="dimHauteur" value="2.5" min="1.5" max="5" step="0.1" oninput="calcDim()">
                        <div class="dim-hint">DÃ©faut : 2,5 m</div>
                    </div>
                </div>

                <!-- ParamÃ¨tres avancÃ©s (masquÃ©s, gardÃ©s pour calcul) -->
                <input type="hidden" id="dimTbase" value="-7">
                <input type="hidden" id="dimTint" value="21">
                <input type="hidden" id="dimT1" value="60">
                <input type="hidden" id="dimT2" value="140">

                <!-- RÃ‰SULTATS -->
                <div style="background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 100%); border-radius: 12px; padding: 20px; margin-bottom: 16px;">
                    <div style="font-weight: 700; color: white; font-size: 14px; margin-bottom: 14px; text-align: center;">RÃ‰SULTATS DU DIMENSIONNEMENT</div>
                    
                    <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 12px; margin-bottom: 10px; text-align: center;">
                        <div style="font-size: 11px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px;">DÃ©perditions totales (P = G &times; V &times; &#916;T)</div>
                        <div style="font-size: 28px; font-weight: 800; color: #fbbf24;" id="dimDeperditions">&mdash;</div>
                        <div style="font-size: 12px; color: #cbd5e1;" id="dimDepFormula">&mdash;</div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 12px; text-align: center;">
                            <div style="font-size: 11px; color: #94a3b8; text-transform: uppercase;">Puissance PAC</div>
                            <div style="font-size: 24px; font-weight: 800; color: #34d399;" id="dimPuissancePAC">&mdash;</div>
                            <div style="font-size: 11px; color: #cbd5e1;" id="dimPuissancePACDetail">&mdash;</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 12px; text-align: center;">
                            <div style="font-size: 11px; color: #94a3b8; text-transform: uppercase;">Puissance appoint</div>
                            <div style="font-size: 24px; font-weight: 800; color: #f97316;" id="dimPuissanceAppoint">&mdash;</div>
                            <div style="font-size: 11px; color: #cbd5e1;" id="dimPuissanceAppointDetail">&mdash;</div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.08); border-radius: 8px; padding: 10px; margin-top: 10px; text-align: center;">
                        <div style="font-size: 11px; color: #94a3b8; text-transform: uppercase;">Puissance totale (PAC + appoint)</div>
                        <div style="font-size: 20px; font-weight: 700; color: white;" id="dimPuissanceTotale">&mdash;</div>
                    </div>
                </div>

                <!-- TempÃ©rature d'eau -->
                <div class="dim-row" style="margin-bottom: 0;">
                    <div class="dim-field">
                        <label>TÂ° d'eau du circuit (Â°C)</label>
                        <input type="number" id="dimTeau" value="60" step="5" min="30" max="80">
                    </div>
                </div>

                <!-- Ã‰quipement -->
                <div style="margin-top: 16px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 10px; padding: 14px;">
                    <div style="font-weight: 600; color: #1d1d1f; font-size: 13px; margin-bottom: 10px;">MatÃ©riel installÃ©</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>
                            <label style="font-size: 12px; color: #64748b;">Marque PAC</label>
                            <input type="text" id="dimMarque" placeholder="Ex: Daikin, Atlantic&#8230;" style="width: 100%; padding: 8px 10px; border: 1px solid #d2d2d7; border-radius: 6px;">
                        </div>
                        <div>
                            <label style="font-size: 12px; color: #64748b;">RÃ©fÃ©rence PAC</label>
                            <input type="text" id="dimReference" placeholder="RÃ©f. modÃ¨le" style="width: 100%; padding: 8px 10px; border: 1px solid #d2d2d7; border-radius: 6px;">
                        </div>
                    </div>
                </div>
            </div>

            <div class="card fournisseur-only">
                <h2 class="card-title">CoÃ»ts (Vue Fournisseur)</h2>
                
                <div style="background: #f5f5f7; padding: 16px; border-radius: 8px; margin-bottom: 8px;">
                    <!-- PAC MatÃ©riel -->
                    <div style="display: grid; grid-template-columns: 120px 1fr 80px 100px; gap: 8px; align-items: center; margin-bottom: 10px;">
                        <label style="color: #1d1d1f; font-weight: 600; font-size: 13px;">PAC MatÃ©riel</label>
                        <input type="number" id="coutPACMateriel" value="2900" step="1" oninput="updateFromDetail()" style="padding: 8px 12px; border: 1px solid #d2d2d7; border-radius: 6px; font-weight: 600; text-align: right;">
                        <input type="number" id="qtePACMateriel" value="1" min="0" step="1" oninput="updateFromDetail()" style="padding: 8px 12px; border: 1px solid #d2d2d7; border-radius: 6px; font-weight: 600; text-align: center;">
                        <div style="font-weight: 700; text-align: right; color: #1d1d1f;" id="totalPACMateriel">2 900 &euro;</div>
                    </div>
                    
                    <!-- PAC Pose -->
                    <div style="display: grid; grid-template-columns: 120px 1fr 80px 100px; gap: 8px; align-items: center; margin-bottom: 10px;">
                        <label style="color: #1d1d1f; font-weight: 600; font-size: 13px;">PAC Pose</label>
                        <input type="number" id="coutPACPose" value="2500" step="1" oninput="updateFromDetail()" style="padding: 8px 12px; border: 1px solid #d2d2d7; border-radius: 6px; font-weight: 600; text-align: right;">
                        <input type="number" id="qtePACPose" value="1" min="0" step="1" oninput="updateFromDetail()" style="padding: 8px 12px; border: 1px solid #d2d2d7; border-radius: 6px; font-weight: 600; text-align: center;">
                        <div style="font-weight: 700; text-align: right; color: #1d1d1f;" id="totalPACPose">2 500 &euro;</div>
                    </div>
                    
                    <!-- Ballon MatÃ©riel -->
                    <div style="display: grid; grid-template-columns: 120px 1fr 80px 100px; gap: 8px; align-items: center; margin-bottom: 10px;">
                        <label style="color: #1d1d1f; font-weight: 600; font-size: 13px;">Ballon MatÃ©riel</label>
                        <input type="number" id="coutBallonMateriel" value="0" step="1" oninput="updateFromDetail()" style="padding: 8px 12px; border: 1px solid #d2d2d7; border-radius: 6px; font-weight: 600; text-align: right;">
                        <input type="number" id="qteBallonMateriel" value="0" min="0" step="1" oninput="updateFromDetail()" style="padding: 8px 12px; border: 1px solid #d2d2d7; border-radius: 6px; font-weight: 600; text-align: center;">
                        <div style="font-weight: 700; text-align: right; color: #1d1d1f;" id="totalBallonMateriel">0 &euro;</div>
                    </div>
                    
                    <!-- Ballon Pose -->
                    <div style="display: grid; grid-template-columns: 120px 1fr 80px 100px; gap: 8px; align-items: center; margin-bottom: 10px;">
                        <label style="color: #1d1d1f; font-weight: 600; font-size: 13px;">Ballon Pose</label>
                        <input type="number" id="coutBallonPose" value="0" step="1" oninput="updateFromDetail()" style="padding: 8px 12px; border: 1px solid #d2d2d7; border-radius: 6px; font-weight: 600; text-align: right;">
                        <input type="number" id="qteBallonPose" value="0" min="0" step="1" oninput="updateFromDetail()" style="padding: 8px 12px; border: 1px solid #d2d2d7; border-radius: 6px; font-weight: 600; text-align: center;">
                        <div style="font-weight: 700; text-align: right; color: #1d1d1f;" id="totalBallonPose">0 &euro;</div>
                    </div>
                    
                    <!-- Accessoires -->
                    <div style="display: grid; grid-template-columns: 120px 1fr 80px 100px; gap: 8px; align-items: center; margin-bottom: 10px;">
                        <label style="color: #1d1d1f; font-weight: 600; font-size: 13px;">Access.</label>
                        <input type="number" id="coutAccessoires" value="500" step="1" oninput="updateFromDetail()" style="padding: 8px 12px; border: 1px solid #d2d2d7; border-radius: 6px; font-weight: 600; text-align: right;">
                        <input type="number" id="qteAccessoires" value="1" min="0" step="1" oninput="updateFromDetail()" style="padding: 8px 12px; border: 1px solid #d2d2d7; border-radius: 6px; font-weight: 600; text-align: center;">
                        <div style="font-weight: 700; text-align: right; color: #1d1d1f;" id="totalAccessoires">500 &euro;</div>
                    </div>
                    
                    <!-- Admin -->
                    <div style="display: grid; grid-template-columns: 120px 1fr 80px 100px; gap: 8px; align-items: center; margin-bottom: 10px;">
                        <label style="color: #1d1d1f; font-weight: 600; font-size: 13px;">Admin</label>
                        <input type="number" id="coutAdmin" value="400" step="1" oninput="updateFromDetail()" style="padding: 8px 12px; border: 1px solid #d2d2d7; border-radius: 6px; font-weight: 600; text-align: right;">
                        <input type="number" id="qteAdmin" value="1" min="0" step="1" oninput="updateFromDetail()" style="padding: 8px 12px; border: 1px solid #d2d2d7; border-radius: 6px; font-weight: 600; text-align: center;">
                        <div style="font-weight: 700; text-align: right; color: #1d1d1f;" id="totalAdmin">400 &euro;</div>
                    </div>
                    
                    <!-- Mandat MPR -->
                    <div style="display: grid; grid-template-columns: 120px 1fr 80px 100px; gap: 8px; align-items: center; margin-bottom: 10px;">
                        <label style="color: #1d1d1f; font-weight: 600; font-size: 13px;">Mandat MPR</label>
                        <input type="number" id="coutMandat" value="0" step="1" oninput="updateFromDetail()" style="padding: 8px 12px; border: 1px solid #d2d2d7; border-radius: 6px; font-weight: 600; text-align: right;">
                        <input type="number" id="qteMandat" value="1" min="0" step="1" oninput="updateFromDetail()" style="padding: 8px 12px; border: 1px solid #d2d2d7; border-radius: 6px; font-weight: 600; text-align: center;">
                        <div style="font-weight: 700; text-align: right; color: #1d1d1f;" id="totalMandat">0 &euro;</div>
                    </div>
                    
                    <!-- Demande mairie -->
                    <div style="display: grid; grid-template-columns: 120px 1fr 80px 100px; gap: 8px; align-items: center; margin-bottom: 10px;">
                        <label style="color: #1d1d1f; font-weight: 600; font-size: 13px;">Mairie</label>
                        <input type="number" id="coutMairie" value="250" step="1" oninput="updateFromDetail()" style="padding: 8px 12px; border: 1px solid #d2d2d7; border-radius: 6px; font-weight: 600; text-align: right;">
                        <input type="number" id="qteMairie" value="0" min="0" step="1" oninput="updateFromDetail()" style="padding: 8px 12px; border: 1px solid #d2d2d7; border-radius: 6px; font-weight: 600; text-align: center;">
                        <div style="font-weight: 700; text-align: right; color: #1d1d1f;" id="totalMairie">0 &euro;</div>
                    </div>
                    
                    <!-- PrÃ©visite -->
                    <div style="display: grid; grid-template-columns: 120px 1fr 80px 100px; gap: 8px; align-items: center;">
                        <label style="color: #1d1d1f; font-weight: 600; font-size: 13px; display: flex; align-items: center; gap: 6px;">
                            <input type="checkbox" id="checkPrevisite" onchange="updateFromDetail()" style="width: 16px; height: 16px;"> PrÃ©visite
                        </label>
                        <input type="number" id="coutPrevisite" value="200" step="1" oninput="updateFromDetail()" style="padding: 8px 12px; border: 1px solid #d2d2d7; border-radius: 6px; font-weight: 600; text-align: right;">
                        <div style="text-align: center; font-weight: 600; color: #64748b;">&mdash;</div>
                        <div style="font-weight: 700; text-align: right; color: #1d1d1f;" id="totalPrevisite">0 &euro;</div>
                    </div>
                </div>
                
                <small style="font-size: 11px; color: #86868b; margin-bottom: 12px; display: block; text-align: center;">
                    <label style="display: inline-flex; align-items: center; gap: 6px; cursor: pointer;">
                        <input type="checkbox" id="lockCoutHT" checked onchange="calc()"> Verrouiller les coÃ»ts (auto selon scÃ©nario)
                    </label>
                </small>
                
                <div style="background: #0071e3; color: white; padding: 14px; border-radius: 8px; margin-bottom: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: 600; font-size: 14px;">TOTAL COÃ›T HT</span>
                        <span style="font-size: 20px; font-weight: 700;" id="coutTotalHTDisplay">6 200 &euro;</span>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="prixCumac">Prix cumac (&euro;/MWhc) &mdash; auto selon mÃ©nage</label>
                        <input type="number" id="prixCumac" value="12.5" step="0.01" oninput="calc()" style="font-weight: 600;">
                    </div>

                    <div class="form-group" style="margin-bottom: 0;">
                        <label>kWh cumac</label>
                        <input type="text" id="kwhCumac" value="" readonly style="background: #f5f5f7; color: #1d1d1f; font-weight: 600;">
                    </div>
                </div>
            </div>

            <div style="padding-bottom: 40px;"></div>
            </div><!-- end tab-pac-content for bareme+dim+costs -->


            <!-- ===== ITE CONTENT ===== -->
            <div class="tab-ite-content">
                <!-- LOT 1 - BAR-EN-102 -->
                <div class="ite-card">
                    <div class="ite-card-head">
                        <div class="ite-card-icon">&#129521;</div>
                        <h3>LOT 1 &mdash; BAR-EN-102 &mdash; ITE Murs Ext&eacute;rieurs</h3>
                        <span class="ite-tag">LOT 1 &middot; Obligatoire</span>
                    </div>
                    <div class="ite-fg">
                        <div class="ite-fi"><label>Surface (m&sup2;)</label><input type="number" id="iteSurfaceITE" value="105" oninput="ite_calc()"></div>
                        <input type="hidden" id="iteMontantLot1" value="0">
                        <div class="ite-fi" style="display:none;"><label>Prix mat&eacute;riel (&euro;/m&sup2;)</label><input type="number" id="itePrixMatITE" value="0" oninput="ite_calc()"></div>
                        <div class="ite-fi" style="display:none;"><label>Prix MO (&euro;/m&sup2;)</label><input type="number" id="itePrixMoITE" value="0" oninput="ite_calc()"></div>
                        <div class="ite-fi"><label>Isolant</label><select id="iteIsolantITE"><option value="CELLOMUR_120">HIRSCH CELLOMUR ULTRA 120mm &mdash; R=3,85</option><option value="CELLOMUR_140">HIRSCH CELLOMUR ULTRA 140mm &mdash; R=4,50</option></select></div>
                    </div>
                    <div class="ite-fg" style="margin-top: 10px; display:none;">
                        <div class="ite-fi full"><label>Sous-traitance</label><input id="iteSousTraitITE" value="RL CONSEILS, 2 RUE LOUIS PERGAUD 94700 MAISONS-ALFORT"></div>
                        <div class="ite-fi"><label>SIRET</label><input id="iteSiretSousTraitITE" value="85320240600049"></div>
                        <div class="ite-fi"><label>RGE</label><input id="iteRgeSousTraitITE" value="E-E 184700 (02/07/2024 &rarr; 01/07/2026)"></div>
                        <div class="ite-fi"><label>Couleur cr&eacute;pi</label><input id="iteCouleurCrepi" value="Ton pierre"></div>
                        <div class="ite-fi"><label>Enduit</label><input id="iteEnduitITE" value="Enduit AFC 1.5 base Soltherm"></div>
                    </div>
                </div>

                <!-- LOT 2 -->
                <div class="ite-card">
                    <div class="ite-card-head">
                        <div class="ite-card-icon">&#128256;</div>
                        <h3>LOT 2 &mdash; 2&egrave;me Geste</h3>
                        <span class="ite-tag">LOT 2 &middot; min 1 500 &euro;</span>
                    </div>
                    <div class="ite-note">2&egrave;me geste obligatoire pour CEE + PTZ. <b style="color: #f97316;">Minimum factur&eacute; : 1 500 &euro;</b></div>
                    <div class="ite-fg">
                        <div class="ite-fi full"><label>Type</label>
                            <select id="iteTypeLot2" onchange="ite_switchLot2();ite_calc()">
                                <option value="101">BAR-EN-101 &mdash; Isolation combles perdus</option>
                                <option value="103">BAR-EN-103 &mdash; Isolation plancher bas</option>
                                <option value="148">BAR-TH-148 &mdash; Chauffe-eau thermodynamique</option>
                            </select>
                        </div>
                    </div>
                    <div id="iteLot2Alert"></div>
                </div>

                <!-- LOT 2: BAR-EN-101 -->
                <div class="ite-card" id="iteCard101" style="display: none;">
                    <div class="ite-card-head"><div class="ite-card-icon">&#127968;</div><h3>BAR-EN-101 &mdash; Combles Perdus</h3></div>
                    <div class="ite-fg">
                        <div class="ite-fi"><label>Surface (m&sup2;)</label><input type="number" id="iteSurface101" value="50" oninput="ite_calc()"></div>
                        <input type="hidden" id="itePrixMat101" value="0">
                        <input type="hidden" id="itePrixMo101" value="0">
                    </div>
                </div>

                <!-- LOT 2: BAR-EN-103 -->
                <div class="ite-card" id="iteCard103" style="display: none;">
                    <div class="ite-card-head"><div class="ite-card-icon">&#127968;</div><h3>BAR-EN-103 &mdash; Plancher Bas</h3></div>
                    <div class="ite-fg">
                        <div class="ite-fi"><label>Surface (m&sup2;)</label><input type="number" id="iteSurface103" value="50" oninput="ite_calc()"></div>
                        <input type="hidden" id="itePrixMat103" value="0">
                        <input type="hidden" id="itePrixMo103" value="0">
                    </div>
                </div>

                <!-- LOT 2: BAR-TH-148 -->
                <div class="ite-card" id="iteCard148" style="display: none;">
                    <div class="ite-card-head"><div class="ite-card-icon">&#128703;</div><h3>BAR-TH-148 &mdash; CET</h3></div>
                    <div class="ite-fg">
                        <div class="ite-fi"><label>Mod&egrave;le</label><select id="iteRefCET"><option value="200">THALEOS Performer 2 &mdash; 200L</option><option value="270">THALEOS Performer 2 &mdash; 270L</option></select></div>
                        <input type="hidden" id="itePrixCET" value="0">
                        <input type="hidden" id="itePrixPoseCET" value="0">
                        <div class="ite-fi"><label>COP</label><input id="iteCopCET" value="2,78"></div>
                    </div>
                </div>

                <!-- LOT 3 (optionnel) -->
                <div class="ite-card" style="border:1px dashed #94a3b8;">
                    <div class="ite-card-head">
                        <div class="ite-card-icon">&#128257;</div>
                        <h3>LOT 3 &mdash; 3&egrave;me Geste (optionnel)</h3>
                        <span class="ite-tag" style="background:#3b82f6;">Plafond PTZ 30 000 &euro;</span>
                    </div>
                    <div class="ite-note">3&egrave;me geste optionnel : passe le plafond Eco-PTZ de 25 000 &euro; &agrave; <b style="color:#3b82f6;">30 000 &euro;</b>. <b style="color: #f97316;">Minimum factur&eacute; : 1 500 &euro;</b></div>
                    <div class="ite-fg">
                        <div class="ite-fi"><label>Inclure LOT 3 ?</label><select id="iteIncludeLot3" onchange="ite_switchLot3();ite_calc()"><option value="non">Non</option><option value="oui">Oui</option></select></div>
                        <div class="ite-fi full" id="iteTypeLot3Wrap" style="display:none;"><label>Type</label>
                            <select id="iteTypeLot3" onchange="ite_switchLot3();ite_calc()">
                                <option value="101">BAR-EN-101 &mdash; Isolation combles perdus</option>
                                <option value="103">BAR-EN-103 &mdash; Isolation plancher bas</option>
                                <option value="148">BAR-TH-148 &mdash; Chauffe-eau thermodynamique</option>
                            </select>
                        </div>
                    </div>
                    <div id="iteLot3Alert"></div>
                </div>

                <!-- LOT 3: BAR-EN-101 -->
                <div class="ite-card" id="iteCard101L3" style="display: none;">
                    <div class="ite-card-head"><div class="ite-card-icon">&#127968;</div><h3>LOT 3 &mdash; BAR-EN-101 Combles Perdus</h3></div>
                    <div class="ite-fg">
                        <div class="ite-fi"><label>Surface (m&sup2;)</label><input type="number" id="iteSurface101L3" value="50" oninput="ite_calc()"></div>
                        <input type="hidden" id="itePrixMat101L3" value="0">
                        <input type="hidden" id="itePrixMo101L3" value="0">
                    </div>
                </div>

                <!-- LOT 3: BAR-EN-103 -->
                <div class="ite-card" id="iteCard103L3" style="display: none;">
                    <div class="ite-card-head"><div class="ite-card-icon">&#127968;</div><h3>LOT 3 &mdash; BAR-EN-103 Plancher Bas</h3></div>
                    <div class="ite-fg">
                        <div class="ite-fi"><label>Surface (m&sup2;)</label><input type="number" id="iteSurface103L3" value="50" oninput="ite_calc()"></div>
                        <input type="hidden" id="itePrixMat103L3" value="0">
                        <input type="hidden" id="itePrixMo103L3" value="0">
                    </div>
                </div>

                <!-- LOT 3: BAR-TH-148 -->
                <div class="ite-card" id="iteCard148L3" style="display: none;">
                    <div class="ite-card-head"><div class="ite-card-icon">&#128703;</div><h3>LOT 3 &mdash; BAR-TH-148 CET</h3></div>
                    <div class="ite-fg">
                        <div class="ite-fi"><label>Mod&egrave;le</label><select id="iteRefCETL3"><option value="200">THALEOS Performer 2 &mdash; 200L</option><option value="270">THALEOS Performer 2 &mdash; 270L</option></select></div>
                        <input type="hidden" id="itePrixCETL3" value="0">
                        <input type="hidden" id="itePrixPoseCETL3" value="0">
                        <div class="ite-fi"><label>COP</label><input id="iteCopCETL3" value="2,78"></div>
                    </div>
                </div>

                <!-- MONTANT TOTAL PROJET -->
                <div class="ite-card" style="background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%); border: 2px solid #16a34a;">
                    <div class="ite-card-head">
                        <div class="ite-card-icon">&#128176;</div>
                        <h3>Montant total du projet</h3>
                    </div>
                    <div class="ite-fg">
                        <div class="ite-fi"><label>Montant TTC (&euro;)</label><input type="number" id="iteMontantTotalProjet" value="0" oninput="ite_onMontantTotal()"></div>
                    </div>
                    <div id="iteMontantDetail" style="font-size:12px;color:#64748b;margin-top:8px;"></div>
                </div>

                <!-- CEE EDF -->
                <div class="ite-card">
                    <div class="ite-card-head">
                        <div class="ite-card-icon">&#128202;</div>
                        <h3>CEE EDF &amp; PTZ</h3>
                        <span class="ite-tag ite-tag-auto">Auto</span>
                    </div>
                    <div class="ite-note">Obligataire : EDF (SIREN 552 081 317)</div>
                    <div id="itePtzStatus"></div>
                    <div id="iteAidesSummary"></div>
                    <div id="iteCeeTableContainer"></div>
                    <div class="ite-fg" style="margin-top: 14px;">
                        <div class="ite-fi"><label>TVA (%)</label><input type="number" id="iteTva" value="5.5" step="0.1" oninput="ite_calc()"></div>
                        <div class="ite-fi"><label>Prime CEE totale (&euro;) <small style="color:#16a34a;">AUTO</small></label><input type="number" id="itePrimeCEE" step="0.01" oninput="ite_calc()"></div>
                    </div>
                </div>

                <!-- Partenaires (masquÃ©) -->

                <!-- Financement -->
                <div class="ite-card">
                    <div class="ite-card-head"><div class="ite-card-icon">&#128179;</div><h3>Financement</h3></div>
                    <div class="ite-fg">
                        <div class="ite-fi"><label>Inclure ?</label><select id="iteIncludeFinancement" onchange="ite_calc()"><option value="oui">Oui</option><option value="non">Non</option></select></div>
                        <div class="ite-fi"><label>Dur&eacute;e (mois)</label><input type="number" id="iteDureeMois" value="120" oninput="ite_calc()"></div>
                        <div class="ite-fi"><label>Mensualit&eacute; hors ass. (&euro;)</label><input type="number" id="iteMensHorsAss" value="0" step="0.01"></div>
                        <div class="ite-fi"><label>Mensualit&eacute; avec ass. (&euro;)</label><input type="number" id="iteMensAvecAss" value="0" step="0.01"></div>
                        <div class="ite-fi"><label>Type assurance</label><input id="iteTypeAssurance" value="DIM"></div>
                        <div class="ite-fi"><label>Total d&ucirc; hors ass. (&euro;)</label><input type="number" id="iteTotalDuHA" value="0" step="0.01"></div>
                        <div class="ite-fi"><label>Total d&ucirc; avec ass. (&euro;)</label><input type="number" id="iteTotalDuAA" value="0" step="0.01"></div>
                    </div>
                </div>


                <!-- Generate button -->
                <div style="margin-top: 10px;">
                    <button onclick="ite_generateDevis()" style="width: 100%; padding: 16px; border-radius: 12px; border: none; background: linear-gradient(135deg, #16a34a, #0d8a3a); color: white; font-size: 15px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 20px rgba(22,163,74,0.25); transition: all 0.2s; font-family: inherit;">
                        &#128196; G&eacute;n&eacute;rer le Devis ITE
                    </button>
                </div>
            </div><!-- end tab-ite-content -->

        </div>

        <div class="results-sidebar" id="resultsSidebar">
            <div class="tab-pac-content">
            <div class="summary-card" style="margin-bottom: 0;">
                <div class="scenario-label-dark" id="scenarioSummary">&mdash;</div>

                <!-- TOTAL TTC (readonly client) -->
                <div class="ttc-readonly">
                    <div class="result-row-card" style="background: rgba(96,165,250,0.08); border-color: rgba(96,165,250,0.15);">
                        <div class="rrc-label">&#128176; CoÃ»t installation TTC</div>
                        <div class="rrc-value blue" id="totalTTC">&mdash;</div>
                    </div>
                </div>

                <!-- TOTAL TTC (editable fournisseur) -->
                <div class="fournisseur-only" style="margin-bottom: 12px;">
                    <div class="result-row-card" style="background: rgba(96,165,250,0.08); border-color: rgba(96,165,250,0.15);">
                        <div class="rrc-label">&#128176; CoÃ»t installation TTC</div>
                        <div class="rrc-value blue" id="totalTTCEditable" contenteditable="true" oninput="onTTCEdit()" style="cursor: text; min-width: 60px;">10 890 â‚¬</div>
                    </div>
                    <input type="hidden" id="totalTTCInput" value="10890">
                    <small style="font-size: 11px; color: rgba(255,255,255,0.35); margin-top: 6px; display: block;">
                        <label style="display: inline-flex; align-items: center; gap: 6px; cursor: pointer;">
                            <input type="checkbox" id="lockTTC" checked onchange="calc()"> Verrouiller (auto selon scÃ©nario)
                        </label>
                    </small>
                </div>

                <!-- COÃ›T HT fournisseur -->
                <div class="fournisseur-only" style="margin-bottom: 4px;">
                    <div class="result-row-card">
                        <div>
                            <div class="rrc-label">CoÃ»t HT</div>
                            <div style="font-size: 10px; color: rgba(255,255,255,0.3); margin-top: 2px;">MatÃ©riel + pose + admin</div>
                        </div>
                        <div class="rrc-value" id="displayCoutHT" style="font-size: 18px;">&mdash;</div>
                    </div>
                </div>

                <div class="glow-separator"></div>

                <!-- ESTIMATION FINANCIÃˆRE -->
                <div class="dark-section-title">Estimation financiÃ¨re</div>

                <div class="result-row-card">
                    <div class="rrc-label">MaPrimeRÃ©nov'</div>
                    <div class="rrc-value green" id="aidesMPR" style="font-size: 18px;">&mdash;</div>
                </div>

                <div class="result-row-card">
                    <div>
                        <div class="rrc-label">Certificats CEE</div>
                        <div style="font-size: 10px; color: rgba(255,255,255,0.3); margin-top: 2px;" id="ceeSourceLabel">BAR-TH dÃ©taillÃ©</div>
                    </div>
                    <div class="rrc-value green" id="aidesCEE" style="font-size: 18px;">&mdash;</div>
                </div>

                <div class="glow-separator"></div>

                <!-- TOTAL AIDES -->
                <div class="result-highlight-card">
                    <div class="rhc-label">Total des aides</div>
                    <div class="rhc-value" id="totalAides">&mdash;</div>
                </div>

                <!-- RESTE Ã€ CHARGE -->
                <div class="result-row-card" style="background: rgba(251,191,36,0.08); border-color: rgba(251,191,36,0.15);">
                    <div class="rrc-label">&#127968; Reste Ã  charge estimÃ©</div>
                    <div class="rrc-value yellow" id="resteCharge">&mdash;</div>
                </div>

                <!-- MARGE fournisseur -->
                <div class="fournisseur-only telepro-hide" style="margin-top: 4px;">
                    <div class="result-row-card" style="background: rgba(248,113,113,0.06); border-color: rgba(248,113,113,0.12);">
                        <div class="rrc-label">&#128202; Marge finale (HT)</div>
                        <div class="rrc-value" id="margeFinal" style="font-size: 18px;">&mdash;</div>
                    </div>
                </div>

                <div class="glow-separator"></div>

                <!-- RAC Section (fournisseur only) -->
                <div class="rac-dark-section fournisseur-only" style="margin-bottom: 14px;">
                    <div class="dark-section-title" style="margin-bottom: 10px;">Prise en charge du RAC</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <div>
                            <div class="amount-label" style="color: rgba(255,255,255,0.45); margin-bottom: 4px;">Pourcentage (%)</div>
                            <input type="number" id="racPourcent" value="0" min="0" max="100" step="1" oninput="updatePct()" onchange="logRACChange()">
                        </div>
                        <div>
                            <div class="amount-label" style="color: rgba(255,255,255,0.45); margin-bottom: 4px;">RAC offert (&euro;)</div>
                            <input type="number" id="racOffert" value="0" min="0" step="1" oninput="updateAmt()" onchange="logRACChange()">
                        </div>
                    </div>
                    <div id="maxPctInfo" style="font-size: 12px; padding: 10px 14px; border-radius: 8px; background: rgba(5,150,105,0.12); border: 1px solid rgba(5,150,105,0.25); color: #34d399; margin-bottom: 6px;">
                        Remise max : <strong id="maxPctValue">&mdash;</strong> pour rester en dossier vert
                    </div>
                    <div class="note-small" style="font-size: 11px; margin-bottom: 8px; color: rgba(255,255,255,0.3);">AppliquÃ© sur le RAC brut. N'affecte pas le prix cumac.</div>
                </div>

                <!-- Status + Actions -->
                <div id="statusBadge" class="status-badge ok" style="margin-bottom: 14px;" onclick="shareDevis()">
                    <span id="statusIcon">&#9989;</span>
                    <span id="statusText">Voulez-vous un devis ?</span>
                </div>

                <button id="exportBtn" class="btn-dark-export pdf" onclick="exportPDF()" style="margin-top: 14px;">
                    &#128196; G&eacute;n&eacute;rer le Devis PAC
                </button>
                
                <button id="whatsappBtn" class="btn-dark-export whatsapp" onclick="sendWhatsApp()">
                    &#128172; Envoyer par WhatsApp
                </button>
            
            </div><!-- end tab-pac-content sidebar -->

            <!-- ITE SIDEBAR -->
            <div class="tab-ite-content">
            <div class="summary-card" style="margin-bottom: 0;">
                <div class="scenario-label-dark" style="border-left-color: #16a34a;">
                    <strong style="color: #34d399;">ITE</strong><span class="separator">&bull;</span>Isolation Thermique Ext&eacute;rieure
                </div>

                <div class="result-row-card">
                    <div class="rrc-label">&#129521; LOT 1 &mdash; ITE</div>
                    <div class="rrc-value blue" id="iteSidebarLot1">&mdash;</div>
                </div>

                <div class="result-row-card">
                    <div>
                        <div class="rrc-label">LOT 2</div>
                        <div style="font-size: 10px; color: rgba(255,255,255,0.3); margin-top: 2px;" id="iteSidebarLot2Type">BAR-EN-103</div>
                    </div>
                    <div class="rrc-value" id="iteSidebarLot2">&mdash;</div>
                </div>
                <div id="iteSidebarLot2Alert" style="display: none; font-size: 11px; color: #f87171; padding: 6px 10px; background: rgba(248,113,113,0.08); border: 1px solid rgba(248,113,113,0.15); border-radius: 8px; margin-bottom: 10px;">
                    &#9888;&#65039; LOT 2 &lt; 1 500 &euro;
                </div>

                <div class="glow-separator"></div>

                <div class="dark-section-title">Aides &amp; Primes</div>

                <div class="result-row-card" style="background: rgba(52,211,153,0.08); border-color: rgba(52,211,153,0.15);">
                    <div class="rrc-label">&#128220; Prime CEE EDF</div>
                    <div class="rrc-value green" id="iteSidebarCEE">&mdash;</div>
                </div>

                <div class="glow-separator"></div>

                <div class="result-row-card" style="background: rgba(96,165,250,0.08); border-color: rgba(96,165,250,0.15);">
                    <div class="rrc-label">&#128176; Total TTC</div>
                    <div class="rrc-value blue" id="iteSidebarTTC">&mdash;</div>
                </div>

                <div class="result-row-card" style="background: rgba(251,191,36,0.08); border-color: rgba(251,191,36,0.15);">
                    <div class="rrc-label">&#127968; Reste &agrave; r&eacute;gler</div>
                    <div class="rrc-value yellow" id="iteSidebarReste">&mdash;</div>
                </div>

                <div id="iteSidebarPTZ" style="margin-top: 10px;"></div>

                <button onclick="ite_generateDevis()" class="btn-dark-export pdf" style="margin-top: 14px;">
                    &#128196; G&eacute;n&eacute;rer le Devis ITE
                </button>
            </div>
            </div><!-- end tab-ite-content sidebar -->
</div>
        </div>
    </div>

    <div class="footer">
        <p style="margin: 0;">PropulsÃ© par 770 Lab</p>
    </div>
</div><!-- /appScreen -->

    <div id="printArea" style="display: none;">
        <div style="padding: 20px 30px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: #1f2937; max-width: 800px; margin: 0 auto;">
            
            <!-- EN-TÃŠTE -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 3px solid #16a34a;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="background: linear-gradient(135deg, #16a34a, #15803d); color: white; padding: 8px 14px; border-radius: 8px; font-weight: 700; font-size: 14px;">&#127968; LES ARTISANS VERTS</div>
                    <div style="font-size: 12px; color: #6b7280;">Simulateur Aides PAC 2026</div>
                </div>
                <div style="text-align: right;">
                    <div id="printDate" style="font-size: 12px; color: #6b7280;"></div>
                    <div id="printCommercial" style="font-size: 11px; color: #16a34a; font-weight: 600; margin-top: 2px;"></div>
                </div>
            </div>

            <!-- TITRE -->
            <h1 id="printTitle" style="font-size: 22px; font-weight: 800; margin: 0 0 14px; color: #0f172a;"></h1>

            <!-- CLIENT + PROFIL -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 14px; page-break-inside: avoid;">
                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                    <div style="font-size: 10px; font-weight: 700; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">&#128100; Client</div>
                    <table style="width: 100%; font-size: 12px; border-collapse: collapse;">
                        <tr><td style="padding: 2px 0; color: #6b7280; width: 45%;">Nom</td><td style="padding: 2px 0; font-weight: 600;" id="printNom"></td></tr>
                        <tr><td style="padding: 2px 0; color: #6b7280;">DÃ©partement</td><td style="padding: 2px 0; font-weight: 600;" id="printDept"></td></tr>
                        <tr><td style="padding: 2px 0; color: #6b7280;">Zone</td><td style="padding: 2px 0; font-weight: 600;" id="printZone"></td></tr>
                        <tr><td style="padding: 2px 0; color: #6b7280;">Foyer</td><td style="padding: 2px 0; font-weight: 600;" id="printFoyer"></td></tr>
                        <tr><td style="padding: 2px 0; color: #6b7280;">RFR</td><td style="padding: 2px 0; font-weight: 600;" id="printRFR"></td></tr>
                    </table>
                </div>
                <div id="printProfilCard" style="border-radius: 8px; padding: 12px; color: white;">
                    <div style="font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; opacity: 0.8;">&#127963;&#65039; Profil MaPrimeRÃ©nov'</div>
                    <div id="printProfilIcon" style="font-size: 28px; margin-bottom: 2px;">&#128309;</div>
                    <div id="printProfilLabel" style="font-size: 18px; font-weight: 800;"></div>
                    <div id="printProfilDesc" style="font-size: 12px; opacity: 0.85; margin-top: 2px;"></div>
                    <div id="printProfilSeuil" style="font-size: 11px; opacity: 0.7; margin-top: 4px;"></div>
                </div>
            </div>

            <!-- CONFIGURATION TECHNIQUE -->
            <div style="background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px; padding: 12px; margin-bottom: 14px; page-break-inside: avoid;">
                <div style="font-size: 10px; font-weight: 700; color: #0369a1; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">&#9881;&#65039; Configuration technique</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                    <div><div style="font-size: 10px; color: #64748b;">ScÃ©nario</div><div style="font-size: 13px; font-weight: 700; color: #0f172a;" id="printScenario"></div></div>
                    <div><div style="font-size: 10px; color: #64748b;">Surface</div><div style="font-size: 13px; font-weight: 700; color: #0f172a;" id="printSurface"></div></div>
                    <div><div style="font-size: 10px; color: #64748b;">ETAS</div><div style="font-size: 13px; font-weight: 700; color: #0f172a;" id="printETAS"></div></div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 6px;">
                    <div><div style="font-size: 10px; color: #64748b;">PAC recommandÃ©e</div><div style="font-size: 13px; font-weight: 700; color: #16a34a;" id="printPACReco"></div></div>
                    <div><div style="font-size: 10px; color: #64748b;">Isolation</div><div style="font-size: 13px; font-weight: 700; color: #0f172a;" id="printIsolation"></div></div>
                    <div><div style="font-size: 10px; color: #64748b;">Construction</div><div style="font-size: 13px; font-weight: 700; color: #0f172a;" id="printAnnee"></div></div>
                </div>
            </div>

            <!-- ESTIMATION FINANCIÃˆRE -->
            <div style="margin-bottom: 14px; page-break-inside: avoid;">
                <div style="font-size: 10px; font-weight: 700; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">&#128176; Estimation financiÃ¨re</div>
                <div style="border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                        <tr style="background: #f8fafc;">
                            <td style="padding: 10px 14px; font-weight: 600;">Total TTC installation</td>
                            <td style="padding: 10px 14px; text-align: right; font-weight: 800; font-size: 16px;" id="printTTC"></td>
                        </tr>
                        <tr style="border-top: 1px solid #f1f5f9;">
                            <td style="padding: 8px 14px; color: #6b7280;">&#8627; MaPrimeRÃ©nov'</td>
                            <td style="padding: 8px 14px; text-align: right; font-weight: 700; color: #2563eb; font-size: 14px;" id="printMPR"></td>
                        </tr>
                        <tr style="border-top: 1px solid #f1f5f9;">
                            <td style="padding: 8px 14px; color: #6b7280;">&#8627; Prime CEE</td>
                            <td style="padding: 8px 14px; text-align: right; font-weight: 700; color: #2563eb; font-size: 14px;" id="printCEE"></td>
                        </tr>
                        <tr style="border-top: 2px solid #16a34a; background: #f0fdf4;">
                            <td style="padding: 10px 14px; font-weight: 700; color: #16a34a; font-size: 14px;">Total des aides</td>
                            <td style="padding: 10px 14px; text-align: right; font-weight: 800; color: #16a34a; font-size: 18px;" id="printTotalAides"></td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- DÃ‰TAIL CEE -->
            <div style="background: #fefce8; border: 1px solid #fde68a; border-radius: 8px; padding: 8px 12px; margin-bottom: 14px; font-size: 11px; color: #92400e; page-break-inside: avoid;">
                <strong>DÃ©tail CEE :</strong> <span id="printCEEDetail"></span>
            </div>

            <!-- RESTE Ã€ CHARGE -->
            <div style="border: 2px solid #0f172a; border-radius: 10px; padding: 16px; margin-bottom: 14px; text-align: center; page-break-inside: avoid;">
                <div style="font-size: 10px; font-weight: 700; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">Reste Ã  charge client</div>
                <div id="printRAC" style="font-size: 36px; font-weight: 800; color: #0f172a;"></div>
                <div id="printRACDetail" style="font-size: 12px; color: #6b7280; margin-top: 2px;"></div>
            </div>

            <!-- STATUT -->
            <div id="printStatus" style="padding: 12px; border-radius: 8px; text-align: center; font-weight: 700; font-size: 16px; margin-bottom: 16px; page-break-inside: avoid;"></div>

            <!-- PIED DE PAGE -->
            <div style="text-align: center; padding-top: 12px; border-top: 1px solid #e5e7eb;">
                <div style="font-size: 10px; color: #9ca3af;">Document gÃ©nÃ©rÃ© automatiquement &mdash; Les Artisans Verts Â· PropulsÃ© par 770 Lab</div>
                <div style="font-size: 9px; color: #d1d5db; margin-top: 2px;">Ce document est une estimation et ne constitue pas un devis contractuel</div>
            </div>
        </div>
    </div>


    <div id="pacDevisArea" style="display: none;"></div>
    <div id="iteDevisArea" style="display: none;"></div>

<script>
// Debug helper
const _debugLog=[];
function dbg(msg){
    _debugLog.push(new Date().toLocaleTimeString()+': '+msg);
    try{
        const el=document.getElementById('debugLog');
        if(el) el.innerHTML=_debugLog.slice(-30).map(l=>'<div>'+l+'</div>').join('');
    }catch(e){}
    console.log('[DBG]', msg);
}
window.onerror=function(msg,url,line,col,err){
    console.warn('JS ERROR:', msg, 'line', line);
    return false;
};

// ============================================
// BARÃˆMES DE REVENUS MPR 2026
// ============================================
// ============================================
// TABLE DÃ‰PARTEMENTS \u2192 ZONE CLIMATIQUE (source officielle)
// ============================================
const DEPT_ZONE = {
    "01":"H1","02":"H1","03":"H1","04":"H2","05":"H1","06":"H3","07":"H2","08":"H1","09":"H2","10":"H1",
    "11":"H3","12":"H2","13":"H3","14":"H1","15":"H1","16":"H2","17":"H2","18":"H2","19":"H1","20":"H3",
    "2A":"H3","2B":"H3",
    "21":"H1","22":"H2","23":"H1","24":"H2","25":"H1","26":"H2","27":"H1","28":"H1","29":"H2","30":"H3",
    "31":"H2","32":"H2","33":"H2","34":"H3","35":"H2","36":"H2","37":"H2","38":"H1","39":"H1","40":"H2",
    "41":"H2","42":"H1","43":"H1","44":"H2","45":"H1","46":"H2","47":"H2","48":"H2","49":"H2","50":"H2",
    "51":"H1","52":"H1","53":"H2","54":"H1","55":"H1","56":"H2","57":"H1","58":"H1","59":"H1","60":"H1",
    "61":"H1","62":"H1","63":"H1","64":"H2","65":"H2","66":"H3","67":"H1","68":"H1","69":"H1","70":"H1",
    "71":"H1","72":"H2","73":"H1","74":"H1","75":"H1","76":"H1","77":"H1","78":"H1","79":"H2","80":"H1",
    "81":"H2","82":"H2","83":"H3","84":"H2","85":"H2","86":"H2","87":"H1","88":"H1","89":"H1","90":"H1",
    "91":"H1","92":"H1","93":"H1","94":"H1","95":"H1"
};

function detectDept() {
    const deptInput = document.getElementById('departement').value.trim();
    if (!deptInput) return;
    const deptKey = deptInput.padStart(2,'0');

    // Auto IDF
    const IDF_DEPTS = ['75','77','78','91','92','93','94','95'];
    const isIDF = IDF_DEPTS.includes(deptKey);
    document.getElementById('region').value = isIDF ? 'IDF' : 'PROVINCE';
    detectProfil();

    const zone = DEPT_ZONE[deptInput] || DEPT_ZONE[deptKey];
    if (zone) {
        document.getElementById('zone').value = zone;
        document.getElementById('deptZoneResult').textContent = `\u2192 Zone ${zone}${isIDF ? ' Â· IDF' : ''}`;
        
        // Auto Tbase dimensionnement
        const tbase = DEPT_TBASE[deptKey] || DEPT_TBASE[deptInput];
        if (tbase !== undefined) {
            document.getElementById('dimTbase').value = tbase;
            calcDim();
        }
        calc();
        calcCEEDetail();
    } else {
        document.getElementById('deptZoneResult').textContent = '\u274C DÃ©partement inconnu';
        
    }
}

const REVENUS_2026 = {
    PROVINCE: {
        1: [17363, 22259, 31185],
        2: [25393, 32553, 45842],
        3: [30540, 39148, 55196],
        4: [35676, 45735, 64550],
        5: [40835, 52348, 73907],
        supplement: [5151, 6598, 9357]
    },
    IDF: {
        1: [24031, 29253, 40851],
        2: [35270, 42933, 60051],
        3: [42357, 51564, 71846],
        4: [49455, 60208, 84562],
        5: [56580, 68877, 96817],
        supplement: [7116, 8663, 12257]
    }
};

function getSeuilsForPersonnes(region, nb) {
    const data = REVENUS_2026[region];
    if (nb <= 5) return data[nb];
    const base = data[5];
    const sup = data.supplement;
    const extra = nb - 5;
    return [
        base[0] + sup[0] * extra,
        base[1] + sup[1] * extra,
        base[2] + sup[2] * extra
    ];
}

function detectProfil() {
    const region = document.getElementById('region').value;
    const nb = parseInt(document.getElementById('nbPersonnes').value);
    const rfr = parseFloat(document.getElementById('rfr').value);
    const bloc = document.getElementById('mprResultBloc');

    if (!rfr || rfr <= 0) {
        bloc.style.display = 'none';
        return;
    }

    const seuils = getSeuilsForPersonnes(region, nb);
    let profil, icon, label, desc, bg, color;

    if (rfr <= seuils[0]) {
        profil = 'BLEU'; icon = '\uD83D\uDD35'; label = 'Profil Bleu'; desc = 'Revenus trÃ¨s modestes';
        bg = 'linear-gradient(135deg, #1e40af, #3b82f6)'; color = '#ffffff';
    } else if (rfr <= seuils[1]) {
        profil = 'JAUNE'; icon = '\uD83D\uDFE1'; label = 'Profil Jaune'; desc = 'Revenus modestes';
        bg = 'linear-gradient(135deg, #ca8a04, #eab308)'; color = '#ffffff';
    } else if (rfr <= seuils[2]) {
        profil = 'VIOLET'; icon = '\uD83D\uDFE3'; label = 'Profil Violet'; desc = 'Revenus intermÃ©diaires';
        bg = 'linear-gradient(135deg, #6b21a8, #a855f7)'; color = '#ffffff';
    } else {
        profil = 'ROSE'; icon = '<span style="display:inline-block;width:28px;height:28px;border-radius:50%;background:#f472b6;"></span>'; label = 'Profil Rose'; desc = 'Revenus supÃ©rieurs';
        bg = 'linear-gradient(135deg, #9d174d, #f472b6)'; color = '#ffffff';
    }

    const regionLabel = region === 'IDF' ? 'ÃŽle-de-France' : 'Province';
    const seuilIdx = profil === 'BLEU' ? 0 : (profil === 'JAUNE' ? 1 : 2);
    const seuilVal = seuils[seuilIdx];

    // Update bloc
    bloc.style.display = 'block';
    bloc.style.background = bg;
    bloc.style.color = color;
    document.getElementById('mprProfilIcon').innerHTML = icon;
    document.getElementById('mprProfilLabel').textContent = label;
    document.getElementById('mprProfilDesc').textContent = desc;
    const zn = document.getElementById('zone').value;
    document.getElementById('mprInfoRegion').textContent = regionLabel + ' Â· ' + zn;
    document.getElementById('mprInfoFoyer').textContent = nb + ' pers.';
    document.getElementById('mprInfoSeuil').textContent = profil === 'ROSE'
        ? '> ' + seuilVal.toLocaleString('fr-FR') + ' \u20AC'
        : '\u2264 ' + seuilVal.toLocaleString('fr-FR') + ' \u20AC';
    document.getElementById('mprInfoRFR').textContent = 'RFR dÃ©clarÃ© : ' + rfr.toLocaleString('fr-FR') + ' \u20AC';

    // Aide MPR pour le scÃ©nario en cours
    const sc = document.getElementById('scenario').value;
    const mpr = D.MPR[sc] ? D.MPR[sc][profil] : 0;
    document.getElementById('mprInfoAide').textContent = mpr > 0
        ? 'Aide MaPrimeRÃ©nov\' : ' + mpr.toLocaleString('fr-FR') + ' \u20AC'
        : 'Pas d\'aide MaPrimeRÃ©nov\' pour ce profil';

    document.getElementById('categorie').value = profil;

    // Sync catÃ©gorie mÃ©nage CEE
    document.getElementById('menageCEE').value = (profil === 'BLEU') ? 'tm' : 'autres';

    calc();
    calcCEEDetail();
}

function toggleRevenus() {
    const body = document.getElementById('revenusBody');
    const arrow = document.getElementById('toggleArrow');
    if (body) body.classList.toggle('open');
    if (arrow) arrow.classList.toggle('open');
}

// ============================================
// CEE DÃ‰TAIL \u2014 BAR-TH-171 / 143 / 148
// (Source : fiche BAR-TH-171 vA78.4)
// ============================================
const CEE_PRICE = { tm: 12.5, autres: 7.5 }; // \u20AC/MWhc

const BAR143 = { H1: 134800, H2: 121000, H3: 100500 };

// BAR-TH-148 v.A73.3 \u2014 Forfaits officiels (Ã  compter du 01/11/2025)
const BAR148 = { maison: 14700, appartement: 11800 };

const BAR171 = {
    maison: {
        base: { lt140: 90900, ge140: 109200 },
        coefSurface: (S) => (S < 70 ? 0.5 : (S < 90 ? 0.7 : 1.0)),
        tranches: "Maison : S<70\u21920,5 Â· 70\u2264S<90\u21920,7 Â· S\u226590\u21921"
    },
    appartement: {
        base: { lt140: 48700, ge140: 58900 },
        coefSurface: (S) => (S < 35 ? 0.5 : (S < 60 ? 0.7 : 1.0)),
        tranches: "Appart : S<35\u21920,5 Â· 35\u2264S<60\u21920,7 Â· S\u226560\u21921"
    },
    coefZone: { H1: 1.2, H2: 1.0, H3: 0.7 }
};


// Surface dropdown \u2192 catÃ©gorie pour table CEE (maison: les 5 anciennes catÃ©gories)
function surfaceToCategory(surfaceVal) {
    // surfaceVal comes from the dropdown: "S<70", "70<=S<90", "S>=90" (maison) or "S<35", "35<=S<60", "S>=60" (appart)
    // Map to table CEE keys
    const map = {
        'S<70': 'S<70', '70<=S<90': '70<S<90', 'S>=90': '90<S<110',
        'S<35': 'S<70', '35<=S<60': '70<S<90', 'S>=60': '90<S<110'
    };
    return map[surfaceVal] || '90<S<110';
}

function getSurfaceLabel() {
    const sel = document.getElementById('surface');
    return sel.options[sel.selectedIndex].text;
}

// Surface coef from dropdown value (BAR-TH-171 officiel)
function getSurfaceCoef(surfaceVal) {
    const map = { 'S<70': 0.5, '70<=S<90': 0.7, 'S>=90': 1, 'S<35': 0.5, '35<=S<60': 0.7, 'S>=60': 1 };
    return map[surfaceVal] || 1;
}

// Dynamic surface options based on type logement
function updateSurfaceOptions() {
    const tl = document.getElementById('typeLogement').value;
    const sel = document.getElementById('surface');
    const oldCoef = getSurfaceCoef(sel.value); // preserve coef level
    sel.innerHTML = '';
    if (tl === 'maison') {
        sel.add(new Option('S < 70 mÂ²', 'S<70'));
        sel.add(new Option('70 \u2264 S < 90 mÂ²', '70<=S<90'));
        sel.add(new Option('S \u2265 90 mÂ²', 'S>=90'));
    } else {
        sel.add(new Option('S < 35 mÂ²', 'S<35'));
        sel.add(new Option('35 \u2264 S < 60 mÂ²', '35<=S<60'));
        sel.add(new Option('S \u2265 60 mÂ²', 'S>=60'));
    }
    // Set option with same coef level
    const coefToMaison = { 0.5: 'S<70', 0.7: '70<=S<90', 1: 'S>=90' };
    const coefToAppart = { 0.5: 'S<35', 0.7: '35<=S<60', 1: 'S>=60' };
    const targetMap = tl === 'maison' ? coefToMaison : coefToAppart;
    sel.value = targetMap[oldCoef] || sel.options[sel.options.length - 1].value;
}

function onTypeLogementChange() {
    updateSurfaceOptions();
    calc();
}

function syncEtas() {
    const val = document.getElementById('etas').value;
    document.getElementById('ceeEtas').value = (val === '111-140') ? 'lt140' : 'ge140';
    calcCEEDetail();
}

// ===== PRODUIT & OPTIONS =====
function updatePAC() {
    var key = document.getElementById('marquePAC').value;
    var p = PAC_CATALOG[key];
    var el = document.getElementById('pacInfo');
    if (!p || !el) return;
    var ev = (p.etas || '').split('/').map(function(s){ return parseFloat(s.trim()); });
    var appType = (ev.length > 1 && ev[1] >= 100) ? 'Haute temp\u00e9rature' : 'Basse temp\u00e9rature';
    var etasHT = ev.length > 1 ? ev[1] : ev[0];
    el.innerHTML = '<b>' + p.m + '</b> \u00b7 ' + p.cls + ' \u00b7 ETAS ' + p.etas + '% \u00b7 COP ' + p.cop35 + '/' + p.cop55 + ' \u00b7 ' + p.ref + ' \u00b7 ' + p.dim +
        '<br><span style="color:#16a34a">\u2192 Application : <b>' + appType + '</b> \u00b7 ETAS HT : <b>' + etasHT + '%</b> (' + (etasHT >= 140 ? '\u2265 140%' : '111-140%') + ')</span>';
    var dm = document.getElementById('dimMarque');
    var dr = document.getElementById('dimReference');
    if (dm) dm.value = p.m;
    if (dr) dr.value = p.r;
}

function syncEtasFromPAC() {
    var key = document.getElementById('marquePAC').value;
    var p = PAC_CATALOG[key];
    if (!p) return;
    var ev = (p.etas || '').split('/').map(function(s){ return parseFloat(s.trim()); });
    var etasHT = ev.length > 1 ? ev[1] : ev[0];
    var etasSel = document.getElementById('etas');
    if (etasSel) {
        etasSel.value = etasHT >= 140 ? '140-170' : '111-140';
        syncEtas();
    }
}

function toggleProduitOpt(id, show) {
    var el = document.getElementById(id);
    if (!el) return;
    el.style.display = show ? 'block' : 'none';
    autoSyncScenario();
}

function getAutoScenario() {
    var ssc = document.getElementById('includeSSC');
    var bal = document.getElementById('includeBallon');
    if (ssc && ssc.value === 'oui') return 'PAC + SSC';
    if (bal && bal.value === 'oui') return 'PAC + BALLON THERMO';
    return 'PAC';
}

function autoSyncScenario() {
    var sc = getAutoScenario();
    var sel = document.getElementById('scenario');
    if (sel) { sel.value = sc; }
    var disp = document.getElementById('scenarioAutoDisplay');
    if (disp) { disp.value = sc; }
    syncEtasFromPAC();
    onScenarioChange();
}

function onScenarioChange() {
    const sc = document.getElementById('scenario').value;
    const isSSC = (sc === 'SSC');
    // SSC seul: hide ETAS, surface, barÃ¨me PAC (143 = forfait zone only)
    document.getElementById('etasGroup').style.display = isSSC ? 'none' : '';
    document.getElementById('ceeSurfaceGroup').style.display = isSSC ? 'none' : '';
    document.getElementById('baremeCard').style.display = isSSC ? 'none' : '';
    const dimCard = document.getElementById('dimensionnementCard');
    if (dimCard) dimCard.style.display = isSSC ? 'none' : '';
    // Demande mairie for SSC scenarios
    const mairieRow = document.getElementById('mairieRow');
    if (mairieRow) mairieRow.style.display = (sc === 'PAC + SSC' || sc === 'SSC') ? '' : 'none';
    detectProfil();
    calc();
    if(typeof logScenarioChange==='function') logScenarioChange();
}

let _calcRunning = false;

let lastCEEDetailPrime = 0;
let lastCEEDetailKwhc = 0;

function toggleCEE() {
    const body = document.getElementById('ceeBody');
    const arrow = document.getElementById('ceeToggleArrow');
    if (body) body.classList.toggle('open');
    if (arrow) arrow.classList.toggle('open');
}

// Quelle(s) fiche(s) BAR-TH s'appliquent selon le scÃ©nario
// Depuis 01/01/2026 : BAR-TH-148 NON cumulable avec BAR-TH-171 (arrÃªtÃ© 15/12/2025)
function getCEEFiches(scenario) {
    switch(scenario) {
        case 'PAC':                    return ['171'];
        case 'PAC + BALLON Ã‰LECTRIQUE': return ['171'];
        case 'PAC + BALLON THERMO':     return ['171']; // 148 non cumulable depuis 01/2026
        case 'PAC + SSC':              return ['171', '143']; // cumul 171+143, CdP sur 171 uniquement
        case 'SSC':                    return ['143']; // SSC seul = BAR-TH-143 uniquement
        default:                        return ['171'];
    }
}

function calcCEEDetail() {
  try {
    const sc = document.getElementById('scenario').value;
    const zn = document.getElementById('zone').value;
    const menage = document.getElementById('menageCEE').value;
    const price = CEE_PRICE[menage] || CEE_PRICE.autres;
    const tl = document.getElementById('typeLogement').value;
    const surfaceVal = document.getElementById('surface').value;
    const coefS = getSurfaceCoef(surfaceVal);

    // Update surface info label
    const ceeSurfInfo = document.getElementById('ceeSurfaceInfo');
    if (ceeSurfInfo) {
        const s = parseInt(document.getElementById('ceeSurface').value) || 0;
        if (tl === 'maison') {
            ceeSurfInfo.textContent = s < 70 ? '\u2192 S < 70 mÂ² (coef 0,5)' : (s < 90 ? '\u2192 70 \u2264 S < 90 mÂ² (coef 0,7)' : '\u2192 S \u2265 90 mÂ² (coef 1)');
        } else {
            ceeSurfInfo.textContent = s < 35 ? '\u2192 S < 35 mÂ² (coef 0,5)' : (s < 60 ? '\u2192 35 \u2264 S < 60 mÂ² (coef 0,7)' : '\u2192 S \u2265 60 mÂ² (coef 1)');
        }
    }

    const fiches = getCEEFiches(sc);

    // Labels
    document.getElementById('ceeScenarioLabel').textContent = SCENARIO_NAMES[sc] || sc;
    document.getElementById('ceeFichesLabel').textContent = fiches.map(f => 'BAR-TH-' + f).join(' + ');
    const noteEl = document.getElementById('ceeNonCumulNote');
    if (noteEl) { noteEl.style.display = 'none'; }

    // Show/hide blocs
    document.getElementById('ceeBloc171').classList.toggle('cee-hidden', !fiches.includes('171'));
    document.getElementById('ceeBloc148').classList.toggle('cee-hidden', !fiches.includes('148'));
    document.getElementById('ceeBloc143').classList.toggle('cee-hidden', !fiches.includes('143'));

    let totalKwhc = 0;
    let details = [];
    let statusParts = [];

    // === BAR-TH-171 ===
    if (fiches.includes('171')) {
        const etasKey = document.getElementById('etas').value === '111-140' ? 'lt140' : 'ge140';
        const base = BAR171[tl].base[etasKey];
        const cz = BAR171.coefZone[zn];
        document.getElementById('ceeCoefSurface').value = coefS.toString().replace('.', ',');
        const CDP = 5; // Coup de pouce Chauffage \u00D75 (arrÃªtÃ© 74e, oct 2025)
        const kwhc171 = base * coefS * cz * CDP;
        totalKwhc += kwhc171;
        details.push(`171: ${fmtIntCEE(kwhc171)}`);
        statusParts.push(`\u2705 171: base ${fmtIntCEE(base)} \u00D7 coef ${coefS} \u00D7 zone ${cz} \u00D7 CdP \u00D7${CDP}`);
    }

    // === BAR-TH-148 ===
    if (fiches.includes('148')) {
        const kwhc148 = BAR148[tl] || 14700;
        totalKwhc += kwhc148;
        details.push(`148: ${fmtIntCEE(kwhc148)}`);
        const typeLabel = tl === 'maison' ? 'Maison' : 'Appart';
        document.getElementById('cee148Forfait').value = `${fmtIntCEE(kwhc148)} kWhc (${typeLabel})`;
        const prime148 = (kwhc148 / 1000) * price;
        document.getElementById('ceeOut148').textContent = fmtEurCEE(prime148);
        document.getElementById('ceeOut148Detail').textContent = `${fmtIntCEE(kwhc148)} kWhc`;
        document.getElementById('ceeKpi148').style.display = 'block';
        statusParts.push(`\u2705 148: ${fmtIntCEE(kwhc148)} kWhc (v.A73.3 Â· ${typeLabel})`);
    } else {
        document.getElementById('ceeKpi148').style.display = 'none';
    }

    // === BAR-TH-143 ===
    if (fiches.includes('143')) {
        const base143 = BAR143[zn];
        const CDP143 = 2;
        const kwhc143avecCdP = base143 * CDP143;
        // Si cumul avec 171 : CdP va sur 171 (\u00D75 > \u00D72), 143 = forfait base
        // Si 143 seul : CdP \u00D72 applicable
        const has171 = fiches.includes('171');
        const kwhc143 = has171 ? base143 : kwhc143avecCdP;
        totalKwhc += kwhc143;
        details.push(`143: ${fmtIntCEE(kwhc143)}`);
        if (has171) {
            document.getElementById('cee143Forfait').value = `${fmtIntCEE(base143)} kWhc (${zn}) \u2014 CdP sur 171`;
            statusParts.push(`\u2705 143: forfait ${zn} = ${fmtIntCEE(base143)} kWhc (CdP \u00D7${CDP143} = ${fmtIntCEE(kwhc143avecCdP)} si seul)`);
        } else {
            document.getElementById('cee143Forfait').value = `${fmtIntCEE(base143)} \u00D7 ${CDP143} = ${fmtIntCEE(kwhc143avecCdP)} kWhc (${zn})`;
            statusParts.push(`\u2705 143: forfait ${zn} ${fmtIntCEE(base143)} \u00D7 CdP \u00D7${CDP143} = ${fmtIntCEE(kwhc143avecCdP)} kWhc`);
        }
    }

    const primeCEE = (totalKwhc / 1000) * price;
    lastCEEDetailPrime = primeCEE;
    lastCEEDetailKwhc = totalKwhc;

    document.getElementById('ceeOutKwhc').textContent = `${fmtIntCEE(totalKwhc)} kWhc`;
    document.getElementById('ceeOutDetail').textContent = details.join(' + ');
    document.getElementById('ceeOutPrime').textContent = fmtEurCEE(primeCEE);
    document.getElementById('ceeOutPrix').textContent = `${price.toString().replace('.', ',')} \u20AC/MWhc Â· ${menage === 'tm' ? 'TrÃ¨s modestes' : 'Autres'}`;

    const resultEl = document.getElementById('ceeResult');
    if (statusParts.length > 0) {
        resultEl.className = 'cee-result show';
        resultEl.innerHTML = statusParts.join('<br>');
    } else {
        resultEl.className = 'cee-result';
    }

  } catch(e) {
    console.error('calcCEEDetail() error:', e);
    if(typeof dbg==='function') dbg('\u274C calcCEEDetail: '+e.message+' at line '+(e.stack||'').split('\n')[1]);
    const errDiv = document.getElementById('calcErrorDebug');
    if (errDiv) { errDiv.textContent = 'âš \u0161\u00A0 CEEDetail: ' + e.message; errDiv.style.display = 'block'; errDiv.style.color = '#dc2626'; errDiv.style.background = '#fef2f2'; }
  }
}

function fmtIntCEE(n) {
    return isFinite(n) ? Math.round(n).toLocaleString('fr-FR') : '\u2014';
}
function fmtEurCEE(n) {
    return isFinite(n) ? Math.round(n).toLocaleString('fr-FR') + ' \u20AC' : '\u2014';
}

// ============================================
// DONNÃ‰ES PRINCIPALES
// ============================================
const D={TTC:{"PAC":10890,"PAC + BALLON Ã‰LECTRIQUE":13750,"PAC + BALLON THERMO":13750,"PAC + SSC":25850,"SSC":15000},MPR:{"PAC":{BLEU:5000,JAUNE:4000,VIOLET:3000,ROSE:0},"PAC + BALLON Ã‰LECTRIQUE":{BLEU:5000,JAUNE:4000,VIOLET:3000,ROSE:0},"PAC + BALLON THERMO":{BLEU:6200,JAUNE:4800,VIOLET:3400,ROSE:0},"PAC + SSC":{BLEU:15000,JAUNE:12000,VIOLET:7000,ROSE:0},"SSC":{BLEU:10000,JAUNE:8000,VIOLET:4000,ROSE:0}},COUT:{"PAC":6600,"PAC + BALLON Ã‰LECTRIQUE":6800,"PAC + BALLON THERMO":7200,"PAC + SSC":11650,"SSC":8500},COUT_DETAIL:{"PAC":{pac_materiel:2900,pac_pose:2500,ballon_materiel:0,ballon_pose:0,accessoires:800,admin:400,mairie:0},"PAC + BALLON Ã‰LECTRIQUE":{pac_materiel:2900,pac_pose:2500,ballon_materiel:200,ballon_pose:0,accessoires:800,admin:400,mairie:0},"PAC + BALLON THERMO":{pac_materiel:2900,pac_pose:2500,ballon_materiel:1100,ballon_pose:500,accessoires:800,admin:400,mairie:0},"PAC + SSC":{pac_materiel:5700,pac_pose:4500,ballon_materiel:0,ballon_pose:0,accessoires:800,admin:400,mairie:250},"SSC":{pac_materiel:4200,pac_pose:3500,ballon_materiel:0,ballon_pose:0,accessoires:500,admin:300,mairie:250}},CEE:{"140-170":{H1:{PAC:{"S<70":274800,"70<S<90":384720,"90<S<110":549600,"110<S<130":604560,"S>130":879360},"BALLON ELECTRIQUE":{"S<70":274800,"70<S<90":384720,"90<S<110":549600,"110<S<130":604560,"S>130":879360},"BALLON THERMO":{"S<70":289500,"70<S<90":399420,"90<S<110":564300,"110<S<130":619260,"S>130":894060},"BALLON SSC":{"S<70":769200,"70<S<90":769200,"90<S<110":769200,"110<S<130":769200,"S>130":769200}},H2:{PAC:{"S<70":229000,"70<S<90":320600,"90<S<110":458000,"110<S<130":503800,"S>130":732800},"BALLON ELECTRIQUE":{"S<70":229000,"70<S<90":320600,"90<S<110":458000,"110<S<130":503800,"S>130":732800},"BALLON THERMO":{"S<70":243700,"70<S<90":335300,"90<S<110":472700,"110<S<130":518500,"S>130":747500},"BALLON SSC":{"S<70":769200,"70<S<90":769200,"90<S<110":769200,"110<S<130":769200,"S>130":769200}},H3:{PAC:{"S<70":160300,"70<S<90":224420,"90<S<110":320600,"110<S<130":352660,"S>130":512960},"BALLON ELECTRIQUE":{"S<70":160300,"70<S<90":224420,"90<S<110":320600,"110<S<130":352660,"S>130":512960},"BALLON THERMO":{"S<70":175000,"70<S<90":239120,"90<S<110":335300,"110<S<130":367360,"S>130":527660},"BALLON SSC":{"S<70":769200,"70<S<90":769200,"90<S<110":769200,"110<S<130":769200,"S>130":769200}}},"111-140":{H1:{PAC:{"S<70":238500,"70<S<90":333900,"90<S<110":477000,"110<S<130":524700,"S>130":763200},"BALLON ELECTRIQUE":{"S<70":238500,"70<S<90":333900,"90<S<110":477000,"110<S<130":524700,"S>130":763200},"BALLON THERMO":{"S<70":253200,"70<S<90":348600,"90<S<110":491700,"110<S<130":539400,"S>130":777900},"BALLON SSC":{"S<70":769200,"70<S<90":769200,"90<S<110":769200,"110<S<130":769200,"S>130":769200}},H2:{PAC:{"S<70":198750,"70<S<90":278250,"90<S<110":397500,"110<S<130":437250,"S>130":636000},"BALLON ELECTRIQUE":{"S<70":198750,"70<S<90":278250,"90<S<110":397500,"110<S<130":437250,"S>130":636000},"BALLON THERMO":{"S<70":213450,"70<S<90":292950,"90<S<110":412200,"110<S<130":451950,"S>130":650700},"BALLON SSC":{"S<70":769200,"70<S<90":769200,"90<S<110":769200,"110<S<130":769200,"S>130":769200}},H3:{PAC:{"S<70":139125,"70<S<90":194775,"90<S<110":278250,"110<S<130":306075,"S>130":445200},"BALLON ELECTRIQUE":{"S<70":139125,"70<S<90":194775,"90<S<110":278250,"110<S<130":306075,"S>130":445200},"BALLON THERMO":{"S<70":153825,"70<S<90":209475,"90<S<110":292950,"110<S<130":320775,"S>130":459900},"BALLON SSC":{"S<70":769200,"70<S<90":769200,"90<S<110":769200,"110<S<130":769200,"S>130":769200}}}}};
const M={"PAC":"PAC","PAC + BALLON Ã‰LECTRIQUE":"BALLON ELECTRIQUE","PAC + BALLON THERMO":"BALLON THERMO","PAC + SSC":"BALLON SSC","SSC":"BALLON SSC"};

const SCENARIO_NAMES = {"PAC":"PAC","PAC + BALLON Ã‰LECTRIQUE":"PAC + Ballon Ã‰lectrique","PAC + BALLON THERMO":"PAC + Ballon Thermo","PAC + SSC":"PAC + SSC","SSC":"SSC"};

// ============================================
// CATALOGUE PAC â€” Fiches techniques complÃ¨tes
// ============================================
const PAC_CATALOG = {
    THALEOS_04M:{m:'THALEOS',n:'PAC THALEOS R290 4kW Mono ETAS 195%',r:'THAHP04-M',a:'220-240V/1Ph',cop35:'5,15',cop55:'3,20',cap35:'4,5kW',cap55:'4,6kW',cls:'A+++/A+++',etas:'195/151',scop:'5,20/4,00',db:'56dB(A)',dim:'1130x420x704mm',kg:'93Kg',ref:'R290',ch:'-',pr:'18A',rg:'6'},
    THALEOS_06M:{m:'THALEOS',n:'PAC THALEOS R290 6kW Mono ETAS 194%',r:'THAHP06-M',a:'220-240V/1Ph',cop35:'4,95',cop55:'3,15',cap35:'6,35kW',cap55:'6,40kW',cls:'A+++/A+++',etas:'194/151',scop:'5,24/4,03',db:'56dB(A)',dim:'1130x420x704mm',kg:'93Kg',ref:'R290',ch:'-',pr:'18A',rg:'6'},
    THALEOS_08M:{m:'THALEOS',n:'PAC THALEOS R290 8kW Mono ETAS 198%',r:'THAHP08-M',a:'220-240V/1Ph',cop35:'5,00',cop55:'3,30',cap35:'8,40kW',cap55:'7,80kW',cls:'A+++/A+++',etas:'198/152',scop:'5,21/3,94',db:'57dB(A)',dim:'1280x420x1040mm',kg:'141Kg',ref:'R290',ch:'-',pr:'18A',rg:'6'},
    THALEOS_10M:{m:'THALEOS',n:'PAC THALEOS R290 10kW Mono ETAS 203%',r:'THAHP10-M',a:'220-240V/1Ph',cop35:'4,80',cop55:'3,25',cap35:'10,0kW',cap55:'9,50kW',cls:'A+++/A+++',etas:'203/154',scop:'5,16/3,93',db:'57dB(A)',dim:'1280x420x1040mm',kg:'141Kg',ref:'R290',ch:'-',pr:'18A',rg:'6'},
    THALEOS_12M:{m:'THALEOS',n:'PAC THALEOS R290 12kW Mono ETAS 186%',r:'THAHP12-M',a:'220-240V/1Ph',cop35:'4,90',cop55:'3,25',cap35:'12,0kW',cap55:'12,0kW',cls:'A+++/A+++',etas:'186/150',scop:'4,96/3,86',db:'57dB(A)',dim:'1280x420x1040mm',kg:'156Kg',ref:'R290',ch:'1,35kg',pr:'35A',rg:'6'},
    THALEOS_14M:{m:'THALEOS',n:'PAC THALEOS R290 14kW Mono ETAS 186%',r:'THAHP14-M',a:'220-240V/1Ph',cop35:'4,80',cop55:'3,20',cap35:'14,0kW',cap55:'14,0kW',cls:'A+++/A+++',etas:'186/150',scop:'5,13/3,93',db:'58dB(A)',dim:'1280x420x1040mm',kg:'156Kg',ref:'R290',ch:'1,35kg',pr:'35A',rg:'6'},
    THALEOS_16M:{m:'THALEOS',n:'PAC THALEOS R290 16kW Mono ETAS 188%',r:'THAHP16-M',a:'220-240V/1Ph',cop35:'4,70',cop55:'3,15',cap35:'15,1kW',cap55:'15,1kW',cls:'A+++/A+++',etas:'188/150',scop:'5,16/3,89',db:'60dB(A)',dim:'1280x420x1040mm',kg:'156Kg',ref:'R290',ch:'1,35kg',pr:'35A',rg:'6'},
    THALEOS_08T:{m:'THALEOS',n:'PAC THALEOS R290 8kW Tri ETAS 198%',r:'THAHP08-T',a:'380-415V/3Ph',cop35:'5,00',cop55:'3,30',cap35:'8,40kW',cap55:'7,80kW',cls:'A+++/A+++',etas:'198/152',scop:'5,16/3,89',db:'57dB(A)',dim:'1280x420x1040mm',kg:'141Kg',ref:'R290',ch:'1,35kg',pr:'10A',rg:'6'},
    THALEOS_10T:{m:'THALEOS',n:'PAC THALEOS R290 10kW Tri ETAS 203%',r:'THAHP10-T',a:'380-415V/3Ph',cop35:'4,80',cop55:'3,25',cap35:'10,0kW',cap55:'9,50kW',cls:'A+++/A+++',etas:'203/154',scop:'5,16/3,93',db:'57dB(A)',dim:'1280x420x1040mm',kg:'141Kg',ref:'R290',ch:'1,35kg',pr:'10A',rg:'6'},
    THALEOS_12T:{m:'THALEOS',n:'PAC THALEOS R290 12kW Tri ETAS 150%',r:'THAHP12-T',a:'380-415V/3Ph',cop35:'4,90',cop55:'3,25',cap35:'12,0kW',cap55:'12,0kW',cls:'A+++/A+++',etas:'186/150',scop:'4,98/3,86',db:'58dB(A)',dim:'1280x420x1040mm',kg:'141Kg',ref:'R290',ch:'1,35kg',pr:'10A',rg:'6'},
    THALEOS_14T:{m:'THALEOS',n:'PAC THALEOS R290 14kW Tri ETAS 150%',r:'THAHP14-T',a:'380-415V/3Ph',cop35:'4,80',cop55:'3,20',cap35:'14,0kW',cap55:'14,0kW',cls:'A+++/A+++',etas:'186/150',scop:'5,13/3,93',db:'59dB(A)',dim:'1280x420x1040mm',kg:'156Kg',ref:'R290',ch:'1,35kg',pr:'14A',rg:'6'},
    THALEOS_16T:{m:'THALEOS',n:'PAC THALEOS R290 16kW Tri ETAS 150%',r:'THAHP16-T',a:'380-415V/3Ph',cop35:'4,70',cop55:'3,15',cap35:'15,1kW',cap55:'15,1kW',cls:'A+++/A+++',etas:'188/150',scop:'5,05/3,88',db:'60dB(A)',dim:'1280x420x1040mm',kg:'156Kg',ref:'R290',ch:'1,35kg',pr:'14A',rg:'6'},
    THALEOS_BI_08M:{m:'THALEOS',n:'PAC THALEOS Bi-Bloc R290 8kW Mono ETAS 198%',r:'THAHPOUT8KW-M',a:'220-240V/1Ph',cop35:'5,00',cop55:'3,30',cap35:'8,10kW',cap55:'7,60kW',cls:'A+++/A+++',etas:'198/152',scop:'5,16/3,89',db:'57dB(A)',dim:'1280x420x1040mm',kg:'128Kg',ref:'R290',ch:'1,35kg',pr:'18A',rg:'6'},
    THALEOS_BI_10M:{m:'THALEOS',n:'PAC THALEOS Bi-Bloc R290 10kW Mono ETAS 203%',r:'THAHPOUT10KW-M',a:'220-240V/1Ph',cop35:'4,80',cop55:'3,25',cap35:'9,80kW',cap55:'9,40kW',cls:'A+++/A+++',etas:'203/154',scop:'5,16/3,93',db:'57dB(A)',dim:'1280x420x1040mm',kg:'128Kg',ref:'R290',ch:'1,35kg',pr:'18A',rg:'6'},
    THALEOS_BI_12M:{m:'THALEOS',n:'PAC THALEOS Bi-Bloc R290 12kW Mono ETAS 186%',r:'THAHPOUT12KW-M',a:'220-240V/1Ph',cop35:'4,90',cop55:'3,25',cap35:'11,6kW',cap55:'11,5kW',cls:'A+++/A+++',etas:'186/150',scop:'4,98/3,86',db:'58dB(A)',dim:'1280x420x1040mm',kg:'143Kg',ref:'R290',ch:'1,35kg',pr:'18A',rg:'6'},
    THALEOS_BI_14M:{m:'THALEOS',n:'PAC THALEOS Bi-Bloc R290 14kW Mono ETAS 186%',r:'THAHPOUT14KW-M',a:'220-240V/1Ph',cop35:'4,80',cop55:'3,20',cap35:'13,6kW',cap55:'13,5kW',cls:'A+++/A+++',etas:'186/150',scop:'5,13/3,93',db:'59dB(A)',dim:'1280x420x1040mm',kg:'143Kg',ref:'R290',ch:'1,35kg',pr:'35A',rg:'6'},
    THALEOS_BI_16M:{m:'THALEOS',n:'PAC THALEOS Bi-Bloc R290 16kW Mono ETAS 188%',r:'THAHPOUT16KW-M',a:'220-240V/1Ph',cop35:'4,70',cop55:'3,15',cap35:'14,9kW',cap55:'14,9kW',cls:'A+++/A+++',etas:'188/150',scop:'5,05/3,88',db:'60dB(A)',dim:'1280x420x1040mm',kg:'143Kg',ref:'R290',ch:'1,35kg',pr:'35A',rg:'6'},
    WELLEA_12T:{m:'WELLEA',n:'PAC WELLEA R290 12kW HT Tri',r:'BDHW-120R-04T35',a:'380V/3Ph',cop35:'4,90',cop55:'3,25',cap35:'12,1kW',cap55:'12,1kW',cls:'A+++',etas:'150',scop:'3,86',db:'-',dim:'-',kg:'-',ref:'R290',ch:'-',pr:'-',rg:'6'},
    WELLEA_14T:{m:'WELLEA',n:'PAC WELLEA R290 14kW HT Tri',r:'BDHW-140R-04T35',a:'380V/3Ph',cop35:'4,80',cop55:'3,20',cap35:'14,5kW',cap55:'14,5kW',cls:'A+++',etas:'150',scop:'3,93',db:'-',dim:'-',kg:'-',ref:'R290',ch:'-',pr:'-',rg:'6'},
    WELLEA_16T:{m:'WELLEA',n:'PAC WELLEA R290 16kW HT Tri',r:'BDHW-160R-04T35',a:'380V/3Ph',cop35:'4,70',cop55:'3,15',cap35:'15,9kW',cap55:'15,9kW',cls:'A+++',etas:'150',scop:'3,88',db:'-',dim:'-',kg:'-',ref:'R290',ch:'-',pr:'-',rg:'6'},
    WELLEA_16M:{m:'WELLEA',n:'PAC WELLEA R290 16kW HT Mono',r:'BDHW-160R-04M25',a:'220-240V/1Ph',cop35:'4,70',cop55:'3,15',cap35:'15,9kW',cap55:'15,9kW',cls:'A+++',etas:'150',scop:'3,88',db:'-',dim:'-',kg:'-',ref:'R290',ch:'-',pr:'-',rg:'6'},
    WOLF_FHA_05_06_230:{m:'WOLF',n:'PAC WOLF FHA 05/06 5kW Mono ETAS 181%',r:'9148083',a:'220-240V/1Ph',cop35:'4,7',cop55:'3,1',cap35:'5,0kW',cap55:'5,0kW',cls:'A+++',etas:'181/127',scop:'4,7/3,1',db:'56,8dB(A)',dim:'1295x718x429mm',kg:'79+27Kg',ref:'R32',ch:'1,4kg',pr:'-',rg:'BM-2'},
    WOLF_FHA_06_07_230:{m:'WOLF',n:'PAC WOLF FHA 06/07 6kW Mono ETAS 167%',r:'9148084',a:'220-240V/1Ph',cop35:'5,2',cop55:'2,8',cap35:'6,0kW',cap55:'6,0kW',cls:'A++',etas:'167/129',scop:'5,2/2,8',db:'59,8dB(A)',dim:'1295x718x429mm',kg:'79+27Kg',ref:'R32',ch:'1,4kg',pr:'-',rg:'BM-2'},
    WOLF_FHA_08_10_230:{m:'WOLF',n:'PAC WOLF FHA 08/10 8kW Mono ETAS 196%',r:'9148085',a:'220-240V/1Ph',cop35:'4,9',cop55:'2,9',cap35:'8,0kW',cap55:'8,0kW',cls:'A+++',etas:'196/133',scop:'4,9/2,9',db:'60,5dB(A)',dim:'1385x865x526mm',kg:'88+27Kg',ref:'R32',ch:'1,4kg',pr:'-',rg:'BM-2'},
    WOLF_FHA_11_14_230:{m:'WOLF',n:'PAC WOLF FHA 11/14 11kW Mono ETAS 174%',r:'9148086',a:'220-240V/1Ph',cop35:'5,1',cop55:'3,1',cap35:'11,0kW',cap55:'11,0kW',cls:'A++',etas:'174/126',scop:'5,1/3,1',db:'60,8dB(A)',dim:'1385x865x526mm',kg:'122+27Kg',ref:'R32',ch:'1,75kg',pr:'-',rg:'BM-2'},
    WOLF_FHA_14_17_230:{m:'WOLF',n:'PAC WOLF FHA 14/17 14kW Mono ETAS 178%',r:'9148087',a:'220-240V/1Ph',cop35:'5,0',cop55:'3,1',cap35:'13,0kW',cap55:'13,0kW',cls:'A+++',etas:'178/131',scop:'5,0/3,1',db:'66,4dB(A)',dim:'1385x865x526mm',kg:'122+27Kg',ref:'R32',ch:'1,75kg',pr:'-',rg:'BM-2'},
    WOLF_FHA_14_17_400:{m:'WOLF',n:'PAC WOLF FHA 14/17 14kW Tri ETAS 173%',r:'9148089',a:'380-415V/3Ph',cop35:'5,1',cop55:'3,1',cap35:'14,0kW',cap55:'13,0kW',cls:'A++',etas:'173/129',scop:'5,1/3,1',db:'66,6dB(A)',dim:'1385x865x526mm',kg:'122+27Kg',ref:'R32',ch:'1,75kg',pr:'-',rg:'BM-2'}
};

function getCEE(et, zn, cs, sf){
    if(!D.CEE[et]) return 0;
    if(!D.CEE[et][zn]) return 0;
    if(!D.CEE[et][zn][cs]) return 0;
    if(!D.CEE[et][zn][cs][sf]) return 0;
    return D.CEE[et][zn][cs][sf];
}

let mode=0;
let autoGesteApplied = false;
let savedRacPourcent = 0;
let savedRacOffert = 0;

function fmt(n){
    return Math.round(n).toLocaleString('fr-FR')+' \u20AC';
}

function onTTCEdit(){
    const el = document.getElementById('totalTTCEditable');
    const raw = el.textContent.replace(/[^0-9]/g, '');
    const val = parseInt(raw) || 0;
    document.getElementById('totalTTCInput').value = val;
    document.getElementById('lockTTC').checked = false;
    calc();
}

// Prevent Enter from adding linebreaks, and reformat on blur
document.addEventListener('DOMContentLoaded', function(){
    const tte = document.getElementById('totalTTCEditable');
    if(tte){
        tte.addEventListener('keydown', function(e){
            if(e.key === 'Enter'){ e.preventDefault(); tte.blur(); }
        });
        tte.addEventListener('blur', function(){
            const raw = tte.textContent.replace(/[^0-9]/g, '');
            const val = parseInt(raw) || 0;
            document.getElementById('totalTTCInput').value = val;
            tte.textContent = fmt(val);
        });
    }
});

function updateFromTTC(){
    document.getElementById('lockTTC').checked=false;
    calc();
}

function updateFromDetail(){
    document.getElementById('lockCoutHT').checked=false;
    
    const fields = [
        ['coutPACMateriel','qtePACMateriel','totalPACMateriel'],
        ['coutPACPose','qtePACPose','totalPACPose'],
        ['coutBallonMateriel','qteBallonMateriel','totalBallonMateriel'],
        ['coutBallonPose','qteBallonPose','totalBallonPose'],
        ['coutAccessoires','qteAccessoires','totalAccessoires'],
        ['coutAdmin','qteAdmin','totalAdmin'],
        ['coutMandat','qteMandat','totalMandat'],
        ['coutMairie','qteMairie','totalMairie']
    ];
    
    let totalGlobal = 0;
    fields.forEach(([cId, qId, tId]) => {
        const c = parseFloat(document.getElementById(cId).value) || 0;
        const q = parseFloat(document.getElementById(qId).value) || 0;
        const t = c * q;
        document.getElementById(tId).textContent = fmt(t);
        totalGlobal += t;
    });
    
    // PrÃ©visite (checkbox)
    const prevChecked = document.getElementById('checkPrevisite').checked;
    const prevCost = prevChecked ? (parseFloat(document.getElementById('coutPrevisite').value) || 0) : 0;
    document.getElementById('totalPrevisite').textContent = prevChecked ? fmt(prevCost) : '0 \u20AC';
    totalGlobal += prevCost;
    
    document.getElementById('coutTotalHTDisplay').textContent = fmt(totalGlobal);
    calc();
}

function getCoutFromFields() {
    const f = ['coutPACMateriel','coutPACPose','coutBallonMateriel','coutBallonPose','coutAccessoires','coutAdmin','coutMandat','coutMairie'];
    const q = ['qtePACMateriel','qtePACPose','qteBallonMateriel','qteBallonPose','qteAccessoires','qteAdmin','qteMandat','qteMairie'];
    let t = 0;
    for (let i = 0; i < f.length; i++) {
        t += (parseFloat(document.getElementById(f[i]).value)||0) * (parseFloat(document.getElementById(q[i]).value)||0);
    }
    if (document.getElementById('checkPrevisite').checked) t += parseFloat(document.getElementById('coutPrevisite').value)||0;
    return t;
}

function getCoutFromDetail(sc, ad) {
    if (!D.COUT_DETAIL[sc]) return D.COUT[sc] || 0;
    const d = D.COUT_DETAIL[sc];
    let t = d.pac_materiel + d.pac_pose + d.ballon_materiel + d.ballon_pose + d.accessoires + d.admin + (d.mairie || 0);
    if (ad > 0) t += Math.round(ad * 0.12);
    if (document.getElementById('checkPrevisite').checked) t += parseFloat(document.getElementById('coutPrevisite').value)||200;
    return t;
}

// Frais pass-through (facturÃ©s au client, ajoutÃ©s au TTC)
// These are revenue items that shouldn't reduce margin
function getPassThrough() {
    if(mode) {
        const m = (parseFloat(document.getElementById('coutMandat').value)||0) * (parseFloat(document.getElementById('qteMandat').value)||0);
        const r = (parseFloat(document.getElementById('coutMairie').value)||0) * (parseFloat(document.getElementById('qteMairie').value)||0);
        const p = document.getElementById('checkPrevisite').checked ? (parseFloat(document.getElementById('coutPrevisite').value)||0) : 0;
        return m + r + p;
    } else {
        // Client mode: calculate from data
        const sc = document.getElementById('scenario').value;
        const ct = document.getElementById('categorie').value;
        const ad = (D.MPR[sc]&&D.MPR[sc][ct])?D.MPR[sc][ct]:0;
        const d = D.COUT_DETAIL[sc];
        let pt = (d ? (d.mairie||0) : 0);
        if(ad > 0) pt += Math.round(ad * 0.12);
        if(document.getElementById('checkPrevisite').checked) pt += parseFloat(document.getElementById('coutPrevisite').value)||200;
        return pt;
    }
}

function calc(){
  try {
    _calcRunning = true;
    
    // Always recalculate CEE detail first (updates lastCEEDetailPrime)
    calcCEEDetail();
    
    const sc=document.getElementById('scenario').value;
    const ct=document.getElementById('categorie').value;
    const zn=document.getElementById('zone').value;
    const et=document.getElementById('etas').value;
    const sf=surfaceToCategory(document.getElementById('surface').value);
    const cs=M[sc];
    
    // Check if CEE override is active
    
    let tt;
    if(mode){
        const lockTTC=document.getElementById('lockTTC').checked;
        if(lockTTC){
            tt = D.TTC[sc] || 0;
            document.getElementById('totalTTCInput').value=tt;
            const tte = document.getElementById('totalTTCEditable');
            if(tte) tte.textContent = fmt(tt);
        }else{
            tt=parseFloat(document.getElementById('totalTTCInput').value)||0;
        }
    }else{
        tt=D.TTC[sc]||0;
    }
    
    const ad=(D.MPR[sc]&&D.MPR[sc][ct])?D.MPR[sc][ct]:0;
    
    let ch;
    if(mode){
        const lockCoutHT=document.getElementById('lockCoutHT').checked;
        
        if(lockCoutHT){
            if(D.COUT_DETAIL[sc]){
                const detail=D.COUT_DETAIL[sc];
                document.getElementById('coutPACMateriel').value = detail.pac_materiel;
                document.getElementById('qtePACMateriel').value = 1;
                document.getElementById('totalPACMateriel').textContent = fmt(detail.pac_materiel);
                document.getElementById('coutPACPose').value = detail.pac_pose;
                document.getElementById('qtePACPose').value = 1;
                document.getElementById('totalPACPose').textContent = fmt(detail.pac_pose);
                document.getElementById('coutBallonMateriel').value = detail.ballon_materiel;
                document.getElementById('qteBallonMateriel').value = detail.ballon_materiel > 0 ? 1 : 0;
                document.getElementById('totalBallonMateriel').textContent = fmt(detail.ballon_materiel);
                document.getElementById('coutBallonPose').value = detail.ballon_pose;
                document.getElementById('qteBallonPose').value = detail.ballon_pose > 0 ? 1 : 0;
                document.getElementById('totalBallonPose').textContent = fmt(detail.ballon_pose);
                document.getElementById('coutAccessoires').value = detail.accessoires;
                document.getElementById('qteAccessoires').value = 1;
                document.getElementById('totalAccessoires').textContent = fmt(detail.accessoires);
                document.getElementById('coutAdmin').value = detail.admin;
                document.getElementById('qteAdmin').value = 1;
                document.getElementById('totalAdmin').textContent = fmt(detail.admin);
                // Mandat MPR = 12% de l'aide MPR
                const mandatVal = Math.round(ad * 0.12);
                document.getElementById('coutMandat').value = mandatVal;
                document.getElementById('qteMandat').value = ad > 0 ? 1 : 0;
                document.getElementById('totalMandat').textContent = fmt(ad > 0 ? mandatVal : 0);
                // Demande mairie (SSC uniquement)
                const mairieVal = detail.mairie || 0;
                document.getElementById('coutMairie').value = mairieVal > 0 ? mairieVal : 250;
                document.getElementById('qteMairie').value = mairieVal > 0 ? 1 : 0;
                document.getElementById('totalMairie').textContent = fmt(mairieVal);
                // PrÃ©visite
                const prevOn = document.getElementById('checkPrevisite').checked;
                const prevCost = prevOn ? (parseFloat(document.getElementById('coutPrevisite').value) || 200) : 0;
                document.getElementById('totalPrevisite').textContent = prevOn ? fmt(prevCost) : '0 \u20AC';
                ch = detail.pac_materiel + detail.pac_pose + detail.ballon_materiel + detail.ballon_pose + detail.accessoires + detail.admin + (ad > 0 ? mandatVal : 0) + mairieVal + prevCost;
            }else{
                ch = D.COUT[sc] || 0;
            }
        }else{
            const totalPACMateriel = (parseFloat(document.getElementById('coutPACMateriel').value) || 0) * (parseFloat(document.getElementById('qtePACMateriel').value) || 0);
            const totalPACPose = (parseFloat(document.getElementById('coutPACPose').value) || 0) * (parseFloat(document.getElementById('qtePACPose').value) || 0);
            const totalBallonMateriel = (parseFloat(document.getElementById('coutBallonMateriel').value) || 0) * (parseFloat(document.getElementById('qteBallonMateriel').value) || 0);
            const totalBallonPose = (parseFloat(document.getElementById('coutBallonPose').value) || 0) * (parseFloat(document.getElementById('qteBallonPose').value) || 0);
            const totalAccessoires = (parseFloat(document.getElementById('coutAccessoires').value) || 0) * (parseFloat(document.getElementById('qteAccessoires').value) || 0);
            const totalAdmin = (parseFloat(document.getElementById('coutAdmin').value) || 0) * (parseFloat(document.getElementById('qteAdmin').value) || 0);
            ch = totalPACMateriel + totalPACPose + totalBallonMateriel + totalBallonPose + totalAccessoires + totalAdmin;
            ch += (parseFloat(document.getElementById('coutMandat').value)||0) * (parseFloat(document.getElementById('qteMandat').value)||0);
            ch += (parseFloat(document.getElementById('coutMairie').value)||0) * (parseFloat(document.getElementById('qteMairie').value)||0);
            if(document.getElementById('checkPrevisite').checked) ch += parseFloat(document.getElementById('coutPrevisite').value)||0;
        }
        document.getElementById('coutTotalHTDisplay').textContent = fmt(ch);
    }else{
        ch=getCoutFromDetail(sc, ad);
    }
    
    // Pass-through costs (mandat, mairie, prÃ©visite) are revenue items
    // They're displayed in costs but excluded from margin calculation
    const chForMarge = ch - getPassThrough();
    
    let ce;
    let ceForMarge, taForMarge;
    
    // Always use detailed CEE calculation (with Coup de pouce)
    ce = lastCEEDetailPrime;
    ceForMarge = ce;
    taForMarge = ad + ceForMarge;
    
    if(mode){
        // Sync prixCumac with mÃ©nage CEE category
        const menageVal = document.getElementById('menageCEE').value;
        const pxAuto = (menageVal === 'tm') ? 12.5 : 7.5;
        document.getElementById('prixCumac').value = pxAuto;
        document.getElementById('kwhCumac').value=Math.round(lastCEEDetailKwhc).toLocaleString('fr-FR');
    }
    
    const ceDisplay = ce;
    const ceeSourceText = getCEEFiches(sc).map(f => 'BAR-TH-' + f).join(' + ') + ' dÃ©taillÃ©';
    
    const ta=ad+ceDisplay;
    const rb=tt-ta;
    
    // Compute pro-level RAC (prix cumac trÃ¨s modestes) for auto-geste detection
    const proCEE = (lastCEEDetailKwhc / 1000) * 12.5;
    const proRB = tt - (ad + proCEE);
    
    // En vue client, si aides > TTC, ajuster l'affichage pour cohÃ©rence (TTC = aides + 1)
    const displayTTC = (!mode && rb < 0) ? (ta + 1) : tt;
    
    document.getElementById('totalTTC').textContent=fmt(displayTTC);
    const tteSync = document.getElementById('totalTTCEditable');
    if(tteSync && document.activeElement !== tteSync) tteSync.textContent = fmt(tt);
    document.getElementById('aidesMPR').textContent=fmt(ad);
    document.getElementById('aidesCEE').textContent=fmt(ceDisplay);
    document.getElementById('totalAides').textContent=fmt(ta);
    document.getElementById('ceeSourceLabel').textContent=ceeSourceText;
    
    if(mode) document.getElementById('displayCoutHT').textContent=fmt(ch);
    
    const st=document.getElementById('scenario').options[document.getElementById('scenario').selectedIndex].text;
    const ct2=document.getElementById('categorie').options[document.getElementById('categorie').selectedIndex].text;
    const zn2=document.getElementById('zone').options[document.getElementById('zone').selectedIndex].text;
    const et2=document.getElementById('etas').options[document.getElementById('etas').selectedIndex].text;
    const sf2=getSurfaceLabel();
    const colorClass=ct==='BLEU'?'color-bleu':(ct==='JAUNE'?'color-jaune':(ct==='VIOLET'?'color-violet':'color-rose'));
    const borderColor=ct==='BLEU'?'#0071e3':(ct==='JAUNE'?'#fbbf24':(ct==='VIOLET'?'#8b5cf6':'#ec4899'));
    
    let summaryHTML;
    if (sc === 'SSC') {
        summaryHTML = `<strong class="${colorClass}">${st}</strong><span class="separator">\u2022</span>${ct2}<span class="separator">\u2022</span>Zone ${zn2}`;
    } else {
        summaryHTML = `<strong class="${colorClass}">${st}</strong><span class="separator">\u2022</span>${ct2}<span class="separator">\u2022</span>Zone ${zn2}<span class="separator">\u2022</span>${sf2}<span class="separator">\u2022</span>${et2}`;
    }
    document.getElementById('scenarioSummary').innerHTML = summaryHTML;
    document.getElementById('scenarioSummary').style.borderLeftColor=borderColor;
    
    calcRAC(rb,chForMarge,ta,taForMarge,tt,proRB);
    if(typeof dbg==='function') dbg('calc: sc='+sc+' ct='+ct+' ad='+ad+' ce='+ce+' ch='+ch+' chFM='+chForMarge+' tt='+tt+' rb='+rb+' taFM='+taForMarge+' proRB='+Math.round(proRB));
    
    _calcRunning = false;
    const errDiv = document.getElementById('calcErrorDebug');
    if (errDiv) { errDiv.textContent = ''; errDiv.style.display = 'none'; }
  } catch(e) {
    _calcRunning = false;
    console.error('calc() error:', e);
    if(typeof dbg==='function') dbg('\u274C calc: '+e.message+' at '+(e.stack||'').split('\n')[1]);
    const errDiv = document.getElementById('calcErrorDebug');
    if (errDiv) { errDiv.textContent = 'âš \u0161\u00A0 calc(): ' + e.message; errDiv.style.display = 'block'; errDiv.style.color = '#dc2626'; errDiv.style.background = '#fef2f2'; }
  }
}

function calcRAC(rb,ch,ta,taForMarge,tt,proRB){
    let po=parseFloat(document.getElementById('racPourcent').value)||0;
    let mo=parseFloat(document.getElementById('racOffert').value)||0;
    
    // Vue client : auto geste co quand le RAC pro est nÃ©gatif
    if(!mode && proRB !== undefined && proRB < 0 && rb > 1){
        if(!autoGesteApplied){
            savedRacPourcent = document.getElementById('racPourcent').value;
            savedRacOffert = document.getElementById('racOffert').value;
        }
        mo = rb - 1;
        po = rb > 0 ? Math.round((mo/rb)*100) : 0;
        document.getElementById('racOffert').value = Math.round(mo);
        document.getElementById('racPourcent').value = po;
        autoGesteApplied = true;
    } else if(mode && autoGesteApplied){
        document.getElementById('racPourcent').value = savedRacPourcent;
        document.getElementById('racOffert').value = savedRacOffert;
        po = parseFloat(savedRacPourcent) || 0;
        mo = parseFloat(savedRacOffert) || 0;
        autoGesteApplied = false;
    } else if(!mode && proRB !== undefined && proRB >= 0 && autoGesteApplied){
        document.getElementById('racPourcent').value = savedRacPourcent;
        document.getElementById('racOffert').value = savedRacOffert;
        po = parseFloat(savedRacPourcent) || 0;
        mo = parseFloat(savedRacOffert) || 0;
        autoGesteApplied = false;
    }
    
    const rc=rb-mo;
    // RAC nÃ©gatif \u2192 afficher 1\u20AC en vue client, vrai montant en vue fournisseur
    document.getElementById('resteCharge').textContent = (rc < 0 && !mode) ? '1 \u20AC' : fmt(rc);
    
    const rbForMarge = tt - taForMarge;
    const moForMarge = autoGesteApplied ? (parseFloat(savedRacOffert)||0) : mo;
    const rcForMarge = rbForMarge - moForMarge;
    const vhForMarge = Math.max(0,rcForMarge)/1.055;
    const mgForMarge = vhForMarge - ch + taForMarge;
    
    if(mode){
        document.getElementById('margeFinal').textContent=fmt(mgForMarge);
    }
    
    const currentScenario = document.getElementById('scenario').value;
    const seuilOK = (currentScenario === 'PAC + SSC' || currentScenario === 'SSC') ? 6000 : 4000;
    
    // Calculate max % offerable (fournisseur)
    if(mode){
        const maxPctEl = document.getElementById('maxPctValue');
        const maxPctBox = document.getElementById('maxPctInfo');
        if(maxPctEl){
            if(rb <= 0){
                // Aides cover entire TTC - no RAC to discount
                if(mgForMarge >= seuilOK){
                    maxPctEl.textContent = 'Aides > TTC \u2014 pas de RAC \u00e0 r\u00e9duire';
                    maxPctBox.style.background = 'rgba(5,150,105,0.12)';
                    maxPctBox.style.borderColor = 'rgba(5,150,105,0.25)';
                    maxPctBox.style.color = '#34d399';
                } else {
                    maxPctEl.textContent = '0% \u2014 marge insuffisante';
                    maxPctBox.style.background = 'rgba(220,38,38,0.12)';
                    maxPctBox.style.borderColor = 'rgba(220,38,38,0.25)';
                    maxPctBox.style.color = '#f87171';
                }
            } else {
                // Normal case: solve for max offert
                const maxOffert = rbForMarge - (seuilOK + ch - taForMarge) * 1.055;
                const maxPct = Math.max(0, Math.floor((maxOffert / rb) * 100));
                if(typeof dbg==='function') dbg('maxOff: maxOff='+Math.round(maxOffert)+' pct='+maxPct);
                if(maxOffert > 0){
                    maxPctEl.textContent = maxPct + '% (' + fmt(Math.floor(maxOffert)) + ')';
                    maxPctBox.style.background = 'rgba(5,150,105,0.12)';
                    maxPctBox.style.borderColor = 'rgba(5,150,105,0.25)';
                    maxPctBox.style.color = '#34d399';
                } else {
                    maxPctEl.textContent = '0% \u2014 marge insuffisante';
                    maxPctBox.style.background = 'rgba(220,38,38,0.12)';
                    maxPctBox.style.borderColor = 'rgba(220,38,38,0.25)';
                    maxPctBox.style.color = '#f87171';
                }
            }
        }
    }
    
    const bd=document.getElementById('statusBadge');
    const icon=document.getElementById('statusIcon');
    const txt=document.getElementById('statusText');
    if(typeof dbg==='function') dbg('RAC: mg='+Math.round(mgForMarge)+' seuil='+seuilOK+' rbFM='+Math.round(rbForMarge)+' ch='+Math.round(ch));
    if(mgForMarge>=seuilOK){
        bd.className='status-badge ok';
        bd.onclick=shareDevis;
        icon.textContent='\u2705';
        txt.textContent='Voulez-vous un devis ?';
    }else{
        bd.className='status-badge danger';
        bd.onclick=null;
        icon.textContent='\u274C';
        txt.textContent='Dossier refusÃ©';
    }
}

function shareDevis(){
    const nom=document.getElementById('nom').value.trim()||'Client';
    const prenom=document.getElementById('prenom').value.trim()||'';
    const scenario=document.getElementById('scenario').options[document.getElementById('scenario').selectedIndex].text;
    const ttc=document.getElementById('totalTTC').textContent;
    const totalAides=document.getElementById('totalAides').textContent;
    const rac=document.getElementById('resteCharge').textContent;
    
    const text = `\uD83C\uDFE0 Estimation PAC \u2014 ${prenom} ${nom}\n\n\uD83D\uDCCB ${scenario}\n\uD83D\uDCB0 Installation TTC : ${ttc}\n\uD83C\uDF81 Total aides : ${totalAides}\n\uD83C\uDFE0 Reste Ã  charge : ${rac}\n\nSimulation rÃ©alisÃ©e par Les Artisans Verts`;
    
    if(navigator.share){
        navigator.share({
            title: 'Devis PAC \u2014 ' + (prenom + ' ' + nom).trim(),
            text: text
        }).catch(()=>{});
    }else{
        // Fallback: copy to clipboard
        navigator.clipboard.writeText(text).then(()=>{
            const bd=document.getElementById('statusBadge');
            const oldTxt=document.getElementById('statusText').textContent;
            document.getElementById('statusText').textContent='\u2713 CopiÃ© !';
            setTimeout(()=>{ document.getElementById('statusText').textContent=oldTxt; }, 2000);
        }).catch(()=>{
            window.open('https://api.whatsapp.com/send?text='+encodeURIComponent(text),'_blank');
        });
    }
}

function updatePct(){
    const sc=document.getElementById('scenario').value;
    const ct=document.getElementById('categorie').value;
    const zn=document.getElementById('zone').value;
    const et=document.getElementById('etas').value;
    const sf=surfaceToCategory(document.getElementById('surface').value);
    const cs=M[sc];
    
    let tt;
    if(mode){
        const lockTTC=document.getElementById('lockTTC').checked;
        tt = lockTTC ? (D.TTC[sc] || 0) : (parseFloat(document.getElementById('totalTTCInput').value)||0);
    }else{
        tt=D.TTC[sc]||0;
    }
    
    const ad=(D.MPR[sc]&&D.MPR[sc][ct])?D.MPR[sc][ct]:0;
    
    let ch;
    if(mode){
        const lockCoutHT=document.getElementById('lockCoutHT').checked;
        if(lockCoutHT){
            if(D.COUT_DETAIL[sc]){
                const detail=D.COUT_DETAIL[sc];
                ch = detail.pac_materiel + detail.pac_pose + detail.ballon_materiel + detail.ballon_pose + detail.accessoires + detail.admin + (ad > 0 ? Math.round(ad * 0.12) : 0) + (detail.mairie || 0) + (document.getElementById("checkPrevisite").checked ? (parseFloat(document.getElementById("coutPrevisite").value) || 200) : 0);
            }else{ ch = D.COUT[sc] || 0; }
        }else{
            const totalPACMateriel = (parseFloat(document.getElementById('coutPACMateriel').value) || 0) * (parseFloat(document.getElementById('qtePACMateriel').value) || 0);
            const totalPACPose = (parseFloat(document.getElementById('coutPACPose').value) || 0) * (parseFloat(document.getElementById('qtePACPose').value) || 0);
            const totalBallonMateriel = (parseFloat(document.getElementById('coutBallonMateriel').value) || 0) * (parseFloat(document.getElementById('qteBallonMateriel').value) || 0);
            const totalBallonPose = (parseFloat(document.getElementById('coutBallonPose').value) || 0) * (parseFloat(document.getElementById('qteBallonPose').value) || 0);
            const totalAccessoires = (parseFloat(document.getElementById('coutAccessoires').value) || 0) * (parseFloat(document.getElementById('qteAccessoires').value) || 0);
            const totalAdmin = (parseFloat(document.getElementById('coutAdmin').value) || 0) * (parseFloat(document.getElementById('qteAdmin').value) || 0);
            ch = totalPACMateriel + totalPACPose + totalBallonMateriel + totalBallonPose + totalAccessoires + totalAdmin;
            ch += (parseFloat(document.getElementById('coutMandat').value)||0) * (parseFloat(document.getElementById('qteMandat').value)||0);
            ch += (parseFloat(document.getElementById('coutMairie').value)||0) * (parseFloat(document.getElementById('qteMairie').value)||0);
            if(document.getElementById('checkPrevisite').checked) ch += parseFloat(document.getElementById('coutPrevisite').value)||0;
        }
    }else{ ch=getCoutFromDetail(sc, ad); }
    
    let ce = lastCEEDetailPrime;
    let ceForMarge = ce;
    let taForMarge = ad + ceForMarge;
    
    const chForMarge = ch - getPassThrough();
    const ta=ad+ce;
    const rb=tt-ta;
    
    let po=parseFloat(document.getElementById('racPourcent').value)||0;
    if(po>100)po=100; if(po<0)po=0;
    document.getElementById('racPourcent').value=Math.round(po);
    const mo=Math.round(rb*(po/100));
    document.getElementById('racOffert').value=mo;
    
    calcRAC(rb,chForMarge,ta,taForMarge,tt);
}

function updateAmt(){
    const sc=document.getElementById('scenario').value;
    const ct=document.getElementById('categorie').value;
    const zn=document.getElementById('zone').value;
    const et=document.getElementById('etas').value;
    const sf=surfaceToCategory(document.getElementById('surface').value);
    const cs=M[sc];
    
    let tt;
    if(mode){
        const lockTTC=document.getElementById('lockTTC').checked;
        tt = lockTTC ? (D.TTC[sc] || 0) : (parseFloat(document.getElementById('totalTTCInput').value)||0);
    }else{ tt=D.TTC[sc]||0; }
    
    const ad=(D.MPR[sc]&&D.MPR[sc][ct])?D.MPR[sc][ct]:0;
    
    let ch;
    if(mode){
        const lockCoutHT=document.getElementById('lockCoutHT').checked;
        if(lockCoutHT){
            if(D.COUT_DETAIL[sc]){
                const detail=D.COUT_DETAIL[sc];
                ch = detail.pac_materiel + detail.pac_pose + detail.ballon_materiel + detail.ballon_pose + detail.accessoires + detail.admin;
            }else{ ch = D.COUT[sc] || 0; }
        }else{
            const totalPACMateriel = (parseFloat(document.getElementById('coutPACMateriel').value) || 0) * (parseFloat(document.getElementById('qtePACMateriel').value) || 0);
            const totalPACPose = (parseFloat(document.getElementById('coutPACPose').value) || 0) * (parseFloat(document.getElementById('qtePACPose').value) || 0);
            const totalBallonMateriel = (parseFloat(document.getElementById('coutBallonMateriel').value) || 0) * (parseFloat(document.getElementById('qteBallonMateriel').value) || 0);
            const totalBallonPose = (parseFloat(document.getElementById('coutBallonPose').value) || 0) * (parseFloat(document.getElementById('qteBallonPose').value) || 0);
            const totalAccessoires = (parseFloat(document.getElementById('coutAccessoires').value) || 0) * (parseFloat(document.getElementById('qteAccessoires').value) || 0);
            const totalAdmin = (parseFloat(document.getElementById('coutAdmin').value) || 0) * (parseFloat(document.getElementById('qteAdmin').value) || 0);
            ch = totalPACMateriel + totalPACPose + totalBallonMateriel + totalBallonPose + totalAccessoires + totalAdmin;
            ch += (parseFloat(document.getElementById('coutMandat').value)||0) * (parseFloat(document.getElementById('qteMandat').value)||0);
            ch += (parseFloat(document.getElementById('coutMairie').value)||0) * (parseFloat(document.getElementById('qteMairie').value)||0);
            if(document.getElementById('checkPrevisite').checked) ch += parseFloat(document.getElementById('coutPrevisite').value)||0;
        }
    }else{ ch=getCoutFromDetail(sc, ad); }
    
    let ce = lastCEEDetailPrime;
    let ceForMarge = ce;
    let taForMarge = ad + ceForMarge;
    
    const chForMarge = ch - getPassThrough();
    const ta=ad+ce;
    const rb=tt-ta;
    
    let mo=parseFloat(document.getElementById('racOffert').value)||0;
    if(mo>rb)mo=rb; if(mo<0)mo=0;
    document.getElementById('racOffert').value=Math.round(mo);
    let po=rb>0?Math.round((mo/rb)*100):0;
    if(po>100)po=100; if(po<0)po=0;
    document.getElementById('racPourcent').value=po;
    
    calcRAC(rb,chForMarge,ta,taForMarge,tt);
}

function reset(){
    document.getElementById('scenario').value='PAC';
    document.getElementById('categorie').value='BLEU';
    document.getElementById('zone').value='H1';
    document.getElementById('etas').value='140-170';
    document.getElementById('surface').value='S>=90';
    document.getElementById('typeLogement').value='maison';
    document.getElementById('rfr').value='';
    document.getElementById('nbPersonnes').value='4';
    document.getElementById('mprResultBloc').style.display='none';
    updateSurfaceOptions();
    document.getElementById('racPourcent').value=0;
    document.getElementById('racOffert').value=0;
    if(mode){
        document.getElementById('prixCumac').value=12.5;
    }
    calc();
}

function checkExport(){
    const nom=document.getElementById('nom').value.trim();
    const prenom=document.getElementById('prenom').value.trim();
    const btn=document.getElementById('exportBtn');
    const wBtn=document.getElementById('whatsappBtn');
    const hint=document.getElementById('exportHint');
    if(nom&&prenom){
        btn.disabled=false; btn.style.cursor='pointer'; btn.style.opacity='1';
        wBtn.disabled=false; wBtn.style.cursor='pointer'; wBtn.style.opacity='1';
        if(hint) hint.style.display='none';
    }else{
        btn.disabled=true; btn.style.cursor='not-allowed'; btn.style.opacity='0.5';
        wBtn.disabled=true; wBtn.style.cursor='not-allowed'; wBtn.style.opacity='0.5';
        if(hint) hint.style.display='block';
    }
}

function sendWhatsApp(){
    if(typeof logExport==='function') logExport('WhatsApp');
    const nom=document.getElementById('nom').value.trim() || 'Client';
    const prenom=document.getElementById('prenom').value.trim() || '';
    const scenario=document.getElementById('scenario').options[document.getElementById('scenario').selectedIndex].text;
    const categorie=document.getElementById('categorie').options[document.getElementById('categorie').selectedIndex].text;
    const zone=document.getElementById('zone').options[document.getElementById('zone').selectedIndex].text;
    const etas=document.getElementById('etas').options[document.getElementById('etas').selectedIndex].text;
    const surface=getSurfaceLabel();
    const ttc=document.getElementById('totalTTC').textContent;
    const aidesMPR=document.getElementById('aidesMPR').textContent;
    const aidesCEE=document.getElementById('aidesCEE').textContent;
    const totalAides=document.getElementById('totalAides').textContent;
    const rac=document.getElementById('resteCharge').textContent;
    const message=`\uD83C\uDFE0 *Demande de devis - Les Artisans Verts*%0A%0A\uD83D\uDC64 *Client :* ${prenom} ${nom}%0A%0A\uD83D\uDCCB *Configuration :*%0A\u2022 ScÃ©nario : ${scenario}%0A\u2022 ${categorie}%0A\u2022 ${zone}%0A\u2022 ${surface}%0A\u2022 ${etas}%0A%0A\uD83D\uDCB0 *Montants :*%0A\u2022 Total TTC : ${ttc}%0A\u2022 Aides MPR : ${aidesMPR}%0A\u2022 Aides CEE : ${aidesCEE}%0A\u2022 Total aides : ${totalAides}%0A\u2022 Reste Ã  charge : ${rac}%0A%0AJe souhaite obtenir un devis dÃ©taillÃ©.`;
    window.open(`https://api.whatsapp.com/send?text=${message}`, '_blank');
}

function exportPDF(){
    if(typeof logExport==='function') logExport('PDF');
    const nom=document.getElementById('nom').value.trim() || 'Client';
    const prenom=document.getElementById('prenom').value.trim() || '';
    const fullName = (prenom + ' ' + nom).trim();

    // En-tÃªte
    document.getElementById('printTitle').textContent = 'Dossier \u2014 ' + fullName;
    document.getElementById('printDate').textContent = new Date().toLocaleDateString('fr-FR', {weekday:'long', year:'numeric', month:'long', day:'numeric'});
    document.getElementById('printCommercial').textContent = currentUser ? ('Commercial : ' + currentUser.name) : '';

    // Client info
    document.getElementById('printNom').textContent = fullName;
    document.getElementById('printDept').textContent = document.getElementById('departement').value || '\u2014';
    const zoneEl = document.getElementById('zone');
    document.getElementById('printZone').textContent = zoneEl ? zoneEl.value : '\u2014';
    const foyerEl = document.getElementById('foyer');
    document.getElementById('printFoyer').textContent = foyerEl ? foyerEl.options[foyerEl.selectedIndex].text : '\u2014';
    const rfr = document.getElementById('rfr').value;
    document.getElementById('printRFR').textContent = rfr ? parseInt(rfr).toLocaleString('fr-FR') + ' \u20AC' : '\u2014';

    // Profil MPR
    const profilLabel = document.getElementById('mprProfilLabel');
    const profilDesc = document.getElementById('mprProfilDesc');
    const profilCard = document.getElementById('printProfilCard');
    const cat = document.getElementById('categorie').value;
    const profilColors = { BLEU:'#2563eb', JAUNE:'#d97706', VIOLET:'#7c3aed', ROSE:'#db2777' };
    const profilIcons = { BLEU:'\uD83D\uDD35', JAUNE:'\uD83D\uDFE1', VIOLET:'\uD83D\uDFE3', ROSE:'\uD83D\uDD34' };
    profilCard.style.background = profilColors[cat] || '#64748b';
    document.getElementById('printProfilIcon').textContent = profilIcons[cat] || '\u26AA';
    document.getElementById('printProfilLabel').textContent = profilLabel ? profilLabel.textContent : cat;
    document.getElementById('printProfilDesc').textContent = profilDesc ? profilDesc.textContent : '';
    const seuilEl = document.getElementById('mprInfoSeuil');
    document.getElementById('printProfilSeuil').textContent = seuilEl ? ('Seuil : ' + seuilEl.textContent) : '';

    // Configuration technique
    const sc = document.getElementById('scenario');
    document.getElementById('printScenario').textContent = sc.options[sc.selectedIndex].text;
    const ceeSurf = document.getElementById('ceeSurface');
    document.getElementById('printSurface').textContent = (ceeSurf ? ceeSurf.value : '95') + ' mÂ²';
    const etas = document.getElementById('etas');
    document.getElementById('printETAS').textContent = etas ? etas.options[etas.selectedIndex].text : '\u2014';
    const baremeReco = document.getElementById('baremeReco');
    document.getElementById('printPACReco').textContent = baremeReco ? baremeReco.textContent : '\u2014';
    const isoState = document.getElementById('isoStateName');
    document.getElementById('printIsolation').textContent = isoState ? isoState.textContent : '\u2014';
    document.getElementById('printAnnee').textContent = document.getElementById('dimAnnee').value || '\u2014';

    // Montants
    document.getElementById('printTTC').textContent = document.getElementById('totalTTC').textContent;
    document.getElementById('printMPR').textContent = document.getElementById('aidesMPR').textContent;
    document.getElementById('printCEE').textContent = document.getElementById('aidesCEE').textContent;
    document.getElementById('printTotalAides').textContent = document.getElementById('totalAides').textContent;

    // DÃ©tail CEE
    const ceeFiches = document.getElementById('ceeFichesLabel');
    const ceeDetailEl = document.getElementById('ceeOutDetail');
    const ceePrixEl = document.getElementById('ceeOutPrix');
    let ceeDetail = '';
    if(ceeFiches) ceeDetail += 'Fiches : ' + ceeFiches.textContent;
    if(ceeDetailEl && ceeDetailEl.textContent !== '\u2014') ceeDetail += ' Â· ' + ceeDetailEl.textContent;
    if(ceePrixEl && ceePrixEl.textContent !== '\u2014') ceeDetail += ' Â· ' + ceePrixEl.textContent;
    document.getElementById('printCEEDetail').textContent = ceeDetail || '\u2014';

    // RAC
    document.getElementById('printRAC').textContent = document.getElementById('resteCharge').textContent;
    const pct = document.getElementById('racPourcent').value;
    const offert = document.getElementById('racOffert').value;
    if(parseInt(pct) > 0 || parseInt(offert) > 0){
        document.getElementById('printRACDetail').textContent = 'Prise en charge fournisseur : ' + pct + '% soit ' + offert + ' \u20AC';
    } else {
        document.getElementById('printRACDetail').textContent = '';
    }

    // Statut
    const badge = document.getElementById('statusBadge');
    const printStatus = document.getElementById('printStatus');
    printStatus.textContent = document.getElementById('statusText').textContent;
    if(badge.classList.contains('ok')){
        printStatus.style.background = '#dcfce7';
        printStatus.style.color = '#166534';
        printStatus.style.border = '2px solid #86efac';
    } else {
        printStatus.style.background = '#fef2f2';
        printStatus.style.color = '#991b1b';
        printStatus.style.border = '2px solid #fca5a5';
    }

    window.print();
}

// ============================================
// AUTHENTIFICATION PAR COMMERCIAL (API)
// ============================================
const API_URL = 'https://script.google.com/macros/s/AKfycbwP1Nu60KfLu6iKNk7SMfkJoaq5_UbzcEtwnlBm5r1XbDYz8T16zayfPWynm0Zd_4Th/exec';
const FALLBACK_USERS = {
    'ishay':   { pass:'lav',       name:'Ishay',       role:'admin' },
    'admin':   { pass:'gamberge',  name:'Admin',       role:'admin' },
    'mendy':   { pass:'mendy5786', name:'Mendy',       role:'commercial' },
    'david':   { pass:'david26',   name:'David',       role:'commercial' },
    'sarah':   { pass:'sarah26',   name:'Sarah',       role:'commercial' },
    'marc':    { pass:'marc26',    name:'Marc',        role:'commercial' },
    'julie':   { pass:'julie26',   name:'Julie',       role:'commercial' },
    'thomas':  { pass:'thomas26',  name:'Thomas',      role:'commercial' },
    'telepro': { pass:'telepro26', name:'TÃ©lÃ©prospecteur', role:'telepro' },
};
let currentUser = null;
let useAPI = false;

function apiCall(params, callback, errorCallback) {
    if (!API_URL) { if(errorCallback) errorCallback('Pas de serveur'); return; }
    const qs = Object.entries(params).map(([k,v])=>k+'='+encodeURIComponent(v)).join('&');
    fetch(API_URL + '?' + qs, {redirect:'follow'})
        .then(r => r.text())
        .then(txt => {
            let d;
            try { d = JSON.parse(txt); } catch(e) {
                const m = txt.match(/\{[\s\S]*\}/);
                if(m) try { d = JSON.parse(m[0]); } catch(e2){}
            }
            if(d) callback(d);
            else if(errorCallback) errorCallback('RÃ©ponse invalide');
        })
        .catch(e => { if(errorCallback) errorCallback(e.message); });
}

function doLogin(){
    const u = document.getElementById('loginUser').value.trim().toLowerCase();
    const p = document.getElementById('loginPass').value;
    const errEl = document.getElementById('loginError');
    errEl.style.display = 'none';
    if(!u){ errEl.textContent='Veuillez saisir un identifiant'; errEl.style.display='block'; return; }

    if(API_URL) {
        // API mode
        errEl.textContent = 'Connexion...'; errEl.style.display='block'; errEl.style.color='#6b7280';
        apiCall({action:'login', user:u, pass:p}, function(d){
            errEl.style.color = '#dc2626';
            if(d.success){
                useAPI = true;
                const usr = d.user || {};
                currentUser = {
                    id: usr.username || u,
                    name: usr.name || u,
                    role: usr.role || 'commercial'
                };
                try{ localStorage.setItem('pac_user', JSON.stringify(currentUser)); localStorage.setItem('pac_api','1'); }catch(e){}
                showApp();
            } else {
                errEl.textContent = d.error || 'Identifiants incorrects';
                errEl.style.display = 'block';
            }
        }, function(err){
            // Fallback local
            errEl.style.color = '#dc2626';
            doLoginLocal(u, p, errEl);
        });
    } else {
        doLoginLocal(u, p, errEl);
    }
}
function doLoginLocal(u, p, errEl){
    const account = FALLBACK_USERS[u];
    if(!account || account.pass !== p){
        errEl.textContent = 'Identifiant ou mot de passe incorrect';
        errEl.style.display = 'block';
        errEl.style.color = '#dc2626';
        return;
    }
    useAPI = false;
    currentUser = { id:u, name:account.name, role:account.role };
    try{ localStorage.setItem('pac_user', JSON.stringify(currentUser)); localStorage.removeItem('pac_api'); }catch(e){}
    showApp();
    logAction('Connexion (local)', account.name);
}
document.getElementById('loginPass').addEventListener('keydown', e=>{ if(e.key==='Enter') doLogin(); });
document.getElementById('loginUser').addEventListener('keydown', e=>{ if(e.key==='Enter') doLogin(); });

function doLogout(){
    logAction('DÃ©connexion', currentUser ? currentUser.name : '');
    currentUser = null;
    try{ localStorage.removeItem('pac_user'); localStorage.removeItem('pac_api'); }catch(e){}
    location.reload();
}

function goToLogin(){
    currentUser = null;
    try{ localStorage.removeItem('pac_user'); }catch(e){}
    document.getElementById('appScreen').style.display = 'none';
    document.getElementById('loginScreen').style.display = 'flex';
}

function doGuestLogin(){
    currentUser = { id:'guest', name:'Client', role:'guest' };
    try{ localStorage.setItem('pac_user', JSON.stringify(currentUser)); }catch(e){}
    showApp();
}

function switchView(v){
    const mc = document.getElementById('mainContent');
    const togC = document.getElementById('togClient');
    const togT = document.getElementById('togTelepro');
    const togF = document.getElementById('togFournisseur');
    // Reset all
    mc.classList.remove('fournisseur-mode', 'telepro-mode');
    togC.classList.remove('active');
    if(togT) togT.classList.remove('active');
    togF.classList.remove('active');
    
    if(v === 'fournisseur'){
        mode = 1;
        mc.classList.add('fournisseur-mode');
        togF.classList.add('active');
        logAction('Vue fournisseur', '');
    } else if(v === 'telepro'){
        mode = 1;
        mc.classList.add('telepro-mode');
        if(togT) togT.classList.add('active');
        logAction('Vue telepro', '');
    } else {
        mode = 0;
        togC.classList.add('active');
    }
    try{ calc(); }catch(e){}
}

function showApp(){
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('appScreen').style.display = 'block';

    const isGuest = !currentUser || currentUser.role === 'guest';

    if(isGuest){
        // Vue client uniquement
        mode = 0;
        document.getElementById('mainContent').classList.remove('fournisseur-mode');
        document.getElementById('mainContent').classList.remove('telepro-mode');
        document.getElementById('guestBar').style.display = 'flex';
        document.getElementById('userBar').style.display = 'none';
    } else {
        document.getElementById('guestBar').style.display = 'none';
        document.getElementById('userBar').style.display = 'flex';
        document.getElementById('userNameDisplay').textContent = currentUser.name;
        
        const isAdmin = currentUser.role === 'admin';
        const isTelepro = currentUser.role === 'telepro';
        
        // Role label
        if(isAdmin) document.getElementById('userRoleDisplay').textContent = '\uD83D\uDC51 Admin';
        else if(isTelepro) document.getElementById('userRoleDisplay').textContent = '\uD83D\uDCDE TÃ©lÃ©prospecteur';
        else document.getElementById('userRoleDisplay').textContent = '\uD83D\uDCCA Commercial';
        
        // Tab visibility: admin sees all 3, telepro sees Client+Telepro, commercial sees Client+Pro
        const togT = document.getElementById('togTelepro');
        const togF = document.getElementById('togFournisseur');
        if(isAdmin){
            if(togT) togT.style.display = '';
            togF.style.display = '';
        } else if(isTelepro){
            if(togT) togT.style.display = '';
            togF.style.display = 'none';
        } else {
            if(togT) togT.style.display = 'none';
            togF.style.display = '';
        }
        
        // Default view
        if(isTelepro){
            switchView('telepro');
        } else {
            switchView('fournisseur');
        }
        
        // Admin-only buttons
        document.getElementById('btnHistory').style.display = isAdmin ? '' : 'none';
        document.getElementById('btnPwd').style.display = isAdmin ? '' : 'none';
    }

    try { updateSurfaceOptions(); } catch(e){}
    try { calc(); } catch(e){}
    try { buildBaremeTable(); } catch(e){}
    try { calcBareme(); } catch(e){}
    try { syncEtas(); } catch(e){}
    try { calcDim(); } catch(e){}
    try { syncProfilPrecarite(); } catch(e){}
}

function checkAutoLogin(){
    try{
        const stored = localStorage.getItem('pac_user');
        if(stored){
            const data = JSON.parse(stored);
            if(data && data.id){
                if(localStorage.getItem('pac_api')) useAPI = true;
                currentUser = data;
                showApp();
                return true;
            }
        }
    }catch(e){}
    return false;
}

// ============================================
// CHANGEMENT DE MOT DE PASSE
// ============================================
function openPwdModal(){
    document.getElementById('pwdOld').value = '';
    document.getElementById('pwdNew').value = '';
    document.getElementById('pwdConfirm').value = '';
    document.getElementById('pwdError').style.display = 'none';
    document.getElementById('pwdSuccess').style.display = 'none';
    document.getElementById('pwdModal').classList.add('active');
}
function doChangePassword(){
    const oldP = document.getElementById('pwdOld').value;
    const newP = document.getElementById('pwdNew').value;
    const conf = document.getElementById('pwdConfirm').value;
    const errEl = document.getElementById('pwdError');
    const okEl = document.getElementById('pwdSuccess');
    errEl.style.display = 'none';
    okEl.style.display = 'none';

    if(!oldP || !newP){ errEl.textContent='Tous les champs sont requis'; errEl.style.display='block'; return; }
    if(newP.length < 4){ errEl.textContent='Minimum 4 caractÃ¨res'; errEl.style.display='block'; return; }
    if(newP !== conf){ errEl.textContent='Les mots de passe ne correspondent pas'; errEl.style.display='block'; return; }

    if(useAPI && API_URL){
        errEl.textContent = 'Modification...'; errEl.style.display='block'; errEl.style.color='#6b7280';
        apiCall({action:'changePassword', user:currentUser.id, oldPass:oldP, newPass:newP}, function(d){
            errEl.style.color = '#dc2626';
            if(d.success){
                errEl.style.display = 'none';
                okEl.textContent = '\u2705 Mot de passe modifiÃ© !';
                okEl.style.display = 'block';
                setTimeout(()=>{ document.getElementById('pwdModal').classList.remove('active'); }, 1500);
            } else {
                errEl.textContent = d.error || 'Erreur';
                errEl.style.display = 'block';
            }
        }, function(err){
            errEl.textContent = 'Erreur serveur: ' + err;
            errEl.style.display = 'block';
            errEl.style.color = '#dc2626';
        });
    } else {
        // Mode local: update FALLBACK_USERS
        const account = FALLBACK_USERS[currentUser.id];
        if(!account){ errEl.textContent='Compte introuvable'; errEl.style.display='block'; return; }
        if(account.pass !== oldP){ errEl.textContent='Ancien mot de passe incorrect'; errEl.style.display='block'; return; }
        account.pass = newP;
        okEl.textContent = '\u2705 ModifiÃ© (session uniquement en mode local)';
        okEl.style.display = 'block';
        logAction('Changement mot de passe', currentUser.name);
        setTimeout(()=>{ document.getElementById('pwdModal').classList.remove('active'); }, 1500);
    }
}

// ============================================
// JOURNAL DES MODIFICATIONS
// ============================================
function getJournal(){
    try{ return JSON.parse(localStorage.getItem('pac_journal') || '[]'); }catch(e){ return []; }
}
function saveJournal(j){
    try{
        if(j.length > 200) j = j.slice(j.length - 200);
        localStorage.setItem('pac_journal', JSON.stringify(j));
    }catch(e){}
}
function logAction(action, detail){
    const entry = {
        date: new Date().toISOString(),
        user: currentUser ? currentUser.name : '?',
        role: currentUser ? currentUser.role : '?',
        action: action,
        detail: detail || ''
    };
    // Local journal
    const j = getJournal();
    j.push(entry);
    saveJournal(j);
    // API journal (fire and forget)
    if(useAPI && API_URL){
        apiCall({action:'log', user:entry.user, logAction:action, detail:detail||''}, function(){}, function(){});
    }
}
function openHistory(){
    if(useAPI && API_URL){
        // Fetch from server
        const body = document.getElementById('historyBody');
        body.innerHTML = '<div class="hist-empty">Chargement...</div>';
        document.getElementById('historyModal').classList.add('active');
        apiCall({action:'getJournal', limit:'100'}, function(d){
            renderJournal(d.journal || []);
        }, function(err){
            // Fallback to local
            renderJournal(getJournal().reverse().slice(0, 100));
        });
    } else {
        renderJournal(getJournal().reverse().slice(0, 100));
        document.getElementById('historyModal').classList.add('active');
    }
}
function renderJournal(entries){
    const body = document.getElementById('historyBody');
    if(!entries || entries.length === 0){
        body.innerHTML = '<div class="hist-empty">Aucune entrÃ©e dans le journal</div>';
        return;
    }
    let html = '';
    entries.forEach(e => {
        const d = new Date(e.date);
        const dateStr = d.toLocaleDateString('fr-FR') + ' ' + d.toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'});
        html += '<div class="hist-entry">';
        html += '<div class="hist-meta"><span class="hist-user">' + (e.user||'?') + '</span><span class="hist-date">' + dateStr + '</span></div>';
        html += '<div class="hist-action">' + (e.action||'') + '</div>';
        if(e.detail) html += '<div class="hist-detail">' + e.detail + '</div>';
        html += '</div>';
    });
    if(currentUser && currentUser.role === 'admin'){
        html += '<div class="hist-clear"><button onclick="clearJournal()">\uD83D\uDDD1\uFE0F Vider le journal</button></div>';
    }
    body.innerHTML = html;
}
function clearJournal(){
    if(confirm('Vider tout le journal ?')){
        try{ localStorage.setItem('pac_journal','[]'); }catch(e){}
        openHistory();
    }
}

// Log key actions
function logScenarioChange(){
    const sc = document.getElementById('scenario').value;
    logAction('Changement scÃ©nario', sc);
}
function logClientChange(){
    const nom = document.getElementById('nom').value.trim();
    const prenom = document.getElementById('prenom').value.trim();
    if(nom || prenom) logAction('Client modifiÃ©', (prenom + ' ' + nom).trim());
}
function logExport(type){
    const nom = document.getElementById('nom').value.trim() || 'Client';
    logAction('Export ' + type, nom);
}
function logRACChange(){
    const pct = document.getElementById('racPourcent').value;
    const offert = document.getElementById('racOffert').value;
    logAction('RAC modifiÃ©', pct + '% / ' + offert + ' \u20AC');
}


// ============================================
// SCROLL GRADIENT
// ============================================
(function() {
    const gradients = [
        'linear-gradient(90deg, #34d399, #22d3ee, #818cf8)',
        'linear-gradient(90deg, #22d3ee, #818cf8, #c084fc)',
        'linear-gradient(90deg, #818cf8, #c084fc, #f472b6)',
        'linear-gradient(90deg, #c084fc, #f472b6, #fb923c)',
        'linear-gradient(90deg, #f472b6, #fb923c, #fbbf24)',
        'linear-gradient(90deg, #fb923c, #fbbf24, #34d399)',
    ];
    let ticking = false;
    function updateScrollGradient() {
        const scrollTop = window.scrollY || document.documentElement.scrollTop;
        const docHeight = document.documentElement.scrollHeight - window.innerHeight;
        const scrollPercent = docHeight > 0 ? scrollTop / docHeight : 0;
        const idx = Math.min(Math.floor(scrollPercent * gradients.length), gradients.length - 1);
        document.documentElement.style.setProperty('--scroll-gradient', gradients[idx]);
        ticking = false;
    }
    window.addEventListener('scroll', function() {
        if (!ticking) { requestAnimationFrame(updateScrollGradient); ticking = true; }
    }, { passive: true });
    updateScrollGradient();
})();

// ============================================
// DIMENSIONNEMENT PAC
// ============================================

// Tbase par dÃ©partement (Â°C) - valeurs conventionnelles
const DEPT_TBASE = {
    '01':-10,'02':-9,'03':-8,'04':-8,'05':-10,'06':-5,'07':-6,'08':-10,'09':-8,'10':-10,
    '11':-5,'12':-8,'13':-5,'14':-7,'15':-10,'16':-5,'17':-5,'18':-8,'19':-8,'20':-2,
    '2A':-2,'2B':-2,'21':-10,'22':-4,'23':-8,'24':-5,'25':-12,'26':-6,'27':-7,'28':-7,
    '29':-4,'30':-5,'31':-5,'32':-5,'33':-5,'34':-5,'35':-5,'36':-7,'37':-7,'38':-10,
    '39':-10,'40':-5,'41':-7,'42':-8,'43':-10,'44':-5,'45':-7,'46':-5,'47':-5,'48':-10,
    '49':-5,'50':-5,'51':-10,'52':-10,'53':-5,'54':-12,'55':-10,'56':-4,'57':-12,'58':-10,
    '59':-9,'60':-7,'61':-7,'62':-9,'63':-8,'64':-5,'65':-5,'66':-5,'67':-12,'68':-12,
    '69':-8,'70':-12,'71':-10,'72':-7,'73':-12,'74':-12,'75':-7,'76':-7,'77':-7,'78':-7,
    '79':-5,'80':-9,'81':-5,'82':-5,'83':-3,'84':-6,'85':-5,'86':-5,'87':-8,'88':-12,
    '89':-10,'90':-12,'91':-7,'92':-7,'93':-7,'94':-7,'95':-7
};

let currentG = 0.95;

// ============ DIMENSIONNEMENT \u2014 AnnÃ©e \u2192 G auto ============

// Table G par annÃ©e de construction
function getGFromAnnee(annee) {
    if (annee >= 2021) return 0.6;   // RE 2020
    if (annee >= 2013) return 0.7;   // RT 2012
    if (annee >= 2006) return 0.75;  // RT 2005
    if (annee >= 2001) return 0.8;
    if (annee >= 1990) return 0.95;  // RT 2000
    if (annee >= 1983) return 1.1;
    if (annee >= 1975) return 1.3;   // 1Ã¨re rÃ©glementation
    return 1.6;                       // Avant 1975
}

let currentIsolation = 'origine';

function evalIsolation() {
    const checks = document.querySelectorAll('#isoChecklist input[type="checkbox"]:checked');
    const count = checks.length;
    let recentCount = 0;
    checks.forEach(cb => {
        const quand = cb.closest('.iso-check').querySelector('.iso-quand');
        if (quand && quand.value === 'recent') recentCount++;
    });

    // DÃ©termination auto de l'Ã©tat
    if (count === 0) {
        currentIsolation = 'origine';
    } else if (count >= 3 && recentCount >= 2) {
        currentIsolation = 'totale';
    } else {
        currentIsolation = 'partielle';
    }

    // Affichage
    const names = { origine: 'Ã‰tat d\'origine / Non prÃ©cisÃ©', partielle: 'RÃ©novation partielle', totale: 'RÃ©novation totale' };
    const colors = { origine: '#64748b', partielle: '#d97706', totale: '#16a34a' };
    const el = document.getElementById('isoStateName');
    if (el) { el.textContent = names[currentIsolation]; el.style.color = colors[currentIsolation]; }
    calcDim();
}

function selectIsolation(state) { currentIsolation = state; calcDim(); }

function getEffectiveG() {
    const annee = parseInt(document.getElementById('dimAnnee').value) || 2000;
    let g = getGFromAnnee(annee);
    if (currentIsolation === 'partielle') g = Math.max(g - 0.2, 0.5);
    if (currentIsolation === 'totale') g = Math.max(Math.min(g, 0.7), 0.5);
    return g;
}

// ============ BARÃˆME PAC ============
// Pattern: every 10mÂ², alternating single/double recommendations
// +2kW per 20mÂ² step
function getBaremePAC(surface) {
    if (surface <= 40) return [4];
    if (surface <= 50) return [6];
    // From 60mÂ²: pattern repeats every 20mÂ²
    // 60-70 = [6,8], 80 = [8], 90 = [8,10], 100 = [10], etc.
    const base = Math.floor((surface - 1) / 20); // 0-indexed group
    const inGroup = ((surface - 1) % 20) < 10 ? 0 : 1; // first or second half
    const kw = (base) * 2 + 4; // 4, 6, 8, 10, ...
    
    // Simpler approach: use explicit formula
    const step = Math.floor((surface - 1) / 10); // 0=\u226410, ... 3=31-40, 4=41-50, 5=51-60...
    const kwBase = Math.max(4, Math.floor(surface / 10) * 2);
    
    // Even simpler: keep the proven table + extend
    const table = [
        [40, [4]], [50, [6]], [60, [6,8]], [70, [6,8]], [80, [8]], [90, [8,10]],
        [100, [10]], [110, [10,12]], [120, [12]], [130, [12,14]], [140, [14]],
        [150, [14,16]], [160, [16]], [170, [16,18]], [180, [18]], [190, [18,20]],
        [200, [20]], [210, [20,22]], [220, [22]], [230, [22,24]], [240, [24]],
        [250, [24,26]], [260, [26]], [270, [26,28]], [280, [28]], [290, [28,30]],
        [300, [30]], [350, [30,35]], [Infinity, [35]]
    ];
    for (const [max, reco] of table) {
        if (surface <= max) return reco;
    }
    return [35];
}

function calcBareme() {
    const s = parseInt(document.getElementById('baremeSurface').value) || 100;
    const reco = getBaremePAC(s);
    const el = document.getElementById('baremeReco');
    const alt = document.getElementById('baremeAlt');
    const hint = document.getElementById('baremeIsoHint');
    const cursor = document.getElementById('baremeCursor');
    const lowEl = document.getElementById('baremeLow');
    const highEl = document.getElementById('baremeHigh');

    // Determine low and high power
    let lowKW, highKW;
    if (reco.length === 2) {
        lowKW = reco[0];
        highKW = reco[1];
    } else {
        lowKW = reco[0];
        highKW = reco[0] < 35 ? reco[0] + 2 : reco[0];
    }

    lowEl.textContent = lowKW + ' kW';
    highEl.textContent = highKW + ' kW';

    // Score: 0 = well insulated (left/green), 100 = poorly insulated (right/red)
    const annee = parseInt(document.getElementById('dimAnnee').value) || 2000;
    
    // Count checked isolation items
    const checks = document.querySelectorAll('#isoChecklist input[type="checkbox"]:checked');
    const totalChecks = checks.length; // 0 to 5
    let recentCount = 0;
    checks.forEach(cb => {
        const quand = cb.closest('.iso-check').querySelector('.iso-quand');
        if (quand && quand.value === 'recent') recentCount++;
    });

    // Base score from annÃ©e
    let score;
    if (annee < 1975) score = 90;
    else if (annee < 1990) score = 75;
    else if (annee < 2005) score = 55;
    else if (annee < 2012) score = 35;
    else score = 20;

    // Each checked item reduces score significantly
    // 5 items checked = max reduction
    const reductionPerItem = 12; // each item: -12
    const recentBonus = 3; // recent items: extra -3
    score -= totalChecks * reductionPerItem;
    score -= recentCount * recentBonus;

    // All 5 checked + all recent \u2192 score should be ~0-5
    // 5*12 + 5*3 = 75, from base 90 \u2192 15, from base 55 \u2192 -20 \u2192 clamped to 5

    // Clamp 3-97%
    score = Math.max(3, Math.min(97, score));

    // Position cursor
    cursor.style.left = `calc(${score}% - 12px)`;

    // Determine recommendation + auto-select PAC
    var recoKW;
    if (score <= 25) {
        el.textContent = lowKW + ' kW';
        el.style.color = '#16a34a';
        alt.textContent = 'Isolation performante \u2192 puissance optimisÃ©e';
        if (hint) hint.textContent = '';
        recoKW = lowKW;
    } else if (score >= 75) {
        el.textContent = highKW + ' kW';
        el.style.color = '#dc2626';
        alt.textContent = 'Isolation faible \u2192 puissance supÃ©rieure conseillÃ©e';
        if (hint) hint.textContent = '';
        recoKW = highKW;
    } else {
        el.textContent = lowKW + ' ou ' + highKW + ' kW';
        el.style.color = '#d97706';
        alt.textContent = lowKW + ' kW = Ã©conomique Â· ' + highKW + ' kW = confort';
        if (hint) hint.textContent = '';
        recoKW = highKW; // prefer comfort
    }
    // Auto-select best PAC from catalog (Wolf preferred)
    autoSelectPAC(recoKW);
}

function autoSelectPAC(targetKW) {
    // Priority: Wolf Mono (with 2kW tolerance) > exact match > closest
    var models = [];
    for (var key in PAC_CATALOG) {
        var p = PAC_CATALOG[key];
        var cap = parseFloat((p.cap35 || '').replace(',', '.')) || 0;
        var brand = (p.m || '').toUpperCase();
        var isMono = key.indexOf('_T') === -1 && key.indexOf('_400') === -1;
        models.push({key: key, brand: brand, kw: cap, mono: isMono});
    }
    // First pass: find best Wolf Mono within 2kW (round up preferred)
    var bestWolf = null, bestWolfDiff = Infinity;
    for (var i = 0; i < models.length; i++) {
        var m = models[i];
        if (!m.mono || m.brand !== 'WOLF') continue;
        var diff = m.kw - targetKW; // positive = larger (good for comfort)
        var absDiff = Math.abs(diff);
        if (absDiff <= 2 && (absDiff < bestWolfDiff || (absDiff === bestWolfDiff && diff > 0))) {
            bestWolf = m;
            bestWolfDiff = absDiff;
        }
    }
    // If Wolf found within tolerance, use it
    var best = bestWolf;
    // Otherwise fallback: closest Mono from any brand
    if (!best) {
        var bestDiff = Infinity;
        for (var j = 0; j < models.length; j++) {
            var m2 = models[j];
            if (!m2.mono) continue;
            var d = Math.abs(m2.kw - targetKW);
            if (d < bestDiff) { best = m2; bestDiff = d; }
        }
    }
    if (best) {
        var sel = document.getElementById('marquePAC');
        if (sel) {
            sel.value = best.key;
            sel.dispatchEvent(new Event('change'));
        }
    }
}

function syncMenageCEE() {
    const cat = document.getElementById('categorie').value;
    document.getElementById('menageCEE').value = (cat === 'BLEU') ? 'tm' : 'autres';
    calcCEEDetail();
}

function syncSurfaces(from) {
    const val = (from === 'bareme')
        ? document.getElementById('baremeSurface').value
        : (from === 'cee')
        ? document.getElementById('ceeSurface').value
        : document.getElementById('dimSurface').value;
    const s = parseInt(val) || 100;
    document.getElementById('baremeSurface').value = s;
    document.getElementById('dimSurface').value = s;
    const ceeSurf = document.getElementById('ceeSurface');
    if (ceeSurf) ceeSurf.value = s;

    // Auto-set surface dropdown (maison)
    const tl = document.getElementById('typeLogement').value;
    const sel = document.getElementById('surface');
    if (tl === 'maison') {
        if (s < 70) sel.value = 'S<70';
        else if (s < 90) sel.value = '70<=S<90';
        else sel.value = 'S>=90';
    } else {
        if (s < 35) sel.value = 'S<35';
        else if (s < 60) sel.value = '35<=S<60';
        else sel.value = 'S>=60';
    }

    calcBareme();
    calcDim();
    calcCEEDetail();
    calc();
}

function syncSurfaceFromClient() {
    var v = parseInt(document.getElementById('surfaceClient').value) || 0;
    if (v > 0) {
        document.getElementById('ceeSurface').value = v;
        syncSurfaces('cee');
    }
}

function buildBaremeTable() { /* table removed */ }

function selectG(g) { /* legacy compat */ currentG = g; calcDim(); }

function calcDim() {
    const S = parseFloat(document.getElementById('dimSurface').value) || 0;
    const H = parseFloat(document.getElementById('dimHauteur').value) || 2.5;
    const V = S * H;

    const Tbase = parseFloat(document.getElementById('dimTbase').value) || -7;
    const Tint = parseFloat(document.getElementById('dimTint').value) || 21;
    const deltaT = Tint - Tbase;

    const G = getEffectiveG();
    currentG = G;
    const gDisplay = document.getElementById('dimGDisplay');
    if (gDisplay) gDisplay.textContent = `G = ${G.toFixed(2).replace('.', ',')}`;

    const P = G * V * deltaT;
    const T1 = parseFloat(document.getElementById('dimT1').value) || 60;
    const T2 = parseFloat(document.getElementById('dimT2').value) || 140;

    const puissancePAC = P * T1 / 100;
    const puissanceTotale = P * T2 / 100;
    const puissanceAppoint = puissanceTotale - puissancePAC;

    document.getElementById('dimDeperditions').textContent = Math.round(P).toLocaleString('fr-FR') + ' W';
    document.getElementById('dimDepFormula').textContent = `${G.toFixed(2).replace('.', ',')} \u00D7 ${Math.round(V)} \u00D7 ${deltaT}`;

    document.getElementById('dimPuissancePAC').textContent = (puissancePAC / 1000).toFixed(1).replace('.', ',') + ' kW';
    document.getElementById('dimPuissancePACDetail').textContent = `${Math.round(P).toLocaleString('fr-FR')} W \u00D7 ${T1}%`;

    document.getElementById('dimPuissanceAppoint').textContent = (puissanceAppoint / 1000).toFixed(1).replace('.', ',') + ' kW';
    document.getElementById('dimPuissanceAppointDetail').textContent = `(P \u00D7 ${T2}% \u2212 PAC)`;

    document.getElementById('dimPuissanceTotale').textContent = (puissanceTotale / 1000).toFixed(1).replace('.', ',') + ' kW';
}

// ============================================
// INIT
// ============================================
dbg('\uD83D\uDE80 Init start');
checkAutoLogin();
dbg('\uD83C\uDFC1 Init complete');
// Triple-tap to show debug panel


// ============================================
// ITE SIMULATOR - ALL FUNCTIONS
// ============================================
const ite_$=id=>document.getElementById(id);
const ite_V=id=>{const el=ite_$(id);return el?el.value.trim():'';};
const ite_N=id=>{const el=ite_$(id);return el?parseFloat(el.value)||0:0;};
const ite_fmt=n=>parseFloat(n).toLocaleString('fr-FR',{minimumFractionDigits:2,maximumFractionDigits:2})+' \u20AC';
const ite_fmtN=n=>Math.round(n).toLocaleString('fr-FR');

// CEE EDF baremes
const CEE_ITE_102={classique:{H1:11,H2:9,H3:6},modeste:{H1:16,H2:13,H3:9},grande:{H1:22,H2:18,H3:12}};
const CEE_ITE_101={classique:{H1:14,H2:11,H3:8},modeste:{H1:20,H2:16,H3:11},grande:{H1:28,H2:22,H3:16}};
const CEE_ITE_103={classique:{H1:9,H2:7,H3:5},modeste:{H1:13,H2:11,H3:7},grande:{H1:18,H2:15,H3:10}};
const CEE_ITE_148={classique:150,modeste:200,grande:300};

function ite_switchLot2(){
    var t=ite_V('iteTypeLot2');
    ite_$('iteCard101').style.display=t==='101'?'block':'none';
    ite_$('iteCard103').style.display=t==='103'?'block':'none';
    ite_$('iteCard148').style.display=t==='148'?'block':'none';
}

function ite_getLot2Total(){
    var t=ite_V('iteTypeLot2');
    if(t==='101'){
        var s=ite_N('iteSurface101');
        var tot=Math.max(s*30, s<50?1500:0);
        // Sync hidden fields (ratio 57/43) pour le devis
        var pm=tot/s*0.57, pmo=tot/s*0.43;
        if(ite_$('itePrixMat101'))ite_$('itePrixMat101').value=pm.toFixed(2);
        if(ite_$('itePrixMo101'))ite_$('itePrixMo101').value=pmo.toFixed(2);
        return tot;
    }
    if(t==='103'){
        var s=ite_N('iteSurface103');
        var tot=Math.max(s*30, s<50?1500:0);
        var pm=tot/s*0.57, pmo=tot/s*0.43;
        if(ite_$('itePrixMat103'))ite_$('itePrixMat103').value=pm.toFixed(2);
        if(ite_$('itePrixMo103'))ite_$('itePrixMo103').value=pmo.toFixed(2);
        return tot;
    }
    // BAR-TH-148 : 2200â‚¬ fixe (ratio ~70/30)
    if(ite_$('itePrixCET'))ite_$('itePrixCET').value='1538';
    if(ite_$('itePrixPoseCET'))ite_$('itePrixPoseCET').value='662';
    return 2200;
}

function ite_switchLot3(){
    var inc=ite_V('iteIncludeLot3')==='oui';
    ite_$('iteTypeLot3Wrap').style.display=inc?'block':'none';
    ite_$('iteCard101L3').style.display='none';
    ite_$('iteCard103L3').style.display='none';
    ite_$('iteCard148L3').style.display='none';
    if(inc){
        var t=ite_V('iteTypeLot3');
        if(t==='101')ite_$('iteCard101L3').style.display='block';
        else if(t==='103')ite_$('iteCard103L3').style.display='block';
        else ite_$('iteCard148L3').style.display='block';
    }
}

function ite_getLot3Total(){
    if(ite_V('iteIncludeLot3')!=='oui')return 0;
    var t=ite_V('iteTypeLot3');
    if(t==='101'){
        var s=ite_N('iteSurface101L3');
        var tot=Math.max(s*30, s<50?1500:0);
        var pm=tot/s*0.57, pmo=tot/s*0.43;
        if(ite_$('itePrixMat101L3'))ite_$('itePrixMat101L3').value=pm.toFixed(2);
        if(ite_$('itePrixMo101L3'))ite_$('itePrixMo101L3').value=pmo.toFixed(2);
        return tot;
    }
    if(t==='103'){
        var s=ite_N('iteSurface103L3');
        var tot=Math.max(s*30, s<50?1500:0);
        var pm=tot/s*0.57, pmo=tot/s*0.43;
        if(ite_$('itePrixMat103L3'))ite_$('itePrixMat103L3').value=pm.toFixed(2);
        if(ite_$('itePrixMo103L3'))ite_$('itePrixMo103L3').value=pmo.toFixed(2);
        return tot;
    }
    if(ite_$('itePrixCETL3'))ite_$('itePrixCETL3').value='1538';
    if(ite_$('itePrixPoseCETL3'))ite_$('itePrixPoseCETL3').value='662';
    return 2200;
}

function ite_getCEE(){
    var z=document.getElementById('zone').value;
    var p=ite_V('itePrecarite');
    var s=ite_N('iteSurfaceITE');
    var t2=ite_V('iteTypeLot2');
    var c102=(CEE_ITE_102[p]||CEE_ITE_102.classique)[z]||0;
    var p1=s*c102;
    var p2=0,u101=0,u103=0,u148=0;
    if(t2==='101'){u101=(CEE_ITE_101[p]||CEE_ITE_101.classique)[z]||0;p2=ite_N('iteSurface101')*u101;}
    else if(t2==='103'){u103=(CEE_ITE_103[p]||CEE_ITE_103.classique)[z]||0;p2=ite_N('iteSurface103')*u103;}
    else{u148=CEE_ITE_148[p]||150;p2=u148;}
    // LOT 3
    var p3=0,u101L3=0,u103L3=0,u148L3=0;
    if(ite_V('iteIncludeLot3')==='oui'){
        var t3=ite_V('iteTypeLot3');
        if(t3==='101'){u101L3=(CEE_ITE_101[p]||CEE_ITE_101.classique)[z]||0;p3=ite_N('iteSurface101L3')*u101L3;}
        else if(t3==='103'){u103L3=(CEE_ITE_103[p]||CEE_ITE_103.classique)[z]||0;p3=ite_N('iteSurface103L3')*u103L3;}
        else{u148L3=CEE_ITE_148[p]||150;p3=u148L3;}
    }
    return{p1:p1,p2:p2,p3:p3,total:p1+p2+p3,c102:c102,u101:u101,u103:u103,u148:u148,u101L3:u101L3,u103L3:u103L3,u148L3:u148L3};
}

function ite_onMontantTotal(){
    var ttc=ite_N('iteMontantTotalProjet');
    var totLot2=ite_getLot2Total();
    var totLot3=ite_getLot3Total();
    var totLot1=Math.max(ttc-totLot2-totLot3,0);
    ite_$('iteMontantLot1').value=totLot1;
    var det=ite_$('iteMontantDetail');
    var detTxt='LOT 1 : <b>'+ite_fmtN(totLot1)+' \u20AC</b> + LOT 2 : <b>'+ite_fmtN(totLot2)+' \u20AC</b>';
    if(totLot3>0)detTxt+=' + LOT 3 : <b>'+ite_fmtN(totLot3)+' \u20AC</b>';
    detTxt+=' = <b>'+ite_fmtN(ttc)+' \u20AC TTC</b>';
    if(det) det.innerHTML=detTxt;
    ite_calc();
}

function ite_calc(){
    try{
    var sITE=ite_N('iteSurfaceITE');
    var totLot2=ite_getLot2Total();
    var totLot3=ite_getLot3Total();
    var hasLot3=ite_V('iteIncludeLot3')==='oui'&&totLot3>0;
    var ttc=ite_N('iteMontantTotalProjet');
    var totITE=Math.max(ttc-totLot2-totLot3,0);
    ite_$('iteMontantLot1').value=totITE;
    var det=ite_$('iteMontantDetail');
    var detTxt='LOT 1 : <b>'+ite_fmtN(totITE)+' \u20AC</b> + LOT 2 : <b>'+ite_fmtN(totLot2)+' \u20AC</b>';
    if(hasLot3)detTxt+=' + LOT 3 : <b>'+ite_fmtN(totLot3)+' \u20AC</b>';
    detTxt+=' = <b>'+ite_fmtN(ttc)+' \u20AC TTC</b>';
    if(det) det.innerHTML=detTxt;
    var tva=parseFloat(ite_$('iteTva')?.value)||5.5,ht=ttc/(1+tva/100);
    var cee=ite_getCEE();
    ite_$('itePrimeCEE').value=cee.total.toFixed(2);
    var primeCEE=cee.total,reste=ttc-primeCEE;
    var lot2Ok=totLot2>=1500,t2=ite_V('iteTypeLot2');
    var lot3Ok=!hasLot3||totLot3>=1500;
    var z=document.getElementById('zone').value;
    var p=ite_V('itePrecarite');
    var nbLots=hasLot3?3:2;
    var plafondPTZ=hasLot3?30000:25000;

    // Lot2 alert
    ite_$('iteLot2Alert').innerHTML=lot2Ok
        ?'<div class="ite-alert ite-alert-ok">\u2705 LOT 2 : '+ite_fmtN(totLot2)+' \u20AC \u2014 Minimum 1 500 \u20AC respect\u00e9</div>'
        :'<div class="ite-alert ite-alert-warn">\ud83d\udea8 LOT 2 : <b style="font-size:16px;">'+ite_fmtN(totLot2)+' \u20AC</b> \u2014 EN DESSOUS DU MINIMUM 1 500 \u20AC !</div>';

    // Lot3 alert
    var l3a=ite_$('iteLot3Alert');
    if(l3a){
        if(!hasLot3) l3a.innerHTML='';
        else l3a.innerHTML=lot3Ok
            ?'<div class="ite-alert ite-alert-ok">\u2705 LOT 3 : '+ite_fmtN(totLot3)+' \u20AC \u2014 Minimum 1 500 \u20AC respect\u00e9</div>'
            :'<div class="ite-alert ite-alert-warn">\ud83d\udea8 LOT 3 : <b style="font-size:16px;">'+ite_fmtN(totLot3)+' \u20AC</b> \u2014 EN DESSOUS DU MINIMUM 1 500 \u20AC !</div>';
    }

    // PTZ
    var ptzOk=lot2Ok&&lot3Ok&&totITE>0;
    var lot2Label=t2==='101'?'101':t2==='103'?'103':'148';
    var ptzMsg='';
    if(ptzOk){
        ptzMsg='\ud83c\udfdb\ufe0f <b>\u00c9LIGIBLE PTZ</b> \u2014 '+nbLots+' lots \u00b7 Plafond <b>'+ite_fmtN(plafondPTZ)+' \u20AC</b>';
    } else {
        var reasons=[];
        if(!lot2Ok)reasons.push('Lot 2 < 1 500 \u20AC');
        if(hasLot3&&!lot3Ok)reasons.push('Lot 3 < 1 500 \u20AC');
        if(totITE<=0)reasons.push('Lot 1 = 0');
        ptzMsg='\u274c <b>NON \u00c9LIGIBLE PTZ</b> \u2014 '+reasons.join(' / ');
    }
    ite_$('itePtzStatus').innerHTML=ptzOk
        ?'<div class="ite-alert ite-alert-ptz" style="font-size:14px;">'+ptzMsg+'</div>'
        :'<div class="ite-alert ite-alert-warn">'+ptzMsg+'</div>';

    // CEE Table
    var lot2Row=t2==='101'?'<tr class="active"><td><b>BAR-EN-101</b> Combles</td><td>'+z+'</td><td>'+p+'</td><td>'+ite_N('iteSurface101')+' m\u00b2</td><td>'+cee.u101+' \u20AC/m\u00b2</td><td class="val">'+ite_fmt(cee.p2)+'</td></tr>'
        :t2==='103'?'<tr class="active"><td><b>BAR-EN-103</b> Plancher</td><td>'+z+'</td><td>'+p+'</td><td>'+ite_N('iteSurface103')+' m\u00b2</td><td>'+cee.u103+' \u20AC/m\u00b2</td><td class="val">'+ite_fmt(cee.p2)+'</td></tr>'
        :'<tr class="active"><td><b>BAR-TH-148</b> CET</td><td>'+z+'</td><td>'+p+'</td><td>1 U</td><td>'+cee.u148+' \u20AC forfait</td><td class="val">'+ite_fmt(cee.p2)+'</td></tr>';
    var lot3Row='';
    if(hasLot3){
        var t3=ite_V('iteTypeLot3');
        lot3Row=t3==='101'?'<tr class="active"><td><b>BAR-EN-101</b> Combles (L3)</td><td>'+z+'</td><td>'+p+'</td><td>'+ite_N('iteSurface101L3')+' m\u00b2</td><td>'+cee.u101L3+' \u20AC/m\u00b2</td><td class="val">'+ite_fmt(cee.p3)+'</td></tr>'
            :t3==='103'?'<tr class="active"><td><b>BAR-EN-103</b> Plancher (L3)</td><td>'+z+'</td><td>'+p+'</td><td>'+ite_N('iteSurface103L3')+' m\u00b2</td><td>'+cee.u103L3+' \u20AC/m\u00b2</td><td class="val">'+ite_fmt(cee.p3)+'</td></tr>'
            :'<tr class="active"><td><b>BAR-TH-148</b> CET (L3)</td><td>'+z+'</td><td>'+p+'</td><td>1 U</td><td>'+cee.u148L3+' \u20AC forfait</td><td class="val">'+ite_fmt(cee.p3)+'</td></tr>';
    }
    ite_$('iteCeeTableContainer').innerHTML='<table class="ite-cee-table"><tr><th>Op\u00e9ration</th><th>Zone</th><th>Pr\u00e9carit\u00e9</th><th>Qt\u00e9</th><th>\u20AC/unit\u00e9</th><th style="text-align:right">Prime</th></tr>'
        +'<tr class="active"><td><b>BAR-EN-102</b> ITE</td><td>'+z+'</td><td>'+p+'</td><td>'+sITE+' m\u00b2</td><td>'+cee.c102+' \u20AC/m\u00b2</td><td class="val">'+ite_fmt(cee.p1)+'</td></tr>'
        +lot2Row+lot3Row
        +'<tr style="background:rgba(22,163,74,0.08);"><td colspan="5" style="font-weight:900;font-size:13px;">TOTAL CEE EDF</td><td class="val" style="font-size:15px;font-weight:900;">'+ite_fmt(cee.total)+'</td></tr></table>';

    // KPI summary
    var kpiLot3=hasLot3?'<div class="ite-kpi"><div class="ite-kpi-icon">\ud83d\udee0\ufe0f</div><div class="ite-kpi-val'+(lot3Ok?'':' red')+'">'+ite_fmtN(totLot3)+' \u20AC</div><div class="ite-kpi-label">LOT 3</div></div>':'';
    ite_$('iteAidesSummary').innerHTML='<div class="ite-kpi-row">'
        +'<div class="ite-kpi"><div class="ite-kpi-icon">\ud83e\uddf1</div><div class="ite-kpi-val">'+ite_fmtN(totITE)+' \u20AC</div><div class="ite-kpi-label">LOT 1 \u00b7 ITE</div></div>'
        +'<div class="ite-kpi"><div class="ite-kpi-icon">'+(t2==='101'?'\ud83c\udfe0':t2==='103'?'\ud83c\udfe0':'\ud83d\udebf')+'</div><div class="ite-kpi-val'+(lot2Ok?'':' red')+'">'+ite_fmtN(totLot2)+' \u20AC</div><div class="ite-kpi-label">LOT 2</div></div>'
        +kpiLot3
        +'<div class="ite-kpi"><div class="ite-kpi-icon">\ud83d\udcdc</div><div class="ite-kpi-val">'+ite_fmtN(primeCEE)+' \u20AC</div><div class="ite-kpi-label">CEE EDF</div></div>'
        +'<div class="ite-kpi"><div class="ite-kpi-icon">\ud83d\udcb0</div><div class="ite-kpi-val">'+ite_fmtN(reste)+' \u20AC</div><div class="ite-kpi-label">Reste \u00e0 r\u00e9gler</div></div></div>';

    // Financement : saisie manuelle (montants exacts du simulateur Domofinance)

    // Sidebar update
    var sl1=ite_$('iteSidebarLot1');if(sl1)sl1.textContent=ite_fmtN(totITE)+' \u20AC';
    var sl2=ite_$('iteSidebarLot2');if(sl2){sl2.textContent=ite_fmtN(totLot2)+' \u20AC';sl2.className='rrc-value '+(lot2Ok?'':'red');}
    var sl2t=ite_$('iteSidebarLot2Type');if(sl2t)sl2t.textContent=t2==='101'?'BAR-EN-101':t2==='103'?'BAR-EN-103':'BAR-TH-148';
    var sl2a=ite_$('iteSidebarLot2Alert');if(sl2a)sl2a.style.display=lot2Ok?'none':'block';
    var sc=ite_$('iteSidebarCEE');if(sc)sc.textContent=ite_fmtN(primeCEE)+' \u20AC';
    var st=ite_$('iteSidebarTTC');if(st)st.textContent=ite_fmtN(ttc)+' \u20AC';
    var sr=ite_$('iteSidebarReste');if(sr)sr.textContent=ite_fmtN(reste)+' \u20AC';
    var sp=ite_$('iteSidebarPTZ');if(sp)sp.innerHTML=ptzOk
        ?'<div style="padding:10px;border-radius:8px;background:rgba(59,130,246,0.08);border:1px solid rgba(59,130,246,0.15);color:#60a5fa;text-align:center;font-weight:700;font-size:13px;">\ud83c\udfdb\ufe0f PTZ '+nbLots+' lots \u00b7 Plafond '+ite_fmtN(plafondPTZ)+' \u20AC</div>'
        :'<div style="padding:10px;border-radius:8px;background:rgba(248,113,113,0.06);border:1px solid rgba(248,113,113,0.12);color:#f87171;text-align:center;font-weight:600;font-size:12px;">\u274c Non \u00e9ligible PTZ</div>';
    }catch(e){console.error('ite_calc error:',e);}
}

// Sync profil -> precarite
function syncProfilPrecarite(){
    var cat=document.getElementById('categorie').value;
    var prec='classique';
    if(cat==='BLEU') prec='grande';
    else if(cat==='JAUNE') prec='modeste';
    else prec='classique';
    var sel=document.getElementById('itePrecarite');
    if(sel) sel.value=prec;
    try{ite_calc();}catch(e){}
}

// Google Sheet search for ITE
var ite_csvCache=null;
function ite_setStatus(cls,msg){
    var s=ite_$('iteSearchStatus');
    if(!s)return;
    s.className='ite-search-status '+cls;
    s.innerHTML=msg;
    s.style.display='block';
}
function ite_fetchCSV(){
    return new Promise(function(resolve){
        if(ite_csvCache){resolve(ite_csvCache);return;}
        ite_setStatus('loading','\u23f3 Chargement\u2026');
        var ID='1J88r4JUwqVvZFbdAFvj3MffBkEO3gYv7dYiXHhQT3C0';
        var cb='__itecb'+Date.now();
        var url='https://docs.google.com/spreadsheets/d/'+ID+'/gviz/tq?tqx=responseHandler:'+cb;
        window[cb]=function(d){
            try{
                delete window[cb];
                var ss=document.getElementById('iteSS');if(ss)ss.remove();
                if(!d||!d.table){ite_setStatus('err','\u274c');resolve(null);return;}
                var h=d.table.cols.map(function(c){return c.label||'';});
                var rows=[h];
                for(var i=0;i<d.table.rows.length;i++){
                    var row=d.table.rows[i];
                    rows.push(row.c.map(function(c){return c?((c.f!=null)?c.f:(c.v!=null?String(c.v):'')):''; }));
                }
                ite_csvCache=rows;
                resolve(ite_csvCache);
            }catch(e){ite_setStatus('err','\u274c '+e.message);resolve(null);}
        };
        var s=document.createElement('script');s.id='iteSS';s.src=url;
        s.onerror=function(){delete window[cb];s.remove();ite_setStatus('err','\u274c R\u00e9seau');resolve(null);};
        document.body.appendChild(s);
        setTimeout(function(){if(!ite_csvCache){ite_setStatus('err','\u274c Timeout');resolve(null);}},10000);
    });
}

// Charge un dossier (row) dans tous les champs
function ite_loadDossier(f){
    var g=function(idx){return(f[idx]||'').trim();};
    document.getElementById('nom').value=g(2)+' '+g(3);
    document.getElementById('prenom').value=g(1);
    var cp=g(16)||g(12);
    if(cp){
        var dept=cp.substring(0,2);
        if(dept==='97') dept=cp.substring(0,3);
        var deptEl=document.getElementById('departement');
        if(deptEl&&dept){deptEl.value=dept;try{detectDept();}catch(e){}}
    }
    ite_$('iteNumClient').value=g(0);
    ite_$('iteNumDevis').value=g(0);
    ite_$('iteAdresse').value=g(14)||g(10);
    var vi=g(20)||g(17);
    ite_$('iteVille').value=cp&&vi?cp+' '+vi.toUpperCase():'';
    var t=g(21);if(t&&!t.startsWith('0')&&t.length<=9)t='0'+t;
    ite_$('iteTel').value=t;
    var em=g(23);ite_$('iteEmail').value=em&&em.toLowerCase()!=='n\u00e9ant'?em:'';
    var pm={'grande':'grande','simple':'modeste','classique':'classique'};
    ite_$('itePrecarite').value=pm[g(26).toLowerCase()]||'classique';
    (function(){var ch=g(34).toLowerCase(),tc=ite_$('iteTypeChauffage');if(!tc)return;
        if(ch.includes('fioul')||ch.includes('fuel'))tc.value='Fioul';
        else if(ch.includes('gaz'))tc.value='Gaz';
        else if(ch.includes('electr')||ch.includes('\u00e9lectr'))tc.value='\u00c9lectrique';
        else if(ch.includes('bois')||ch.includes('granul'))tc.value='Bois';
        else if(ch.includes('pac')||ch.includes('pompe'))tc.value='PAC';
    })();
    // Surface habitable (col 35)
    var surf=parseFloat(g(35))||0;
    if(surf>0){
        var sc=document.getElementById('surfaceClient');
        if(sc) sc.value=Math.round(surf);
        var ceeSurf=document.getElementById('ceeSurface');
        if(ceeSurf){ceeSurf.value=Math.round(surf);try{syncSurfaces('cee');}catch(e){}}
        var surfSel=document.getElementById('surface');
        if(surfSel){
            if(surf<70) surfSel.value='S<70';
            else if(surf<90) surfSel.value='70<=S<90';
            else surfSel.value='S>=90';
        }
    }
    var z=g(42).toUpperCase();
    if(z){var zs=document.getElementById('zone');if(zs){for(var j=0;j<zs.options.length;j++){if(zs.options[j].value===z){zs.selectedIndex=j;break;}}}}
    try{ite_calc();}catch(e){}
    try{calc();}catch(e){}
    try{checkExport();}catch(e){}
    ite_setStatus('ok','\u2705 '+g(0)+' \u2014 '+(g(1)+' '+g(2)+' '+g(3)).trim());
    var pl=document.getElementById('dossierPickerList');if(pl)pl.style.display='none';
}

// Affiche le picker quand plusieurs dossiers correspondent
var _ite_matches=[];
function ite_showDossierPicker(matches){
    _ite_matches=matches;
    var pl=document.getElementById('dossierPickerList');
    if(!pl)return;
    var html='<div class="dossier-picker-title">&#128276; '+matches.length+' dossiers trouv\u00e9s &mdash; lequel charger ?</div>';
    matches.forEach(function(row,i){
        var num=(row[0]||'').trim();
        var prenom=(row[1]||'').trim();
        var nom=((row[2]||'')+(row[3]?' '+row[3]:'')).trim();
        var tel=(row[21]||'').trim();
        var ville=(row[17]||row[20]||'').trim();
        html+='<div class="dossier-picker-item" onclick="ite_loadDossier(_ite_matches['+i+'])">'
            +'<span class="dossier-picker-num">'+num+'</span>'
            +'<span class="dossier-picker-name">'+(prenom+' '+nom).trim()+(ville?' &middot; '+ville:'')+'</span>'
            +'<span class="dossier-picker-tel">'+tel+'</span>'
            +'</div>';
    });
    pl.innerHTML=html;
    pl.style.display='block';
    ite_setStatus('loading','&#128276; '+matches.length+' r\u00e9sultats &mdash; choisissez un dossier ci-dessous');
}

async function ite_searchClient(){
    var q=ite_V('iteNumClient').trim();
    if(!q||q==='AVR-202XX'){ite_setStatus('err','\u274c Saisissez un n\u00b0 de dossier ou un t\u00e9l');return;}
    var qUp=q.toUpperCase();
    // Masquer le picker prÃ©cÃ©dent
    var pl=document.getElementById('dossierPickerList');if(pl)pl.style.display='none';
    ite_$('iteBtnSearch').disabled=true;
    try{
        var rows=await ite_fetchCSV();
        if(!rows){ite_$('iteBtnSearch').disabled=false;return;}
        var matches=[];
        // 1. Correspondance exacte nÂ° dossier (col 0)
        for(var i=1;i<rows.length;i++){
            if((rows[i][0]||'').toUpperCase().trim()===qUp) matches.push(rows[i]);
        }
        // 2. Partielle nÂ° dossier
        if(matches.length===0){
            for(var i=1;i<rows.length;i++){
                var id=(rows[i][0]||'').toUpperCase().trim();
                if(id&&(id.includes(qUp)||qUp.includes(id))) matches.push(rows[i]);
            }
        }
        // 3. Recherche par tÃ©lÃ©phone (col 21) â€” normaliser
        if(matches.length===0){
            var qTel=q.replace(/[\s.\-]/g,'');
            if(qTel.length>=6){
                for(var i=1;i<rows.length;i++){
                    var t=(rows[i][21]||'').replace(/[\s.\-]/g,'');
                    if(t&&t===qTel) matches.push(rows[i]);
                }
                // Partielle tÃ©lÃ©phone
                if(matches.length===0){
                    for(var i=1;i<rows.length;i++){
                        var t=(rows[i][21]||'').replace(/[\s.\-]/g,'');
                        if(t&&(t.includes(qTel)||qTel.includes(t))) matches.push(rows[i]);
                    }
                }
            }
        }
        if(matches.length===0){ite_setStatus('err','\u274c '+q+' non trouv\u00e9');return;}
        if(matches.length===1){ite_loadDossier(matches[0]);}
        else{ite_showDossierPicker(matches);}
    }catch(e){ite_setStatus('err','\u274c '+e.message);}finally{ite_$('iteBtnSearch').disabled=false;}
}

// ============================================
// ITE DEVIS GENERATION (PDF)
// ============================================
function ite_dvTH(){return'<div class="dv-th"><div>D\u00e9tail</div><div class="c">Qt\u00e9</div><div class="r">P.U TTC</div><div class="r">Total TTC</div><div class="r">TVA</div></div>';}
function ite_dvFT(p,t){return'<div class="dv-footer">LES ARTISANS VERTS SAS Soci\u00e9t\u00e9 par actions simplifi\u00e9e au capital de 40 000 \u20ac Si\u00e8ge social : 6 passage Eug\u00e8ne Barbier, 92400 Courbevoie<br>E-mail : contact@artisansverts.energy T\u00e9l\u00e9phone : 01 87 66 27 08 SIRET : 878 062 793 00038 TVA intracommunautaire : FR34 878062793<br>Assurance d\u00e9cennale : GROUPE LEADER insurance N\u00b0 de police :LUNS2507132 P\u00e9riode de validit\u00e9 : du 01/01/2026 au 31/12/2026<span class="dv-pn">'+p+'/'+t+'</span></div>';}

// ============================================
// LOGOS BASE64 (remplacer par les vrais logos)
// ============================================
var LOGO_AV_B64='data:image/png;base64,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';
var LOGO_RGE_B64='data:image/png;base64,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';

function dv_logoHeader(){
    var logoLeft=LOGO_AV_B64
        ? '<img src="'+LOGO_AV_B64+'" style="height:24mm;width:auto;">'
        : '<div style="font-size:18pt;font-weight:900;line-height:1.2;"><span style="color:#333;">ARTISANS</span> <span style="color:#16a34a;">VERTS</span></div>';
    var logoRight=LOGO_RGE_B64
        ? '<div style="text-align:right;"><img src="'+LOGO_RGE_B64+'" style="height:16mm;width:auto;"><div style="font-size:5.5pt;color:#333;text-align:center;line-height:1.3;margin-top:1mm;">N\u00b0 QPAC/69719<br>VAL 15/02/2027</div></div>'
        : '<div style="border:2px solid #7b2d8e;border-radius:6px;padding:4px 6px;width:74px;text-align:center;background:#fff;"><div style="font-size:9pt;font-weight:900;color:#7b2d8e;letter-spacing:0.5px;">RGE</div><div style="font-size:8.5pt;font-weight:800;line-height:1.1;"><span style="color:#7b2d8e;">Quali</span><span style="color:#16a34a;">Pac</span></div><div style="font-size:5pt;color:#333;margin-top:2px;line-height:1.3;">N\u00b0 QPAC/69719<br>VAL 15/02/2027</div></div>';
    return '<div class="dv-header">'+logoLeft+logoRight+'</div>';
}

function dv_subHeader(num,df,nom){
    return dv_logoHeader()+'<div style="font-size:12pt;font-weight:900;border-bottom:2px solid #000;padding-bottom:2mm;margin-bottom:3mm;display:flex;justify-content:space-between;"><span>DEVIS '+num+' du '+df+'</span><span>'+nom+'</span></div>'+ite_dvTH();
}

// ============================================
// PDF LIBS DYNAMIC LOADER
// ============================================
function loadScript(src){
    return new Promise(function(resolve,reject){
        var existing=document.querySelector('script[src="'+src+'"]');
        if(existing){existing.remove();}
        var s=document.createElement('script');
        s.src=src;
        s.crossOrigin='anonymous';
        s.onload=resolve;
        s.onerror=function(){reject(new Error('Impossible de charger: '+src));};
        document.head.appendChild(s);
    });
}

var JSPDF_CDNS=[
    'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.2/jspdf.umd.min.js',
    'https://unpkg.com/jspdf@2.5.2/dist/jspdf.umd.min.js',
    'https://cdn.jsdelivr.net/npm/jspdf@2.5.2/dist/jspdf.umd.min.js'
];
var H2C_CDNS=[
    'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js',
    'https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js',
    'https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js'
];

async function ensureJsPDF(){
    if(window.jspdf && window.jspdf.jsPDF) return window.jspdf.jsPDF;
    for(var i=0;i<JSPDF_CDNS.length;i++){
        try{
            await loadScript(JSPDF_CDNS[i]);
            if(window.jspdf && window.jspdf.jsPDF) return window.jspdf.jsPDF;
        }catch(e){console.warn('jsPDF CDN '+i+' failed:',e);}
    }
    throw new Error('Impossible de charger la biblioth\u00e8que jsPDF. V\u00e9rifiez votre connexion internet.');
}

async function ensureHtml2Canvas(){
    if(typeof html2canvas==='function') return html2canvas;
    for(var i=0;i<H2C_CDNS.length;i++){
        try{
            await loadScript(H2C_CDNS[i]);
            if(typeof html2canvas==='function') return html2canvas;
        }catch(e){console.warn('html2canvas CDN '+i+' failed:',e);}
    }
    throw new Error('Impossible de charger la biblioth\u00e8que html2canvas. V\u00e9rifiez votre connexion internet.');
}

// ============================================
// PDF DOWNLOAD (remplace window.print)
// ============================================
async function downloadDevisPDF(containerId,filename){
    var container=document.getElementById(containerId);
    var pages=container.querySelectorAll('.ite-page');
    if(!pages.length){alert('Aucune page \u00e0 g\u00e9n\u00e9rer');return;}
    // Loading overlay
    var ov=document.createElement('div');
    ov.id='pdfLoadingOverlay';
    ov.style.cssText='position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);z-index:99999;display:flex;align-items:center;justify-content:center;';
    ov.innerHTML='<div style="background:#fff;padding:32px 48px;border-radius:16px;text-align:center;font-family:Arial,sans-serif;"><div style="font-size:18px;font-weight:700;margin-bottom:12px;">G\u00e9n\u00e9ration du PDF...</div><div style="font-size:14px;color:#666;">Veuillez patienter</div></div>';
    document.body.appendChild(ov);
    try{
        var JsPDF=await ensureJsPDF();
        var h2c=await ensureHtml2Canvas();
        var pdf=new JsPDF('p','mm','a4');
        for(var i=0;i<pages.length;i++){
            if(i>0) pdf.addPage();
            var canvas=await h2c(pages[i],{scale:2,useCORS:true,backgroundColor:'#ffffff',logging:false,width:pages[i].scrollWidth,height:pages[i].scrollHeight});
            var imgData=canvas.toDataURL('image/jpeg',0.95);
            pdf.addImage(imgData,'JPEG',0,0,210,297);
        }
        pdf.save(filename);
    }catch(e){
        console.error('PDF generation error:',e);
        alert('Erreur lors de la g\u00e9n\u00e9ration du PDF: '+e.message);
    }finally{
        var ovEl=document.getElementById('pdfLoadingOverlay');
        if(ovEl) ovEl.remove();
    }
}

function ite_generateDevis(){
    var totLot2=ite_getLot2Total();
    var totLot3=ite_getLot3Total();
    var hasLot3=ite_V('iteIncludeLot3')==='oui'&&totLot3>0;
    if(totLot2<1500&&!confirm('\u26a0\ufe0f LOT 2 < 1500\u20ac ('+ite_fmtN(totLot2)+'\u20ac). Continuer ?'))return;
    if(hasLot3&&totLot3<1500&&!confirm('\u26a0\ufe0f LOT 3 < 1500\u20ac ('+ite_fmtN(totLot3)+'\u20ac). Continuer ?'))return;
    var nom=(document.getElementById('prenom').value.trim()+' '+document.getElementById('nom').value.trim()).trim()||'CLIENT';
    var num=ite_V('iteNumDevis'),nc=ite_V('iteNumClient')||num;
    var dRaw=ite_V('iteDateDevis').split('-'),df=dRaw[2]+'/'+dRaw[1]+'/'+dRaw[0];
    var adr=ite_V('iteAdresse'),vil=ite_V('iteVille'),tel=ite_V('iteTel'),em=ite_V('iteEmail');
    var zn=document.getElementById('zone').value;
    var prec=ite_V('itePrecarite'),tch=ite_V('iteTypeChauffage');
    var tlog='Maison individuelle / +15 ans';
    var con=ite_V('iteConseiller');
    var tva=parseFloat(ite_$('iteTva')?.value)||5.5;
    var sITE=ite_N('iteSurfaceITE'),totITE=ite_N('iteMontantLot1');
    var t2=ite_V('iteTypeLot2'),t3=hasLot3?ite_V('iteTypeLot3'):'',ttc=totITE+totLot2+totLot3,ht=ttc/(1+tva/100),tvam=ttc-ht;
    var primeCEE=ite_N('itePrimeCEE'),reste=ttc-primeCEE;
    var wFin=ite_V('iteIncludeFinancement')==='oui',tp=wFin?3:2;
    var precL={classique:'Classique',modeste:'Modeste',grande:'Grande pr\u00e9carit\u00e9'}[prec]||prec;

    var pg1='<div class="ite-page">'+dv_logoHeader();
    pg1+='<div class="dv-title"><span>DEVIS : '+num+'</span><span>'+nom+'</span></div>';
    pg1+='<div class="dv-info"><div class="dv-info-l">N\u00b0 Client : <b>'+nc+'</b><br>Date : <b>'+df+'</b><br>Adresse : '+adr+'<br>'+vil+'<br>Conseiller : <b>'+con+'</b></div><div class="dv-info-r">'+adr+'<br>'+vil+'<br>T\u00e9l : '+tel+'<br>Email : '+em+'<br>Zone : <b>'+zn+'</b><br>Pr\u00e9carit\u00e9 : <b>'+precL+'</b><br>Chauffage : <b>'+tch+'</b><br>'+tlog+'</div></div>';
    pg1+=ite_dvTH();
    pg1+='<div class="dv-block"><b>BAR-EN-102 : Isolation thermique des murs par l\'ext\u00e9rieur</b><br>Surface : <b>'+sITE.toFixed(2)+' m2</b> \u00b7 Isolant HIRSCH CELLOMUR ULTRA 120mm \u00b7 R=3,85 m\u00b2.K/W \u00b7 ACERMI 12/081/795<br><br>Sous-traitance <b>RL CONSEILS</b> SIRET 85320240600049 \u00b7 RGE E-E 184700</div>';
    pg1+='<div class="dv-row"><div class="n">ITE Murs Ext\u00e9rieurs â€” Fourniture et pose</div><div class="c">'+sITE.toFixed(2)+' m\u00b2</div><div class="r">'+ite_fmt(totITE/sITE)+'</div><div class="r">'+ite_fmt(totITE)+'</div><div class="r">'+tva.toFixed(2).replace('.',',')+'%</div></div>';
    pg1+='<div class="dv-specs">Isolant Hirsch \u00b7 Cellomur Ultra 120 \u00b7 R:3,85 \u00b7 ACERMI:12/081/795 \u00b7 Visserie \u00b7 Ossature \u00b7 Colle \u00b7 Enduit \u00b7 Finition \u00b7 \u00c9chafaudage \u00b7 Rail de d\u00e9part</div>';

    if(t2==='101'){
        var s2=ite_N('iteSurface101'),pm2=ite_N('itePrixMat101'),pmo2=ite_N('itePrixMo101');
        pg1+='<div class="dv-block" style="margin-top:3mm;"><b>BAR-EN-101 : Isolation des combles perdus par soufflage</b><br>Surface : <b>'+s2.toFixed(2)+' m2</b> \u00b7 R \u2265 7 m\u00b2.K/W<br>LES ARTISANS VERTS \u00b7 SIRET 87806279300038 \u00b7 RGE QPAC/69719</div>';
        pg1+='<div class="dv-row"><div class="n">Isolation souffl\u00e9 combles mat\u00e9riel</div><div class="c">'+s2.toFixed(2)+' m\u00b2</div><div class="r">'+ite_fmt(pm2)+'</div><div class="r">'+ite_fmt(s2*pm2)+'</div><div class="r">'+tva.toFixed(2).replace('.',',')+'%</div></div>';
        pg1+='<div class="dv-row"><div class="n">Mise en \u0153uvre isolation combles</div><div class="c">'+s2.toFixed(2)+' m\u00b2</div><div class="r">'+ite_fmt(pmo2)+'</div><div class="r">'+ite_fmt(s2*pmo2)+'</div><div class="r">'+tva.toFixed(2).replace('.',',')+'%</div></div>';
    } else if(t2==='103'){
        var s2=ite_N('iteSurface103'),pm2=ite_N('itePrixMat103'),pmo2=ite_N('itePrixMo103');
        pg1+='<div class="dv-block" style="margin-top:3mm;"><b>BAR-EN-103 : Isolation plancher bas</b><br>Surface : <b>'+s2.toFixed(2)+' m2</b> \u00b7 R \u2265 3 m\u00b2.K/W<br>LES ARTISANS VERTS \u00b7 SIRET 87806279300038 \u00b7 RGE QPAC/69719</div>';
        pg1+='<div class="dv-row"><div class="n">Isolation plancher bas mat\u00e9riel</div><div class="c">'+s2.toFixed(2)+' m\u00b2</div><div class="r">'+ite_fmt(pm2)+'</div><div class="r">'+ite_fmt(s2*pm2)+'</div><div class="r">'+tva.toFixed(2).replace('.',',')+'%</div></div>';
        pg1+='<div class="dv-row"><div class="n">Mise en \u0153uvre plancher bas</div><div class="c">'+s2.toFixed(2)+' m\u00b2</div><div class="r">'+ite_fmt(pmo2)+'</div><div class="r">'+ite_fmt(s2*pmo2)+'</div><div class="r">'+tva.toFixed(2).replace('.',',')+'%</div></div>';
    } else {
        var p2=ite_N('itePrixCET'),pp2=ite_N('itePrixPoseCET'),vol2=ite_V('iteRefCET');
        pg1+='<div class="dv-block" style="margin-top:3mm;"><b>BAR-TH-148 : Chauffe-eau thermodynamique</b><br>COP : '+ite_V('iteCopCET')+' \u00b7 THALEOS Performer 2 '+vol2+'L<br>LES ARTISANS VERTS \u00b7 SIRET 87806279300038 \u00b7 RGE QPAC/69719</div>';
        pg1+='<div class="dv-row"><div class="n">CET THALEOS '+vol2+'L</div><div class="c">1 U</div><div class="r">'+ite_fmt(p2)+'</div><div class="r">'+ite_fmt(p2)+'</div><div class="r">'+tva.toFixed(2).replace('.',',')+'%</div></div>';
        pg1+='<div class="dv-row"><div class="n">Forfait pose CET</div><div class="c">1 U</div><div class="r">'+ite_fmt(pp2)+'</div><div class="r">'+ite_fmt(pp2)+'</div><div class="r">'+tva.toFixed(2).replace('.',',')+'%</div></div>';
    }

    // --- LOT 3 ---
    if(hasLot3){
        if(t3==='101'){
            var s3=ite_N('iteSurface101L3'),pm3=ite_N('itePrixMat101L3'),pmo3=ite_N('itePrixMo101L3');
            pg1+='<div class="dv-block" style="margin-top:3mm;"><b>BAR-EN-101 : Isolation des combles perdus par soufflage (LOT 3)</b><br>Surface : <b>'+s3.toFixed(2)+' m2</b> \u00b7 R \u2265 7 m\u00b2.K/W<br>LES ARTISANS VERTS \u00b7 SIRET 87806279300038 \u00b7 RGE QPAC/69719</div>';
            pg1+='<div class="dv-row"><div class="n">Isolation souffl\u00e9 combles mat\u00e9riel</div><div class="c">'+s3.toFixed(2)+' m\u00b2</div><div class="r">'+ite_fmt(pm3)+'</div><div class="r">'+ite_fmt(s3*pm3)+'</div><div class="r">'+tva.toFixed(2).replace('.',',')+'%</div></div>';
            pg1+='<div class="dv-row"><div class="n">Mise en \u0153uvre isolation combles</div><div class="c">'+s3.toFixed(2)+' m\u00b2</div><div class="r">'+ite_fmt(pmo3)+'</div><div class="r">'+ite_fmt(s3*pmo3)+'</div><div class="r">'+tva.toFixed(2).replace('.',',')+'%</div></div>';
        } else if(t3==='103'){
            var s3=ite_N('iteSurface103L3'),pm3=ite_N('itePrixMat103L3'),pmo3=ite_N('itePrixMo103L3');
            pg1+='<div class="dv-block" style="margin-top:3mm;"><b>BAR-EN-103 : Isolation plancher bas (LOT 3)</b><br>Surface : <b>'+s3.toFixed(2)+' m2</b> \u00b7 R \u2265 3 m\u00b2.K/W<br>LES ARTISANS VERTS \u00b7 SIRET 87806279300038 \u00b7 RGE QPAC/69719</div>';
            pg1+='<div class="dv-row"><div class="n">Isolation plancher bas mat\u00e9riel</div><div class="c">'+s3.toFixed(2)+' m\u00b2</div><div class="r">'+ite_fmt(pm3)+'</div><div class="r">'+ite_fmt(s3*pm3)+'</div><div class="r">'+tva.toFixed(2).replace('.',',')+'%</div></div>';
            pg1+='<div class="dv-row"><div class="n">Mise en \u0153uvre plancher bas</div><div class="c">'+s3.toFixed(2)+' m\u00b2</div><div class="r">'+ite_fmt(pmo3)+'</div><div class="r">'+ite_fmt(s3*pmo3)+'</div><div class="r">'+tva.toFixed(2).replace('.',',')+'%</div></div>';
        } else {
            var p3=ite_N('itePrixCETL3'),pp3=ite_N('itePrixPoseCETL3'),vol3=ite_V('iteRefCETL3');
            pg1+='<div class="dv-block" style="margin-top:3mm;"><b>BAR-TH-148 : Chauffe-eau thermodynamique (LOT 3)</b><br>COP : '+ite_V('iteCopCETL3')+' \u00b7 THALEOS Performer 2 '+vol3+'L<br>LES ARTISANS VERTS \u00b7 SIRET 87806279300038 \u00b7 RGE QPAC/69719</div>';
            pg1+='<div class="dv-row"><div class="n">CET THALEOS '+vol3+'L</div><div class="c">1 U</div><div class="r">'+ite_fmt(p3)+'</div><div class="r">'+ite_fmt(p3)+'</div><div class="r">'+tva.toFixed(2).replace('.',',')+'%</div></div>';
            pg1+='<div class="dv-row"><div class="n">Forfait pose CET</div><div class="c">1 U</div><div class="r">'+ite_fmt(pp3)+'</div><div class="r">'+ite_fmt(pp3)+'</div><div class="r">'+tva.toFixed(2).replace('.',',')+'%</div></div>';
        }
    }
    pg1+=ite_dvFT(1,tp)+'</div>';

    var pg2='<div class="ite-page">'+dv_subHeader(num,df,nom);
    pg2+='<div class="dv-cond" style="margin-top:4mm;"><h4>Termes et conditions CEE</h4><p>Prime li\u00e9e \u00e0 la valorisation des certificats d\'\u00e9conomies d\'\u00e9nergie par R2M DISTRIBUTIONS (SIREN 978 036 937), repr\u00e9sent\u00e9 par VALOREN (SIREN 852 404 938) en sa qualit\u00e9 de mandataire, pour la somme de <b>'+ite_fmt(primeCEE)+'</b>.</p></div>';
    pg2+='<div class="dv-cond"><b>Gestion des d\u00e9chets</b><br>Gestion, \u00e9vacuation et traitements des d\u00e9chets de chantier comprenant la main d\'\u0153uvre li\u00e9e \u00e0 la d\u00e9pose et au tri, le transport des d\u00e9chets de chantiers vers un ou plusieurs points de collecte et co\u00fbts de traitement.</div>';
    pg2+='<div class="dv-totaux"><div class="dv-sig">Apposer signature pr\u00e9c\u00e9d\u00e9e de la mention "Bon pour accord"<br>Le :</div><div><table class="dv-tt"><tr><td>Total H.T</td><td>'+ite_fmt(ht)+'</td></tr><tr><td>Total TVA '+tva.toFixed(1).replace('.',',')+'%</td><td>'+ite_fmt(tvam)+'</td></tr><tr class="ttc"><td><b>Total TTC</b></td><td><b>'+ite_fmt(ttc)+'</b></td></tr><tr><td>Prime CEE *</td><td>- '+ite_fmt(primeCEE)+'</td></tr><tr class="reste"><td><b>Reste \u00e0 payer</b></td><td><b>'+ite_fmt(reste)+'</b></td></tr></table></div></div>';
    pg2+='<div class="dv-legal" style="margin-top:6mm;">Ce devis est gratuit et valable 30 jours.'+(wFin?'<br>Paiement par cr\u00e9dit affect\u00e9 DOMOFINANCE.':'')+'<br>Mode de paiement : Ch\u00e8que, Virement, Financement, Esp\u00e8ce<br>M\u00e9diation : CM2C - 14 rue Saint Jean 75017 Paris \u00b7 0609204886 \u00b7 cm2c.net</div>';
    pg2+=ite_dvFT(2,tp)+'</div>';

    var pg3='';
    if(wFin){
        var fMensHA=ite_N('iteMensHorsAss'),fMensAA=ite_N('iteMensAvecAss');
        var fTotalHA=ite_N('iteTotalDuHA'),fTotalAA=ite_N('iteTotalDuAA');
        var fDuree=ite_V('iteDureeMois');
        var villeClean=vil.split(' ').slice(1).join(' ')||'_____';
        pg3='<div class="ite-page">'+dv_subHeader(num,df,nom)
        +'<div style="font-size:9.5pt;line-height:2;margin-top:4mm;">'
        +'<b style="font-size:10pt;text-decoration:underline;">Conditions de paiement :</b><br>'
        +'Mode de r\u00e8glement : Financement<br>'
        +'Montant \u00e0 financer : '+ite_fmt(reste)+'<br>'
        +'Organisme financier : DOMOFINANCE<br>'
        +'TAEG : 0%<br>'
        +'Taux d\u00e9biteur : 0%<br>'
        +'Dur\u00e9e du contrat de cr\u00e9dit : '+fDuree+' mois<br>'
        +'Remboursement en : '+fDuree+' mois<br>'
        +'Mensualit\u00e9 hors assurance : '+ite_fmt(fMensHA)+'<br>'
        +'Mensualit\u00e9 avec assurance : '+ite_fmt(fMensAA)+'<br>'
        +'Report mensualit\u00e9 : 0 mois<br>'
        +'Assurance : Oui<br>'
        +'Type d\u2019assurance : '+ite_V('iteTypeAssurance')+'<br>'
        +'Technicien financier : -<br>'
        +'Montant total d\u00fb hors assurance : '+ite_fmt(fTotalHA)+'<br>'
        +'Montant total d\u00fb avec assurance : '+ite_fmt(fTotalAA)+''
        +'</div>'
        +'<div style="margin-top:12mm;display:flex;gap:20mm;font-size:9pt;line-height:1.8;">'
        +'<div style="flex:1;">Fait \u00e0 : <b>'+villeClean.toUpperCase()+'</b><br>Le :<br><br>Signature du b\u00e9n\u00e9ficiaire :</div>'
        +'<div style="flex:1;">Nom du repr\u00e9sentant LES ARTISANS VERTS : <b>'+con+'</b><br>A : COURBEVOIE<br>Le :<br><br>Signature du repr\u00e9sentant</div>'
        +'</div>'
        +ite_dvFT(3,tp)+'</div>';
    }

    ite_$('iteDevisArea').innerHTML=pg1+pg2+pg3;
    ite_$('iteDevisArea').style.display='block';
    downloadDevisPDF('iteDevisArea','DEVIS-ITE-'+num+'-'+nom.replace(/\s+/g,'_')+'.pdf');
}

// ============================================
// TAB SYSTEM
// ============================================
function switchTab(tab){
    var mc=document.getElementById('mainContent');
    mc.classList.remove('tab-pac-active','tab-ite-active');
    mc.classList.add('tab-'+tab+'-active');
    document.getElementById('tabPAC').classList.toggle('active',tab==='pac');
    document.getElementById('tabITE').classList.toggle('active',tab==='ite');
    if(tab==='pac'){try{calc();}catch(e){}}
    else{try{ite_calc();}catch(e){}}
}

// ============================================
// HOOK: sync profil precarite when detectProfil runs
// ============================================
(function(){
    var origDetectProfil=window.detectProfil;
    if(typeof origDetectProfil==='function'){
        window.detectProfil=function(){
            origDetectProfil.apply(this,arguments);
            syncProfilPrecarite();
        };
    }
})();

// ============================================
// PAC DEVIS GENERATION â€” Format conforme au modÃ¨le officiel
// ============================================

// DonnÃ©es techniques CET par rÃ©fÃ©rence
var CET_SPECS={
    PERFORMER2_200L:{vol:'200',profil:'L',cop7:'2,78',etaWh:'116',resist:'1800',tempFunc:'-5 Ã  +43',refrig:'R-513A',h:'1617',diam:'620',poids:'80',ref:'THA 986 113',fullRef:'Chauffe-eau thermodynamique THALEOS- 200L - THA 986113'},
    PERFORMER2_270L:{vol:'270',profil:'XL',cop7:'2,80',etaWh:'118',resist:'1800',tempFunc:'-5 Ã  +43',refrig:'R-513A',h:'1870',diam:'620',poids:'95',ref:'THA 986 114',fullRef:'Chauffe-eau thermodynamique THALEOS- 270L - THA 986114'}
};

function pac_generateDevis(){
    try{
    var titre=ite_V('nom').toUpperCase();
    var prenom=ite_V('prenom').toUpperCase();
    var nom=(prenom+' '+titre).trim()||'CLIENT';
    var civilite='MME ';
    var nomDevis=civilite+titre+' '+prenom;
    var num=ite_V('iteNumDevis'),nc=ite_V('iteNumClient')||num;
    var dRaw=ite_V('iteDateDevis').split('-'),df=dRaw[2]+'/'+dRaw[1]+'/'+dRaw[0];
    var adr=ite_V('iteAdresse'),vil=ite_V('iteVille'),tel=ite_V('iteTel'),em=ite_V('iteEmail');
    var zn=document.getElementById('zone').value;
    var tch=ite_V('iteTypeChauffage');
    var con=ite_V('iteConseiller');
    var tva=parseFloat(document.getElementById('tvaProduit').value)||5.5;
    var tvaStr=tva.toFixed(2).replace('.',',')+' %';

    // PrÃ©caritÃ© label
    var precVal=ite_V('itePrecarite');
    var precL={classique:'Classique',modeste:'Modeste',grande:'TrÃ¨s modeste'}[precVal]||precVal;

    // RÃ©cupÃ©rer la catÃ©gorie (profil MPR)
    var profil=document.getElementById('categorie').value;
    var precDevis=profil==='BLEU'?'TrÃ¨s modeste':(profil==='JAUNE'?'Modeste':(profil==='VIOLET'?'IntermÃ©diaire':'SupÃ©rieur'));

    // Type de chauffage long
    var tchMap={'Gaz':'Combustible / Gaz','Fioul':'Combustible / Fioul','Ã‰lectrique':'Ã‰lectrique','Bois':'Combustible / Bois','PAC':'PAC existante','Autre':'Autre'};
    var tchLong=tchMap[tch]||tch;

    // PAC data
    var pacKey=document.getElementById('marquePAC').value;
    var pacEl=document.getElementById('marquePAC');
    var pacName=pacEl.options[pacEl.selectedIndex].text;
    var p=PAC_CATALOG[pacKey]||{};
    var pPAC=ite_N('prixPAC'),pPose=ite_N('prixPose');
    var usage=document.getElementById('usagePAC').value;
    var surfacePAC=ite_V('surfaceClient')||ite_V('ceeSurface')||'100';

    // DÃ©terminer application HT/BT depuis ETAS
    var ev=(p.etas||'').split('/').map(function(s){return parseFloat(s.trim());});
    var etasHT=ev.length>1?ev[1]:ev[0];
    var etasBT=ev[0]||etasHT;
    var appType=etasHT>=100?'Haute tempÃ©rature':'Basse tempÃ©rature';

    // kWh Cumac PAC
    var kwhcPAC=lastCEEDetailKwhc||0;
    var primeCEEPAC=(lastCEEDetailPrime||0);

    // Phase
    var phase=(p.a||'').indexOf('3Ph')>=0?'TriphasÃ©e':'MonophasÃ©e';
    var phaseShort=phase==='TriphasÃ©e'?'TriphasÃ©e':'MonophasÃ©e';

    // Ballon
    var wBallon=ite_V('includeBallon')==='oui';
    var ballonRef='',ballonKey='',pBallon=0,pPoseBallon=0,copB='',cetSpecs=null;
    if(wBallon){
        var bEl=document.getElementById('refBallon');
        ballonKey=bEl.value;
        ballonRef=bEl.options[bEl.selectedIndex].text;
        pBallon=ite_N('prixBallon');
        pPoseBallon=ite_N('prixPoseBallon');
        copB=ite_V('copBallon');
        cetSpecs=CET_SPECS[ballonKey]||CET_SPECS['PERFORMER2_200L'];
    }

    // SSC
    var wSSC=ite_V('includeSSC')==='oui';
    var sscRef='',pSSC=0,pPoseSSC=0;
    if(wSSC){sscRef=document.getElementById('refSSC').options[document.getElementById('refSSC').selectedIndex].text;pSSC=ite_N('prixSSC');pPoseSSC=ite_N('prixPoseSSC');}

    // Totaux
    var ttc=pPAC+pPose+(wBallon?pBallon+pPoseBallon:0)+(wSSC?pSSC+pPoseSSC:0);
    var ht=ttc/(1+tva/100),tvam=ttc-ht;

    // Aides
    var adTxt=document.getElementById('aidesMPR').textContent.replace(/[^\d]/g,'');
    var ceTxt=document.getElementById('aidesCEE').textContent.replace(/[^\d]/g,'');
    var ad=parseFloat(adTxt)||0,ce=parseFloat(ceTxt)||0;
    var totalAides=ad+ce,reste=ttc-totalAides;

    // kWhc ballon (BAR-TH-148)
    var kwhcBallon=wBallon?14700:0;
    var primeCEEBallon=wBallon?(kwhcBallon/1000*(ite_N('prixCumac')||7)):0;

    // Prime CEE totale du devis
    var primeCEETotale=ce;

    var numDevis=num.replace('AVR-','');

    var tp=3; // 3 pages

    // RGE info
    var rgeInfo='MatÃ©riel(s) fourni(s) et mis en place par notre sociÃ©tÃ© LES ARTISANS VERTS.<br>reprÃ©sentÃ©e par TORDJMAN BENJAMIN, SIRET 87806279300038, Certificat rge<br>NumÃ©ro QPAC/69719 attribuÃ© le 15/02/2026 valable jusqu\'au 15/02/2027';

    // ===== PAGE 1 =====
    var pg1='<div class="ite-page">'+dv_logoHeader();
    pg1+='<div class="dv-title"><span>DEVIS : '+numDevis+' '+nomDevis+'</span></div>';
    pg1+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:0 6mm;margin-bottom:4mm;font-size:8pt;line-height:1.6;">';
    pg1+='<div>NumÃ©ro Client : <b>'+nc+'</b><br>Date de devis : <b>'+df+'</b><br>Adresse des travaux : <b>'+adr+'</b><br><b>'+vil+'</b></div>';
    pg1+='<div>'+adr+'<br>'+vil+'<br>TÃ©l : '+tel+'<br>E-mail : '+em+'<br>Zone : <b>'+zn+'</b><br>PrÃ©caritÃ© : <b>'+precDevis+'</b><br>Type de chauffage : <b>'+tchLong+'</b><br>Type de logement : <b>Maison individuelle / +15 ans</b></div>';
    pg1+='</div>';
    pg1+=ite_dvTH();

    // === CET (Ballon) en premier si prÃ©sent (comme le modÃ¨le PDF) ===
    if(wBallon && cetSpecs){
        pg1+='<div class="dv-block"><b>BAR-TH-148 : Mise en place d\'un chauffe-eau thermodynamique Ã  accumulation.</b><br>';
        pg1+='Type d\'installation : Sur air extrait<br>';
        pg1+='Le COP du materiel installÃ© est de : '+copB+' mesurÃ© selon les conditions de la norme EN 16147.<br>';
        pg1+='Marque : THALEOS<br>';
        pg1+='RÃ©f : ** '+cetSpecs.fullRef+'<br>';
        pg1+='- Kwh Cumac : '+ite_fmtN(kwhcBallon)+'<br>';
        pg1+='- Prime CEE : '+ite_fmt(primeCEEBallon)+'<br><br>';
        pg1+=rgeInfo+'</div>';

        pg1+='<div class="dv-row"><div class="n">** '+cetSpecs.fullRef+'</div><div class="c">1,00 U</div><div class="r">'+ite_fmt(pBallon)+'</div><div class="r">'+ite_fmt(pBallon)+'</div><div class="r">'+tvaStr+'</div></div>';
        pg1+='<div class="dv-specs">MARQUE : THALEOS - PERFORMER 2 - '+cetSpecs.vol+'L - '+cetSpecs.ref+'<br>';
        pg1+='- CapacitÃ© : '+cetSpecs.vol+'l<br>';
        pg1+='- Profil de soutirage : '+cetSpecs.profil+'<br>';
        pg1+='- COP Ã  7Â°C : '+copB+' ( Selon la norme EN 16147 )<br>';
        pg1+='- RENDEMENT ENERGETIQUE Eta wh : '+cetSpecs.etaWh+' % - Puissance de la rÃ©sistance (W) : '+cetSpecs.resist+'<br>';
        pg1+='- TempÃ©rature de fonctionnement CÂ° : '+cetSpecs.tempFunc+'<br>';
        pg1+='- type de rÃ©frigÃ©rant : '+cetSpecs.refrig+'<br>';
        pg1+='- Hauteur : '+cetSpecs.h+' mm - DiamÃ¨tre : '+cetSpecs.diam+' mm - Poids Ã  vide : '+cetSpecs.poids+' kg</div>';

        pg1+='<div class="dv-row"><div class="n">FORFAIT POSE ET MISE EN SERVICE D\'UN CHAUFFE-EAU THERMODYNAMIQUE</div><div class="c">1,00 U</div><div class="r">'+ite_fmt(pPoseBallon)+'</div><div class="r">'+ite_fmt(pPoseBallon)+'</div><div class="r">'+tvaStr+'</div></div>';
        pg1+='<div class="dv-specs">- Pose et installation complÃ¨te d\'un chauffe-eau thermodynamiques<br>';
        pg1+='- Vidange et dÃ©pose du ballon existant<br>';
        pg1+='- Mise en place du chauffe-eau thermodynamique en lieu et place de l\'ancien chauffe-eau.<br>';
        pg1+='- Raccordement sur eau froide et eau chaude du circuit sanitaire existant au moyen de flexibles.<br>';
        pg1+='- Raccordement sur tuyau de vidange existant.<br>';
        pg1+='- Raccordement sur ligne(s) Ã©lectrique(s) existante(s) devant correspondre aux normes en vigueur.<br>';
        pg1+='- Remplacement du groupe de sÃ©curitÃ©.<br>';
        pg1+='- Remplissage et tests d\'Ã©tanchÃ©itÃ©.<br>';
        pg1+='- ContrÃ´le du bon fonctionnement.<br>';
        pg1+='Mise en service et conseils d\'utilisation.</div>';
    }

    // === PAC (BAR-TH-171) â€” Description ===
    pg1+='<div class="dv-block" style="margin-top:3mm;"><b>BAR-TH-171 : Mise en place d\'une pompe Ã  chaleur (PAC) de type air/eau</b><br>';
    pg1+='La PAC est installÃ©e pour une application '+appType+'<br>';
    pg1+='Marque : '+p.m+'<br>';
    pg1+='RÃ©fÃ©rence : ** PAC '+p.m+' '+p.n.replace('PAC '+p.m+' ','').replace('ETAS ','').replace(/%/g,'')+'kw '+appType+' '+phaseShort+' - ETAS '+etasHT+'%<br>';
    pg1+='Surface chauffÃ©e par la PAC : '+surfacePAC+',00 m2<br>';
    pg1+='Usage couvert par la PAC : '+usage+'<br>';
    pg1+='Coefficient de performance (COP) : '+p.cop55+'<br>';
    pg1+='EfficacitÃ© Ã©nergÃ©tique saisonniÃ¨re (hors dispositif de rÃ©gulation) : '+etasHT+'%, calculÃ©e selon le rÃ¨glement (EU) nÂ°813/2013 de la commission du 2 aout 2013.<br>';
    pg1+='Mise en place d\'un rÃ©gulateur de classe : '+p.rg+'<br>';
    pg1+='- DÃ©pose et remplacement d\'une chaudiÃ¨re individuelle '+tch+'<br>';
    pg1+='- Kwh Cumac : '+ite_fmtN(kwhcPAC)+'<br>';
    pg1+='NÂ° QPAC/69719 VAL 15/02/2027<br><br>';
    pg1+=rgeInfo+'</div>';

    pg1+=ite_dvFT(1,tp)+'</div>';

    // ===== PAGE 2 : Suite PAC (specs + pose) =====
    var pg2='<div class="ite-page">'+dv_subHeader(numDevis,df,nomDevis);
    pg2+='<div style="margin-top:2mm;font-size:8pt;line-height:1.55;">';
    pg2+='- Prime Coup de pouce CEE : '+ite_fmt(primeCEETotale)+'<br><br>';
    pg2+=rgeInfo+'</div>';

    // Ligne prix PAC matÃ©riel
    var pacRefFull='PAC '+p.m+' '+p.n.replace('PAC '+p.m+' ','');
    pg2+='<div class="dv-row" style="margin-top:3mm;"><div class="n">** '+pacRefFull+' '+phaseShort+' - ETAS '+etasHT+'%</div><div class="c">1,00 U</div><div class="r">'+ite_fmt(pPAC)+'</div><div class="r">'+ite_fmt(pPAC)+'</div><div class="r">'+tvaStr+'</div></div>';

    // Specs PAC dÃ©taillÃ©es
    pg2+='<div class="dv-specs">';
    pg2+='Puissance calorifique A7/35 : '+(p.cap35||'-')+'<br>';
    pg2+='Puissance calorifique A7/55 : '+(p.cap55||'-')+'<br>';
    pg2+='COP A7/W35 //A7/W55 : '+p.cop35+' //'+p.cop55+'<br>';
    pg2+='Classe Ã©nergÃ©tique sortie d\'eau Ã  35//55Â°C : '+p.cls+'<br>';
    pg2+='EfficacitÃ© saisonniÃ¨re sortie d\'eau Ã  35/55Â°C (ETAS) : '+p.etas+' %<br>';
    pg2+='SCOP 35/55: '+p.scop+'<br>';
    pg2+='Puissance acoustique (chauffage) : '+p.db+'<br>';
    pg2+='TempÃ©rature d\'air extÃ©rieur (chauffage) : -25 / +35 Â°C<br>';
    pg2+='TempÃ©rature d\'air extÃ©rieur ECS : -25 / +43 Â°C<br>';
    pg2+='Phase / Tension / FrÃ©quence : '+p.a+' / 50 Hz<br>';
    pg2+='Protection Ã©lectrique : '+p.pr+'<br>';
    pg2+='RÃ©frigÃ©rant / PRP : '+p.ref+' / '+(p.ref==='R290'?'3':(p.ref==='R32'?'675':'-'))+'<br>';
    if(p.ch && p.ch!=='-') pg2+='Charge : '+p.ch+'<br>';
    pg2+='Dimensions de l\'unitÃ© (LxHxP) : '+p.dim+'<br>';
    pg2+='Poids net : '+p.kg+'</div>';

    // Forfait pose PAC
    pg2+='<div class="dv-row"><div class="n">FORFAIT POSE ET MISE EN SERVICE D\'UNE POMPE A CHALEUR</div><div class="c">1,00 U</div><div class="r">'+ite_fmt(pPose)+'</div><div class="r">'+ite_fmt(pPose)+'</div><div class="r">'+tvaStr+'</div></div>';
    pg2+='<div class="dv-specs">';
    pg2+='- Pose et installation complÃ¨te d\'une pompe Ã  chaleur air/eau<br>';
    pg2+='- Forfait dÃ©placement et mise en service comprise<br>';
    pg2+='- Installation du module extÃ©rieur - Liaison hydraulique, Liaison frigorifique<br>';
    pg2+='- Raccord des liaisons a l\'existant - CÃ¢blage d\'alimentation, CÃ¢blage connexion Ã©lectrique<br>';
    pg2+='- Protection disjoncteur diffÃ©rentiel, Purge des radiateurs<br>';
    pg2+='- DÃ©sembouage du systÃ¨me, Mise en service & Programmation<br>';
    pg2+='- ContrÃ´le du circuit hydraulique et de son Ã©tanchÃ©itÃ©<br>';
    pg2+='- Mise sous pression d\'azote, ContrÃ´le de l\'Ã©tanchÃ©itÃ© du circuit frigorifique<br>';
    pg2+='- ContrÃ´le du circuit Ã©lectrique (conforme NF C15 100)<br>';
    pg2+='- Mise en service et contrÃ´le du fonctionnement, DÃ©monstration, complÃ¨te des diffÃ©rentes fonctions</div>';

    // SSC si prÃ©sent
    if(wSSC){
        pg2+='<div class="dv-block" style="margin-top:3mm;"><b>SystÃ¨me Solaire CombinÃ©</b><br>'+sscRef+'<br>LES ARTISANS VERTS Â· SIRET 87806279300038 Â· RGE QPAC/69719</div>';
        pg2+='<div class="dv-row"><div class="n">SSC '+sscRef+'</div><div class="c">1,00 U</div><div class="r">'+ite_fmt(pSSC)+'</div><div class="r">'+ite_fmt(pSSC)+'</div><div class="r">'+tvaStr+'</div></div>';
        pg2+='<div class="dv-row"><div class="n">Forfait pose SSC</div><div class="c">1,00 U</div><div class="r">'+ite_fmt(pPoseSSC)+'</div><div class="r">'+ite_fmt(pPoseSSC)+'</div><div class="r">'+tvaStr+'</div></div>';
    }

    pg2+=ite_dvFT(2,tp)+'</div>';

    // ===== PAGE 3 : Conditions + Totaux + Signatures =====
    var pg3='<div class="ite-page">'+dv_subHeader(numDevis,df,nomDevis);

    // Conditions MPR
    if(ad>0){
        pg3+='<div class="dv-cond" style="margin-top:4mm;"><h4>(**) Conditions particuliÃ¨res relatives Ã  l\'aide ANAH / MaPrimeRÃ©nov\'</h4>';
        pg3+='<p>Cette offre est cumulable avec l\'aide MaPrimeRÃ©nov\', accordÃ©e uniquement aprÃ¨s analyse du dossier, d\'un montant estimatif de <b>'+ite_fmt(ad)+'</b>.<br>';
        pg3+='Dans le cas oÃ¹ l\'aide notifiÃ©e au client est infÃ©rieure au montant de l\'aide prÃ©visionnelle, l\'usager n\'est pas liÃ© par le devis et l\'entreprise s\'engage Ã  proposer un devis rectificatif. Le client conserve alors un droit de rÃ©tractation d\'une durÃ©e de quatorze jours Ã  partir de la date de prÃ©sentation du devis rectificatif.<br>';
        pg3+='L\'aide MaPrimeRÃ©nov\' est conditionnelle et soumise Ã  la conformitÃ© des piÃ¨ces justificatives et informations dÃ©clarÃ©es par le bÃ©nÃ©ficiaire. En cas de fausse dÃ©claration, de manÅ“uvre frauduleuse ou de changement du projet de travaux subventionnÃ©, le bÃ©nÃ©ficiaire s\'expose au retrait et reversement de tout ou partie de l\'aide. Les services de l\'Anah pourront faire procÃ©der Ã  tout contrÃ´le des engagements et sanctionner le bÃ©nÃ©ficiaire et son mandataire Ã©ventuel des manquements constatÃ©s.</p></div>';
    }

    // Conditions CEE
    pg3+='<div class="dv-cond"><h4>Termes et conditions CEE</h4>';
    pg3+='<p>Prime liÃ©e Ã  la valorisation des certificats d\'Ã©conomies d\'Ã©nergie par R2M DISTRIBUTIONS (SIREN 978 036 937), reprÃ©sentÃ© par VALOREN (SIREN 852 404 938) en sa qualitÃ© de mandataire, pour la somme de <b>'+ite_fmt(ce)+'</b>. Â»</p></div>';

    // Gestion dÃ©chets
    pg3+='<div class="dv-cond"><b>Gestion des dÃ©chets</b><br>';
    pg3+='Gestion, Ã©vacuation et traitements des dÃ©chets de chantier comprenant la main d\'Å“uvre liÃ©e Ã  la dÃ©pose et au tri, le transport des dÃ©chets de chantiers vers un ou plusieurs points de collecte et coÃ»ts de traitement.</div>';

    // Signature + Totaux
    pg3+='<div class="dv-totaux">';
    pg3+='<div class="dv-sig">Apposer signature prÃ©cÃ©dÃ©e de la mention "Bon pour accord"<br>Le :<br><br>Ce devis est gratuit et valable 30 jours.<br>Mode de paiement : ChÃ¨que, Virement, Financement, EspÃ¨ce</div>';
    pg3+='<div><table class="dv-tt">';
    pg3+='<tr><td>Total H.T</td><td>'+ite_fmt(ht)+'</td></tr>';
    pg3+='<tr><td>Total TVA  '+tva.toFixed(1).replace('.',',')+'%</td><td>'+ite_fmt(tvam)+'</td></tr>';
    pg3+='<tr class="ttc"><td><b>Total TTC</b></td><td><b>'+ite_fmt(ttc)+'</b></td></tr>';
    if(ce>0) pg3+='<tr><td>Prime CEE *</td><td>- '+ite_fmt(ce)+'</td></tr>';
    if(ad>0){
        pg3+='<tr><td>Estimation MaPrimeRÃ©nov\'</td><td>- '+ite_fmt(ad)+'</td></tr>';
        pg3+='<tr><td colspan="2" style="font-size:6pt;font-weight:400;font-style:italic;text-align:right;">Sous rÃ©serve de l\'accord de l\'ANAH (**)</td></tr>';
    }
    pg3+='<tr class="reste"><td><b>Reste Ã  payer</b></td><td><b>'+ite_fmt(reste)+'</b></td></tr>';
    pg3+='</table></div></div>';

    // MÃ©diation
    pg3+='<div class="dv-legal" style="margin-top:6mm;">';
    pg3+='Le client peut recourir Ã  la mÃ©diation de la consommation en s\'adressant Ã  Toute rÃ©clamation doit etre adressÃ© au Service Clients du Vendeur situÃ© au 6 Passage EugÃ¨ne Barbier- 92400 Courbevoie.<br>';
    pg3+='ConformÃ©ment aux dispositions de l\'article L.616-1 et R.616-1 du Code de la consommation relatives au processus de mÃ©diation des litiges de la consommation, l\'Acheteur a le droit de recourir gratuitement au service de mÃ©diation proposÃ© par Les ARTISANS VERTS<br>';
    pg3+='Le mÃ©diateur de la consommation ainsi proposÃ© est :<br>';
    pg3+='Centre de la MÃ©diation de la Consommation des Conciliateurs de justice<br>';
    pg3+='Saisine par courrier : CM2C - 14 rue Saint Jean - 75017 Paris<br>';
    pg3+='Par tÃ©lÃ©phone : 0609204886<br>';
    pg3+='Par mail via le site : https://www.cm2c.net/declarer-un-litige.php<br>';
    pg3+='Pour le site : https://www.cm2c.net/</div>';

    pg3+=ite_dvFT(3,tp)+'</div>';

    document.getElementById('pacDevisArea').innerHTML=pg1+pg2+pg3;
    document.getElementById('pacDevisArea').style.display='block';
    document.getElementById('printArea').style.display='none';
    downloadDevisPDF('pacDevisArea','DEVIS-'+numDevis+'-'+nom.replace(/\s+/g,'_')+'.pdf');
    }catch(e){console.error('pac_generateDevis error:',e);alert('Erreur gÃ©nÃ©ration devis: '+e.message);}
}

// Override print for tab-aware printing
(function(){
    window.exportPDF=function(){
        var mc=document.getElementById('mainContent');
        if(mc.classList.contains('tab-ite-active')){
            ite_generateDevis();
        } else {
            pac_generateDevis();
        }
    };
})();
</script>
</body>
</html>
